# 直方图
---

## 简介

直方图，又称质量分布图，用于表示数据的分布情况，是一种常见的统计图表，一般用横轴表示数据区间，纵轴表示分布情况，图表形状类似柱状图，柱子越高，则落在该区间的数量越大。

## 应用场景

观测云的直方图用于显示某个指标数据在一段时间内的数据分布走向。可用于以下场景：

- 查看应用性能指标数据在一定时间范围内的分布情况，如在最近 15 分钟内“请求数”的分布情况；
- 查看用户访问指标数据在一定时间范围内的分布情况，如在最近 15 分钟内“错误数”的分布情况；
- 其他日志类数据中 `number` 类型数据的分布情况。

## 图表查询

图表查询支持「简单查询」、「表达式查询」、「DQL查询」，图表查询条件详细说明请点击 [图表查询](chart-query.md) 进行查看，默认添加简单查询。

???+ attention

    直方图仅支持日志类数据，可用于表示 ES 存储 `number` 类型数据的分布情况，包括"日志"、"基础对象"、"自定义对象"、"事件"、"应用性能"、"用户访问"、"安全巡检"、"网络"、"profile"的数据查询；若工作空间为 SLS 存储，则数据查询报错。更多存储说明可参考文档 [数据存储策略](../../billing/billing-method/data-storage.md#options)。

## 图表链接

链接可以帮助您实现从当前图表跳转至目标页面，支持添加平台内部链接和外部链接，支持通过模板变量修改链接中对应的变量值将数据信息传送过去，完成数据联动。相关设置说明请点击 [图表链接](chart-link.md) 进行查看。

## 事件关联

通过“添加筛选字段”匹配与选定字段相关的异常事件，从而达到时序数据与事件关联显示的目的。这个功能可以帮助用户在查看趋势的同时，感知数据波动期间是否有相关事件产生，以帮助用户从另一个视角定位问题。相关设置说明请点击 [事件关联](events-relative.md) 进行查看。

## 图表样式
| 选项 | 说明 |
| --- | --- |
| 图表标题 | 为图表设置标题名称，设置完成后，在图表的左上方显示，支持隐藏 |
| 颜色 | 设置直方图的颜色 |
| 图例 | <li>用于直观显示各指标数据的名称、数量及占比情况。目前支持选择底部、右侧、隐藏图例（点击图例中的指标行，可隐藏/显示对应指标）<br><li>图例值支持 min、max、p50、p75、p90、p99 |
| 百分位数 | 查询数据时默认在直方图的分布位置显示 p50 、 p75、p90、p99 ，以竖线定位，帮助更直观的查看数据分布情况 |


## 图表设置

### 基本设置
| 选项 | 说明 |
| --- | --- |
| 单位 | 支持为查询结果自定义设置单位。若不设置单位，则按照科学计数自动计算图表Y轴数值；按照千分位的格式在图表上展示原始数值。<br /><li> Y轴数值展示<br />默认查询结果值自动转换单位展示遵循「科学计数 K、M、B」，保留两位小数点（1千 = 1K，100万 = 1M，10亿 = 1B）；人民币自动转换单位「元、万、亿」，保留两位小数点<br />       例如：单位的时间间隔选择单位为ns，那么按照数据的大小，查询结果只自动转换单位效果如下，以此类推：<br />   - 1000000ns：图表查询数据结果显示为1ms<br />   - 1000000000ns：图表查询数据结果显示为1s<br />   - 10000000000ns：图表查询数据结果显示为1m<br />注意：选择自定义单位后，取消科学计数，按用户设置的单位显示。<br /><li> 图表数值展示<br />可参考文档 [图表千分位](chart-query.md#thousand) 。 |

### 高级设置
| 选项 | 说明 |
| --- | --- |
| 锁定时间 | 支持锁定图表查询数据的时间范围，不受全局时间组件的限制。设置成功后的图表右上角会出现用户设定的时间，如【xx分钟】、【xx小时】、【xx天】。如锁定时间间隔30分钟，那么当调节时间组件无论查询什么时间范围视图，仍只会显示最近 30 分钟数据 |
| 图表说明 | 为图表添加描述信息，设置后图表标题后方会出现【i】的提示，不设置则不显示 |
| 字段映射 | 配合视图变量的对象映射功能，默认为关闭，若在视图变量已配置对象映射：<br />- 开启字段映射时，图表显示查询的「分组字段」和对应的「映射字段」，未指定映射的分组字段不显示<br />- 关闭字段映射时，图表正常显示，不显示映射的字段<br /> |
| 工作空间 | 被授权的工作空间列表，选择后即可通过图表查询并展示该工作空间数据 |


## 示例图

下图是查看应用性能指标数据在一定时间范围内“请求数”的分布情况。

![](../img/.png)

