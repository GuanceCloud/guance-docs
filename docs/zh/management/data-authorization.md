# 数据权限管理
---

观测云支持对数据进行授权查看和脱敏处理，更好管理不同权限的工作空间成员数据查看。


## 敏感数据脱敏 {#data-mask}

数据采集上报到观测云工作空间以后，部分数据中存在的一些敏感信息字段，比如 IP 地址、用户信息等，针对这部分信息可以通过配置敏感字段来做脱敏处理。

???+ warning

    - 不同的数据类型，可以自定义配置该数据下的敏感字段（字段名区分大小写）。数据类型包含：日志、基础对象、自定义对象、事件、应用性能、用户访问、安全巡检、网络、Profile；        
    - 字段配置脱敏后，字符串（string）类型字段数据返回显示 "***"；              
    - 仅支持添加脱敏规则时，已选定分发的成员角色查看原始数据，其余成员在对应的查看器或者图表中无法查看脱敏前信息。       

### 添加脱敏规则

点击**管理 > 数据权限管理 > 敏感数据脱敏**，点击**添加脱敏规则**，即可开始添加敏感字段。

输入当前脱敏规则的名称，选择对应的数据类型后，输入需要脱敏的字段。

![](img/2.field_1.png)

写入正则表达式，即可通过正则语法针对字段值内容进行脱敏配置。目前支持您直接选用[模板库](../dql/regex.md)或自定义输入。点击预览，输入原文，点击脱敏即可查看脱敏效果。

如图所示，观测云会根据左侧正则表达式匹配结果，匹配到的结果按照 `***` 脱敏处理。

<img src="../img/token-mask.png" width="70%" >

您可以**基于角色级别**配置敏感数据屏蔽规则，选定需要分发的角色即可；支持多选。

点击**确定**即可查看已经配置的敏感字段，如 `host_ip` 等。

<!--
### 查看脱敏效果

#### 在日志查看器查看脱敏效果

在数据授权管理配置了日志数据的敏感字段 `host_ip` 以后，工作空间标准成员和只读成员在日志查看器只能看到脱敏后的 `host_ip` 。

![](img/3.data_7.png)


#### 在场景查看脱敏效果

在数据授权管理配置了日志数据的敏感字段 `host_ip` 以后，工作空间标准成员和只读成员在场景仪表板的日志流图中只能看到脱敏后的 `host_ip` 。

![](img/3.data_8.png)
-->
### 规则列表管理

![](img/2.field_2.png)

- 搜索：在页面右侧搜索栏，您可直接输入规则名称进行搜索；
- 编辑：点击即可修改当前规则；
- 删除：如无需当前规则，点击删除即可；
- 批量操作：在规则列表，您可以批量启用、禁用或删除特定规则。


## 跨空间数据授权 {#data-authorization}

观测云按照工作空间为单位，各个工作空间的数据相互独立，保障了数据的安全性。同时观测云支持跨空间数据授权的方式，<u>授权多个工作空间的数据给到当前的工作空间</u>，通过场景仪表板和笔记的图表组件进行查询和展示。您如果有多个工作空间，配置数据授权后，即可在一个工作空间查看所有工作空间的数据。

此外，考虑到用户可能同时在观测云多个站点开通工作空间使用，为了能够满足用户在一个工作空间统一汇总查询其所有工作空间的数据场景，观测云支持<u>在同一站点授权查询跨工作空间的数据</u>。

### 添加数据授权 {#site}

进入**管理 > 数据权限管理 > 跨空间数据授权 > 授权给**，点击**添加授权**：

![](img/management-data-1.png)

:material-numeric-1-circle-outline: 选择站点：

默认提供以下站点选项：中国区1（杭州）、中国区2（宁夏）、中国区3（张家口）、中国区4（广州）、中国区5（世纪互联）、中国区6（香港）、海外区1（俄勒冈）、欧洲区1（法兰克福）、亚太区1（新加坡）。

您也可以支持手动输入配置（仅支持 SaaS 版），格式为对应站点的域名地址，示例：https://cn3-auth.guance.com/。为保证授权生效，请输入可公网访问的站点网址。

:material-numeric-2-circle-outline: 输入工作空间 ID：

我们假定一个场景，需要把工作空间 A 的数据授权给到工作空间 B（如：DataFlux）来查看。

在观测云工作空间 B（如：DataFlux），点击**管理 > 基本设置 > 工作空间 ID**，点击**复制**，即可获得其 ID。

<img src="../img/9.dataauth_11.png" width="70%" >

:material-numeric-3-circle-outline: 选择角色：您可选择当前工作空间除 “拥有者” 以外的其他所有角色，被授权的工作空间在进行数据查看时，会根据选择的角色范围分配数据访问权限。

比如，工作空间 A 存在角色 1、角色 2，若将工作空间 A 的数据查看权限授权给工作空间 B 并指定为角色 1 和角色 2 下的权限范围，那么后续工作空间 B 的成员去查询 A 数据时，会根据 A 工作空间 的这两个角色被分配到的数据访问范围做数据列出和脱敏处理。


添加完成以后，可以在**授权列表**查看已经被授权查看当前工作空间 A 数据的工作空间 B（如：DataFlux）。

![](img/3.data_1.png)

若需要删除某条工作空间的数据授权，可点击其右侧的**删除**或选择**批量删除**。

![](img/3.data_2.png)


### 数据联动

工作空间 B（如：DataFlux）获得数据授权后，可以打开**场景 > [仪表板](../scene/dashboard.md)** 或者 **[笔记](../scene/note.md)**，选择图表组件，在**高级设置 > 空间授权**选择被授权查看的工作空间 A（如：开发-----），然后就可以通过 **[图表查询](../scene/visual-chart/chart-query.md)** 查看和分析被授权工作空间 A（如：开发-----）的数据。

![](img/9.dataauth_7.png)

<!--
<u>场景仪表板示例说明：</u>

上面三个有数据展示的图表是查询了被授权工作空间A（如：开发-----）的数据；下面三个无数据展示的图表是查询当前工作空间B（如：DataFlux），由于该工作空间无数据，所以展示无数据。

![](img/9.dataauth_8.png)
-->

### 邮件通知

添加或删除数据授权，对应工作空间的拥有者和管理员会收到邮件通知。

<img src="../img/9.dataauth_9.png" width="70%" >


### 审计事件

添加和删除数据授权都会产生审计事件。进入**管理 > 基本设置 > 安全 > 操作审计**，点击**查看**，即可查看当前工作空间所有的审计事件。

<!--
![](img/9.dataauth_12.png)
![](img/9.dataauth_11.png)
-->




