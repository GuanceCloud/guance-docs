# 数据转发至 AWS S3
---


## 开始配置


1. 存档类型选择 **AWS S3**，即表示将匹配到的日志数据保存到 S3 对象存储中；   
2. 选择[访问类型](#type)；
3. 点击确定，即可创建成功。

**注意**：若存档类型信息有变动，需确认关联平台的配置已同步更新，从而避免由于配置变化导致数据写入失败的情况。新的配置规则将在 5 分钟内生效。


## 访问类型 {#type}

### 角色授权

<img src="../../img/back-2.png" width="70%" >

1. 须使用观测云默认生成的外部 ID 配置 AWS 资源第三方访问权。

2. [在 AWS 中配置观测云 IAM 角色](../role-auth.md)后，填写存档信息，填入 AWS 账号 ID、AWS 角色名称、地区及存储桶名称。

3. 填入[存储路径](#standard)，方便后续进一步区分和查找数据转发的具体位置。

4. 点击**测试连接**，若上述信息满足规范，则提示测试连接成功。点击确定即可保存当前规则。

#### 目录路径（文件夹）命名规范 {#standard}

1. 创建单个文件夹和多层级文件夹，斜杠（/）表示创建多层级文件夹。  
2. 文件夹名称不能以斜杠（/）开头或结尾。  
3. 不能包含两个以上相邻的斜杠（/）。
4. 适用于所有访问类型。   

**注意**：

- 若填入的文件夹不存在，观测云将直接创建，数据仍会存入该路径下。
- 请谨慎变更存储路径，由于更新配置存在 5 分钟左右的延迟，变更后可能会有部分数据依然转发到原目录下。

???+ warning "若未通过测试："

    您需确认：

    - 外部 ID 是否失效；  
    - 账号 ID 是否正确；  
    - 账号角色是否存在；  
    - 存储桶是否存在；  
    - Region 是否不一致。  

    **当出现以下情况，需谨慎操作：**

    - 若您点击重新生成外部 ID，历史 ID 将于 24 小时后失效，请尽快前往 AWS 控制台替换；  
    - 不要多次点击生成外部 ID，请谨慎操作！

### Access Keys

![](../img/back-3.png)

1. 点击下载 AWS 资源授权模板，[前往 AWS 中配置观测云 IAM 策略](../ak-auth.md)。
2. 配置完成后，填写账号信息，输入 AWS AK & SK、地区及 Bucket 名称。
3. 填入[存储路径](#standard)，方便后续进一步区分和查找数据转发的具体位置。
4. 点击**测试连接**，若上述信息满足规范，则提示测试连接成功；

???+ warning "若未通过测试："

    您需确认：

    - 账号 ID 是否正确；  
    - AK / SK 是否存在；  
    - 存储桶是否存在；  
    - Region 是否不一致。  

### 账号授权

![](../img/back-2-1.png)

1. AWS 提供跨账号授权能力，您需使用观测云专属的账号 ID 并[依据配置说明](../aws-cross-account.md)添加跨账号访问授权策略。

2. 配置完成后，选择地区并输入存储桶名称。
3. 填入[存储路径](#standard)，方便后续进一步区分和查找数据转发的具体位置。

4. 点击**测试连接**，若上述信息满足规范，则提示测试连接成功。点击确定即可保存当前规则。

???+ warning "若未通过测试："

    您需确认：

    - 账号 ID 是否正确；   
    - 存储桶是否存在；  
    - Region 是否不一致。


**关于海外站点**：海外站点的账号 ID 与中国站点不同，请作区分：

| 站点 | ID |
| ---------- | ------------- |
| 中国香港 | 588271335135 |
| 俄勒冈 | 521643107266 |
| 新加坡 | 521643107266 |
| 法兰克福 | 521643107266 |
