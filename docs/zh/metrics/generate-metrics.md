# 生成指标
---

即基于当前工作空间内的现有数据生成新的指标数据，以便于依据实际业务需求设计并实现新的技术指标。

**注意**：

1. 生成指标需有**生成指标配置管理**[权限清单](../management/role-list.md)的角色可创建编辑；    
2. 指标生成以后会按照当前默认的[数据存储策略](../billing-method/data-storage.md)进行指标数据存储，并根据产生的[时间线数量](../billing-method/billing-item.md#timeline) 进行收费；    
3. 指标生成以后，若期间没数据上报，则无法在工作空间中查询和分析。

## 应用范围

日志、APM、RUM、指标和安全巡检。

## 开始新建

1. 选择数据来源；
2. 配置[数据查询](#query)条件；
3. 定义[生成指标内容](#content)，对生成指标的方式和结果进行设置，包括生成指标的周期、新生成指标的标签名称和指标集名称。

### 数据查询 {#query}

指标数据额外支持 PromQL 查询。除此之外，均支持简单查询和 DQL 查询。

> 更多详情，可参考 [图表查询](../scene/visual-chart/chart-query.md)。

:material-numeric-1-circle: 数据来源


| 来源 | 说明 |
| --- | --- |
| 日志 | 即当前工作空间已有的全部索引数据。基于选定的索引数据，筛选当前空间已有的全部/单个日志数据来源来生成新的数据，通过对现有数据添加筛选和聚合表达式，请求产生新的指标结果和数据集合。其中，`*` 表示为全部数据来源. |
| APM | 即已开启采集的服务数据来源。其中，`*` 表示为全部数据来源。 |
| RUM | 当前工作空间的应用数据来源，即已开启采集的应用名称。其中，`*` 表示为全部数据来源。 |
| 指标 | 当前工作空间的全部指标数据。 |
| 安全巡检 | 即当前工作空间已有的全部/单个类别的数据来源。安全巡检采集器开启后，类别包括 `network`，`storage`，`database`，`system`，`webserver`，`Kubernetes`。其中，`*` 表示为全部数据来源。 |

:material-numeric-2-circle: 聚合函数

| 函数 | 说明 |
| --- | --- |
| `count` | 统计个数 |
| `avg` | 统计平均值，需选择聚合的字段 |
| `max` | 统计最大值，需选择聚合的字段 |
| `min` | 统计最小值，需选择聚合的字段 |
| `P75` | 统计指定字段 75% 的值，需选择聚合的字段 |
| `P95` | 统计指定字段 95% 的值，需选择聚合的字段 |
| `P99` | 统计指定字段 99% 的值，需选择聚合的字段 |

:material-numeric-3-circle: 维度：按照所选对象进行数据聚合，即对数据请求中的每一个所选对象都生成一个统计值。

### 生成指标内容 {#content}

1. 频率：生成指标的执行周期。频率所选时间也作为聚合时间，选择频率 1 分钟，即每隔 1 分钟聚合生成一次指标，每次聚合的时间范围也是 1 分钟。

    - 1 分钟（默认），即每 1 分钟生成一次新的指标数据；
    - 5 分钟
    - 15 分钟

2. 指标集：设置指标存放的指标集的名称。 

3. 指标：设置指标的名称，其中指标名称不允许重复，可添加多个指标。 

4. 标签：根据查询中选择的维度自动生成。 

5. 单位：可选填，设置指标的单位，生成的指标设置单位后，即可在图表查询中应用。 

6. 描述：可选填，设置指标的描述，生成的指标设置描述后，即可在图表查询中应用。 

完成生成规则的填写后，点击**确定**即可完成生成指标规则并开启数据采集。

**注意**：若数据存在 1 分钟以上延迟情况时，则该数据落库后将不被统计。 

<!--

2. 时间范围：基于所选频率作为时间间隔，图表默认查询为 6 小时，即 6 小时内某数据统计展示的效果；当修改频率 >= 1 小时，查询时间范围固定为 7 天。 
-->

## 列表管理

1. 编辑：可查看全部已创建的生成指标规则，并对生成指标规则进行编辑。

    **注意**：由于生成指标规则的数据来源、聚合表达式等决定了数据类型，所以部分配置不支持编辑和修改。

2. 启用/禁用：即对规则状态进行修改。指标生成规则被禁用后，对应的数据将不会写入指标集，待启用后恢复写入。

3. 删除：即删除不需要的规则。规则被删除后，指标集不会被删除，但停止数据写入。

4. 批量操作：针对特定规则进行批量操作，包括启用、禁用和删除规则。

5. 查看指标

- 在指标分析中查看：即跳转至**指标分析**页面进行查询和分析。

- 在指标管理中查看：即跳转至**指标管理**页面查看指标和标签，您可以编辑指标单位和描述。

**注意**：生成的指标是基于您选择的频率，查询时间范围内的数据聚合生成指标，若期间无数据上报，无法生成指标，则无法在**指标**中查询或者搜索。

## 应用场景

### 在图表查询中应用

在[可视化图表](../scene/visual-chart/chart-query.md)中进行指标数据查询和分析。

![](img/generate_metrics.png)

### 在查询工具中应用

在**快捷入口 > [查询工具](../dql/query.md) > DQL 查询** 中进行指标数据查询和分析。

![](img/generate_metrics_1.png)
