# 跨工作空间索引查询
---

???+ warning "写在前面"

    为了集中管理、检索和分析各类[日志](./explorer.md)，{{{ custom_key.brand_name }}}可以通过采集日志把日志数据统一上报到{{{ custom_key.brand_name }}}工作空间，通过日志查看器来查看、检索工作空间内全部的日志内容，实现更全面的日志数据分析。

    同时，{{{ custom_key.brand_name }}}平台提供了[索引](./multi-index/index.md)功能。其为日志数据定义了分类规则，使用户能够通过不同的索引保存和存取日志，并按需数据存储策略，有效控制存储成本。

## 为什么需要跨空间获取索引？

:material-numeric-1-circle: 功能特征：

从前文中，不难获取到关于索引和日志的从属性特征：日志和索引都是针对**所属的工作空间**而言的。日志**存储在工作空间内**，索引是**针对该空间内的日志数据创建的特殊分类和存储规则**。

:material-numeric-2-circle: 业务难题：

企业出于各团队成本计算或数据资源权限控制等需求，往往会在{{{ custom_key.brand_name }}}新建多个工作空间做数据管理。此种模式下虽然实现了各部门数据分管的场景，但是不利于做数据全局分析。

:material-numeric-3-circle: 跨空间获取索引的必要性：

基于数据分管下进行数据全局分析的需求，{{{ custom_key.brand_name }}}提供了跨工作空间查询的功能，可以获取到其它空间的日志数据。

具体来说，由于日志按照索引分类，将“工作空间 1” 的索引数据授权给“工作空间 2” 后，就可以在“工作空间 2” 的日志查看器中，获取到“工作空间 1” 的索引，从而可查看到对应索引下的日志数据。

这一功能突破了日志数据存储位置的限制，能大幅度提升数据分析和故障定位的效率。

![](img/cross-workspace-index-6.png)

## 开始操作

> 场景示例：若将“工作空间 1” 的索引数据授权给“工作空间 2”，对于“工作空间 2” 来说，可调用的索引分两类：

- [当前工作空间原有的索引](#original)；
- [其它工作空间授权的索引](#others)。

### 查询本工作空间原索引 {#original}

进入“工作空间 2” 的日志查看器，左上角的“工作空间栏”默认选择当前工作空间。

左侧快捷筛选处列出本工作空间原有的所有可用索引，分别为：默认索引、日志索引、外部索引。

**注意**：外部索引为单选。

<img src="../img/cross-workspace-index.png" width="70%" >



### 查询其它工作空间授权的索引 {#others}

> 如“工作空间 2” 需要调用“工作空间 1” 的索引数据，要进行跨工作空间的索引授权分两步：

1. 在需要操作授权的工作空间（工作空间 1）进行对应的日志项及索引的授权；
2. 进入被授权的工作空间（工作空间 2）选取索引项进行应用。

> 具体操作细节，可参考 [跨工作空间授权](../management/data-authorization.md#site)。

当完成了上面两个步骤，即已经完成了“工作空间 1” 对“工作空间 2” 的索引授权，此时进入被授权的工作空间---**“工作空间 2” > 日志查看器**。

#### 选择工作空间

点击**工作空间**下拉框，可查看所有可选的工作空间。此处支持单选/多选。

???+ warning "注意"

    1. 此处的工作空间可选列表只列出满足三种情况的工作空间：属于同集群；已完成授权操作；授权的数据范围包含日志数据。
    2. 单选某个空间，会在工作空间栏直接显示出所选工作空间的名字；选择多项工作空间时，会显示为：已选 n 项，点开可查看具体选项。


![](img/cross-workspace-index-1.png)


#### 选择索引

选定工作空间后，该工作空间下的索引会在**快捷筛选**处同步列出：

???+ warning "注意"

    1. 外部索引不支持做跨工作空间查询。只有在选择当前工作空间时，才能使用外部索引。如果选择了其他工作空间，外部索引将不可用。
    2. 日志索引默认选择 `default`，当选择多个工作空间时，多空间下的所有默认索引会分到同一个 `default` 索引下。
    3. 跨工作空间授权的索引，只同步列出授权范围内的可用索引。


### 分析日志数据

**注意**：跨工作空间索引查询**只影响日志数据的获取渠道**，其他日志分析功能**不受影响**。

在日志查看器中进行了工作空间、索引的选取后，可正常使用日志查看器的原有功能，例如搜索、快捷筛选、状态图显示及分析等。

### 删除索引

如删除工作空间 1 下的索引 `whytest`，由于该索引已经授权给别的空间，在删除时会弹出确认提示，点击**确定**删除索引。

一旦确认删除，这一变更将即时影响到“工作空间 2”，相应的索引将不可用。

![](img/cross-workspace-index-2.png)
