# 数据访问
---

## 简介

为使当前工作空间内不同[成员角色](../management/role-list.md)数据查询范围更精细，观测云支持在**数据访问**页面为不同角色配置对应的日志数据访问查询范围。      


## 配置规则 {#config}   

在**日志 > 数据访问**页面，点击**新建规则**。在弹出的新建页面中，选择**索引**，设置**筛选**条件，并决定**授权**的角色对象。

> 有关索引更多相关操作，可参考文档[日志索引](../logs/multi-index.md)。   

![](img/data-1.png)

| 字段      | 描述                          |
| :---------- | :----------------------------------- |
| 索引       | 多选；当前工作空间内日志索引，包含日志默认索引、自定义索引、绑定的外部索引。  |
| 数据范围      | 不同字段之间的逻辑关系可以自定义选择 **任意(OR)** 或 **所有(AND)**；<br/>默认选中 **所有(AND)**，支持切换为**任意(OR)**：<br/><br/><u>逻辑关系示例参考如下：</u><br/>&emsp;示例 1：（默认 AND）<br/>&emsp;&emsp;host=[host1,host2] AND service = [service1,service2]；<br/>&emsp;示例 2：（切换为任意 OR）<br/>&emsp;&emsp;host=[host1,host2] OR service = [service1,service2]。<br/><br/>支持通过 `标签/属性` 进行值的筛选，包括正向筛选、反向筛选、模糊匹配、反向模糊匹配、存在和不存在等多种筛选方式。 |
| 授权给    | 多选；包含系统内默认角色及自建角色。  |


???+ info "多角色数据查询权限"

    若某成员存在多个角色（如下），且个角色查询权限覆盖范围有差异，最终该成员的数据查询权限<u>采用角色下的最高权限</u>。

    ![](img/logdata_8.png)
    

???+ info "权限控制对应关系"

    1、一个规则多个筛选之间关系：同 key 的多个值关系是 OR，不同 key 之间的关系是 AND；  
    2、多个规则之间关系为 OR。  
    
    所以，如果：  
    规则 1：host = [主机1,主机2] AND service = [服务1,服务2]   
    规则 2：host = [主机3,主机4] AND source = [来源1,来源2]  

    用户<u>同时拥有以上两条权限规则</u>，那么实际数据会显示 `规则1 OR 规则2` 来达到并集效果。

    实际可以看到数据范围是：  
    
    `（host = [主机1,主机2] AND service = [服务1,服务2]）OR （host = [主机3,主机4] AND source = [来源1,来源2]）`

### <u>示例</u>

1、在**日志 > 索引**页面，新建名为 `tcp_dial_testing` 的索引，筛选过滤条件 `source` 为 `tcp_dial_testing` 的日志数据，并设置数据存储天数为7天。     

![](img/logdata_5.png)

2、回到**数据访问**页面，点击**新建规则**，选择索引 `tcp_dial_testing`，设置筛选条件 `status` 为 `OK`，并选择拥有该日志数据查询的角色。

![](img/logdata_4.png)

3、创建完成后，即可查看该索引下数据访问权限关联的角色数量以及角色下对应的成员数量。

![](img/logdata_6.png)


???+ warning  

    - 默认角色未配置数据访问规则时，拥有所有日志的数据查询权限；
    - 基于**用户角色存在日志数据查询权限**的基础，日志数据访问的规则才能生效；
    - 角色匹配规则后，您只能在规则配置的基础范围内继续添加筛选，若超出此范围查询，则返回数据为空。


### 快照分享 {#snapshot}      

基于日志数据访问权限的支持，您可以将当前规则下过滤产生的数据作为 **[快照](../getting-started/function-details/snapshot.md)** 进行保存。快照分享后，被分享对象可以在快照页面上方搜索栏查看该数据列表的筛选条件，可以添加搜索条件，从而达到当前快照下的数据更加准确的数据分享效果。  

![](img/logdatasnapshot.png)


## 其他操作

=== "查看"

    规则配置完成后，可查看该条规则关联的**角色**数量与角色对应**成员**数量：
  
    ![](img/logdata_2.png)

=== "修改"

    点击规则右侧**修改**图标，可修改规则下的索引、筛选条件及授权角色等设置：

    ![](img/logdata_1.png)

=== "删除"

    点击规则右侧 :fontawesome-regular-trash-can: 图标，点击**确认**，即可删除该条规则：
  
    ![](img/logdata_3.png)

