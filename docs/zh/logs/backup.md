# 备份日志
---

## 简介

观测云提供日志备份的功能，筛选符合条件的日志进行备份，通过调整备份日志的存储策略，延长备份日志存储时间，帮助用户查看和分析历史日志数据。

> 观测云支持通过 [DataFlux Func](https://func.guance.com/doc/intro-guide/) 备份日志到外部存储，具体示例可参考文档 [日志数据备份到 OSS 最佳实践](../best-practices/partner/log-backup-to-oss-by-func.md) 。

## 前提条件

观测云商业版用户可使用日志备份功能，体验版用户可先 [升级商业版](../billing/commercial-version.md) 。

## 新建备份规则

在日志**索引**页面，点击**备份日志**下的**新建规则**。

![](img/5.log_backup_1.png)

在弹出的对话框，输入**规则名称**即可添加一条新的规则，

- 数据预览：预览查看最近15分钟日志；
- 规则名称：限制最多输入30个字符；
- 同步备份扩展字段：默认仅备份 message 内容到备份日志，若勾选此选项，将备份符合筛选条件的整条日志数据；
- 筛选条件：用于过滤日志，可更精准定位需要备份的日志，节省备份日志的存储费用；
    > 注意：支持添加多条筛选条件，添加后，日志备份时需要同时满足所有的筛选条件
- 条件运算符：见下表：

| 条件运算符      | 匹配类型     | 
| ------------- | -------------- | 
| in 、not in      | 精确匹配，支持多值（逗号隔开） | 
| match、not match | 模糊匹配，支持输入正则语法 | 

> 备份周期：日志备份规则创建完成后，每 5 分钟执行一次规则校验并进行备份，即配置备份规则最多 5 分钟后即可查看备份的日志数据。

![](img/5.log_backup_2.png)

### 备份日志存储策略

观测云基础日志存储最多为 60 天，通过备份日志，可延长日志的存储时间达 720 天。具体可参考文档 [数据存储策略](../billing/billing-method/data-storage.md) ；

### 备份日志计费方式

备份日志计费是全量统计，统计的是工作空间内，截止到当前在数据存储策略范围内的所有备份日志数据。计费方式如下，更多计费详情可参考文档 [计费方式](../billing/billing-method/index.md)。

| **计费项**   | **计费单元** | **价格** |
| ------------ | ------------ | -------- |
| 备份日志容量 | 每 1 GB      | 0.007 元 |

### 示例说明

在下图中，日志备份规则名称是 `http_dial_testing` ，需要同步备份扩展字段，筛选条件符合来源 `source` 是 `http_dial_testing` 的数据。

![](img/5.log_backup_3.png)

## 查看备份日志

进入**日志 > 备份日志**页面，即可查看符合备份条件的日志数据。

- [时间控件](../getting-started/function-details/explorer-search.md#time) ：通过选择时间范围筛选查看备份日志；
- [搜索和筛选](../getting-started/function-details/explorer-search.md#search) ：通过搜索关键字或者筛选字段的方式查看和分析备份日志；
- [显示列](../getting-started/function-details/explorer-search.md#columns) ：若在创建备份日志规则时，若勾选**同步备份扩展字段**，可自定义添加除了日志产生的时间和内容以外的字段，见下图；
- 备份日志详情：点击任意一条日志可查看日志的详情，包括日志产生的时间、内容和扩展字段。

![](img/5.log_backup_6.png)

若在创建备份日志规则时，不勾选**同步备份扩展字段**，备份日志仅备份日志的时间和内容，见下图。

> 注意：若创建多个备份规则，则优先匹配勾选**同步备份扩展字段**的规则，即若不同的规则命中同一条数据，则优先按照**同步备份扩展字段**的逻辑展示整条日志数据。

![](img/5.log_backup_5.png)

## 操作备份规则

备份规则创建以后，统一存储在日志索引下的**备份日志**。规则一旦创建，不可编辑，只能查看和删除。

### 查看规则

在**日志 > 索引 > 备份日志**，点击备份规则右侧的**查看**按钮，即可查看配置的备份规则筛选条件。

![](img/5.log_backup_4.png)

### 删除规则

在**日志 > 索引 > 备份日志**，点击备份规则右侧的**删除**按钮，即可删除日志备份规则。

> 注意：若需要修改创建的备份规则，可删除规则后再创建新的备份规则。规则删除后已备份的数据不会被删除，但不再产生新的日志备份数据。

![](img/7.backup_5.png)
