# 日志索引
---

观测云支持设置日志多索引，筛选符合条件的日志保存在不同的日志索引中，并通过为日志索引选择不同的数据存储策略，帮助用户节约日志数据存储费用。

???+ attention

    默认情况下，日志多索引无法设置，需要联系观测云客户经理申请开通此功能。

## 新建索引

在观测云工作空间，点击「日志」-「索引」-「新建索引」。

![](img/5.log_6.png)

在新建索引页面，输入「索引名称」，设置「过滤条件」，选择「数据存储策略」，点击「确定」即可创建一个新的索引。

- 索引名称：自定义索引的名称，索引名称必须唯一，不可修改，且已删除的索引名称不可再创建
- 过滤条件：支持 `in` 、`not in` 、`match` 、`not match` 等筛选方式
- 数据存储策略：支持选择 7 天、14 天、30 天 和 60 天

注意：

- 默认情况下，所有日志都存在一个名称为 default 的默认索引中，默认索引不允许修改和删除
- 设置日志多索引以后，日志会流入第一个匹配的索引中，同一条日志不会跨索引重复保存
- 日志多索引包括 default 索引在内，最多存在 3 个，即自定义索引最多能创建 2 个
- 标准成员和只读成员只有查看权限，管理员和拥有者可以编辑、删除、拖拽排序

![](img/6.index_2.png)

### 索引数据上报说明

在下图中，索引新建成功后，`source` 为 `datakit` 的日志数据上报时，会匹配流入第一个索引 `index.d` 。

![](img/5.log_6.png)



## 绑定索引 {#sls}

观测云商业版工作空间支持绑定外部 SLS 的索引数据，已默认开通 SLS 存储的工作空间支持绑定其他已授权开通 SLS 权限的索引数据，绑定完成后，您可以在观测云工作空间对来自 SLS 的日志数据进行查询和分析。关于如何开通 SLS 存储方案，可参考文档 [选择 SLS 存储](../billing/commercial-register.md#sls) 。

在观测云「日志」-「索引」，点击「绑定索引」。

![](img/log01.png)

在「绑定索引」页面，填写 AccessKey ID 与 AccessKey Secret 后，自动获取 Project 和 Logstore。索引名称默认与 Logstore 的名称保持一致，您也可以自定义编辑名称。点击「确定」后，即可完成索引绑定，您可以在「查看器」通过切换索引进行查看。

关于使用 SLS 授权文件给 RAM 账号授权的具体操作，可参考文档 [RAM账号授权](../billing/billing-method/sls-grant.md)。

???+ attention

    - 绑定的索引仅支持删除（删除即为取消绑定），取消绑定后则无法查询该索引下的日志；
    - 「其他索引」不能与日志索引重名，也不能与历史日志索引重名。

![](img/7.log_index_1.png)

### 字段映射

日志索引支持对绑定的外部 SLS 索引进行字段映射。您可以在绑定索引时直接为 SLS 日志的字段进行映射（见上图），原字段 `date` 默认映射为 `time` ，且默认填充 `_docid` 和 `message` 两个映射字段。例如：您可以将原字段 `logid` 映射为 `_docid` 、原字段 `content` 映射为 `message` 。字段映射可以帮助您聚类分析您的日志数据，更多详情可参考文档 [日志查看器聚类分析](explorer.md) 。

您也可以在「绑定索引」-「其他索引」，选择需要修改字段映射的索引，点击「编辑」，修改该索引的映射字段。

???+ attention

    - 每个索引的映射规则不相通，各自独立保存；
    
    - 若某条日志存在 `_docid` 字段，又映射了一个相同字段，则原日志中的 `_docid` 不生效；
    
    - 若在某部分日志中，您将 `xxx` 映射给 `_docid` ，但在这部分日志中， `xxx` 的 `value` 不唯一，则只取其中一条日志展示。

## 操作索引

### 禁用/启用

在日志索引右侧「操作」菜单下，支持「启用/禁用」当前自定义的索引。

???+ attention

    - 禁用索引后，后续日志不会再进入该索引，会继续匹配流入其他索引进行保存，若无匹配其他索引，则保存在默认 default 索引中；
    
    - 启用索引后，后续日志会重新进入该索引进行保存。

### 编辑

在日志索引右侧「操作」菜单下，点击「编辑」图标，即可编辑已经创建的日志索引。在下图中，当前索引 `index.da` 新建成功后，`source` 为 `datakit` 的日志数据上报时，会匹配流入到第一个符合的索引进行保存。

注意：变更存储策略会删除索引中的数据，请谨慎操作。

![](img/6.index_3.png)

### 删除

在日志索引右侧「操作」菜单下，点击「删除」图标，即可删除已经创建的日志索引。

注意：删除索引会同时删除该索引中的日志数据，且不能再创建同名称的索引，若无其他匹配索引，后续上报的日志数据会保存在默认索引 default 中。

![](img/6.index_4.png)

### 拖拽

在日志索引右侧「操作」菜单下，点击「拖拽」图标，即可上下拖拽已经创建的日志索引。

???+ attention

    日志会流入第一个匹配到的索引中，改变索引顺序可能会导致日志更改流向。


## 示例 {#example}

在日志索引，配置索引过滤条件为 `source` 为 `df_diagnose` 。

![](img/5.log_4.png)

点击索引，即可跳转到日志查看器，查看对应的日志数据。

![](img/5.log_5.png)

或者您可以在「日志」-「查看器」选择不同的索引查看对应的日志内容。

![](img/5.log_3.1.png)
