# 计费方式
---


## 概览

当您开通观测云商业版工作空间开始使用后，观测云提供按量付费的计费方式。本文主要介绍观测云产品按量付费的详细信息，其中包括费用组成的 [计费周期](#cycle) 、[结算方式](#account) 、[计费项](#item) 、[计费价格](#price) 、[计费模式](#method) 、[计费示例](#example) 。

## 计费周期 {#cycle}

观测云计费周期为“天”，即根据工作空间当天统计的使用量在次日零点结算，生成每日账单同步到观测云 [费用中心](../../billing/cost-center/index.md) ，最终根据实际绑定结算方式从对应账中扣除消费金额。

## 结算方式 {#account}

观测云支持观测云企业账号、云账号等多种结算方式，云账号结算包括阿里云账号和AWS账号结算，在云账号结算模式下支持多个站点的云账单合并到一个云账号下进行结算。具体结算方式说明详见 [观测云结算方式](../../billing/billing-account/index.md) 。

## 计费项 {#item}

观测云的所有计费项都是单独计费的，例如您上报的日志数据会产生日志存储的费用，您上报的应用性能链路追踪数据会产生应用性能 Trace 相关费用。

???+ attention

    - 观测云计费项的统计范围可以分为 "增量统计"、"全量统计"，不同的计费项对应的统计范围都有区别。详细逻辑请参考 [统计范围](#count)
    
    - 观测云指标数据收费按照 "时间线" 的数量计费，详细逻辑请参考 [时间线示例](#time-example)
    
    - 您可以在观测云工作空间付费计划与账单查看前一天的各计费项的统计数据、历史账单、使用统计趋势等信息。

### 统计范围 {#count}

**全量统计**

当前工作空间下，统计截止到当前在数据存储策略范围内的所有数据数量。

注意：观测云不同类型数据的数据保存策略支持自定义选择，详细信息请参考 [数据存储策略](../../billing/billing-method/data-storage.md) 。

**增量统计**

当前工作空间下，统计当天产生的数据数量。

### 计费项说明

观测云详细计费项如下所示，具体价格详见 [计费价格](#price) 。

| **计费项**       | **计费说明**                                                 | **统计范围** | **计费类型** |
| ---------------- | ------------------------------------------------------------ | ------------ | ------------ |
| DataKit          | 统计工作空间内历史存活了 12 小时及以上且当天仍然存活的 DataKit 数量，存活时间从 DataKit 启动开始计算<br><br>**注意：**<br><li>DataKit 数量统计的是在 24 小时内的最大值<li>主机安装 DataKit 开启采集数据后，变更主机名 `host_name` 会默认新增加一台主机，故在这个计费周期内会被统计为 2 台主机进行收费。 | 增量统计     | 基础计费     |
| 时间线           | 统计工作空间内所有指标数据产生的时间线数量<br><br>**注意：**指标数据是由时间、指标集、指标、标签等四部分组成，单个指标集的时间线数量等于某段时间内当前指标集下共存在多少种标签组合决定。观测云工作空间的时间线数量 = 工作空间下所有指标集的时间线总和。详情可参考 [时间线示例](#time-example) 。 | 全量统计     | 基础计费     |
| 网络（主机）     | 统计工作空间内当天有网络数据上报的主机（host）数量           | 增量统计     | 基础计费     |
| 日志类数据       | 统计工作空间内当天上报的日志类数据的数量<br>统计数据范围：<br><li>日志数据<br><li>自建节点拨测数据（ `source= [‘http_dial_testing',‘tcp_dial_testing’,'icmp_dial_testing','websocket_dial_testing'] `且 `owner != default` ）<br><li>安全巡检<br><li>事件数据<br>- 监控、智能巡检产生事件（`source=monitor`）<br>- 用户自定义上报事件（`source=custom`）<br><br>**注意：**超大的日志数据会拆分成多条进行计费，根据不同的存储方式计算逻辑不同，包括 ES 存储和 SLS 存储。<br><li>ES 存储：日志大小超过 10 KB，日志计费的条数 = 取整数（日志大小 / 10 KB）<br><li>SLS 存储：日志大小超过 2 KB，日志计费的条数 = 取整数（日志大小 / 2 KB）更多存储方式说明可参考文档 [数据存储策略](../../billing/billing-method/data-storage.md) 。 | 增量统计     | 梯度计费     |
| 备份日志容量     | 统计工作空间内备份日志的存储容量                             | 全量统计     | 基础计费     |
| 应用性能 Trace   | 统计工作空间内当天上报的应用性能唯一的 trace_id 数量<br>统计数据范围：应用性能链路追踪的 trace 数据 | 增量统计     | 梯度计费     |
| 应用性能 Profile | 统计工作空间内当前上报的应用性能 Profile 数量<br>数据统计范围：Profile 基础数据 + 每个 Profile 分析文件数据<br><br>**注意：**超大的 Profile 分析文件数据会拆分成多条进行计费。<br><li> Profile 分析文件数据小于 300 KB，按 1 计数<br><li> Profile 分析文件数据大于 300 KB，计费条数 = 取整数（Profile 分析文件大小 / 300 KB） | 增量统计     | 梯度计费     |
| 用户访问 PV      | 统计工作空间内当天上报的用户访问的页面浏览数量<br>统计数据范围：用户访问的 view 数据 | 增量统计     | 梯度计费     |
| 可用性拨测       | 统计工作空间内当天上报的拨测数据数量（仅统计观测云提供的拨测节点返回数据）<br>统计数据范围：`source= [‘http_dial_testing',‘tcp_dial_testing’,'icmp_dial_testing','websocket_dial_testing'] `的拨测数据 | 增量统计     | 基础计费     |
| 任务调度         | 统计工作空间内当天产生的任务调用的次数<br>统计数据范围：监控器定时检测任务、生成指标定时任务、告警通知发送均会产生任务调用 | 增量统计     | 基础计费     |
| 短信             | 统计工作空间内当天发送的短信数量                             | 增量统计     | 基础计费     |

## 计费价格 {#price}

### 基础计费

| **计费项**   | **计费单元** | **价格** |
| ------------ | ------------ | -------- |
| DataKit      | 每 1 台      | 3 元     |
| 时间线       | 每 1000 条   | 3 元     |
| 网络（主机） | 每 1 台      | 2 元     |
| 备份日志容量 | 每 1 GB      | 0.007 元 |
| 可用性拨测   | 每 1 万次    | 1 元     |
| 任务调用     | 每 1 万次    | 1 元     |
| 短信         | 每 10 次     | 1 元     |

### 梯度计费

观测云支持您为不同的数据类型选择不同的 [数据存储策略](../../billing/billing-method/data-storage.md) ，梯度计费是根据您选择的数据存储策略来进行计费统计。

#### 日志类数据 {#log}

| **计费项**   | **计费单元** | **梯度价格** |        |       |        |
| ------------ | ------------ | ------------ | ------ | ----- | ------ |
| 数据存储策略 |              | 7 天         | 14 天  | 30 天 | 60 天  |
| 日志类数据   | 每百万条     | 1.2 元       | 1.5 元 | 2 元  | 2.5 元 |

注意：日志类数据的保存策略最终根据日志的数据保存策略来确定单价。

#### 应用性能 Trace {#trace}

| **计费项**       | **计费单元** | **梯度价格** |        |        |
| ---------------- | ------------ | ------------ | ------ | ------ |
| 数据存储策略     |              | 3 天         | 7 天   | 14 天  |
| 应用性能 Trace   | 每百万个     | 2 元         | 3 元   | 6 元   |
| 应用性能 Profile | 每 1 万条    | 0.2 元       | 0.3 元 | 0.5 元 |

#### 用户访问 PV {#pv}

| **计费项**   | **计费单元** | **梯度价格** |      |       |
| ------------ | ------------ | ------------ | ---- | ----- |
| 数据存储策略 |              | 3 天         | 7 天 | 14 天 |
| 用户访问 PV  | 每 1 万个    | 0.7 元       | 1 元 | 2 元  |

## 计费模式 {#method}

SaaS 按量计费模式下，用户可根据上报数据的特性自由选择出账模式。

???+ tip

    大客户请 [**:material-phone-message-outline:联系客户经理**](https://www.guance.com/aboutUs/contact) 咨询详情 
### 默认出账逻辑 {#default}

根据上述列出的计费项计算当天账单，DataKit、时间线均收费。该模式下，每台 DataKit 会默认自带 300 条免费时间线。所以实际时间线的数量会扣除免费的数量后才计费。计算逻辑如下：

- 计费时间线数量 = 时间线数量 - DataKit数量 * 300
- 计费时间线数量账单 = （时间线数量 - DataKit数量 * 300）/ 1000 * 单价。

注意：若计算得出的计费时间线数量 <= 0，则按照 0 条计算。

### 仅时间线+数据出账逻辑 {#time-data}

该模式下 DataKit 不收费，且没有免费时间线逻辑。除了DataKit、时间线的计费逻辑变更之外，其他的数据计费项逻辑不变。计算逻辑如下：

- 计费时间线数量 = 时间线数量
- 计费时间线数量账单 = 时间线数量  / 1000 * 单价


### 出账逻辑 {#gradient}

- 计费项账单 = 计费单元数量 * 单价
- 计费项单元数量 = 实际统计数量 / 计费单元（注意：此处结果值不做进位处理，保留数值小数点后两位）

## 计费示例 {#example}

### 时间线数量测算示例 {#time-example}

**基础概念**

指标数据是由时间、指标集、指标、标签等四部分组成，单个指标集的时间线数量等于某段时间内当前指标集下共存在多少种标签组合决定。观测云工作空间的时间线数量 = 工作空间下所有指标集的时间线总和。

**统计指标集的时间线**

DataKit 采集主机、K8s集群指标数据产生时间线估算：

| 指标集   | 指标                                               | 时间线估算                                        |
| -------- | -------------------------------------------------- | ------------------------------------------------- |
| 主机     | 每台主机单磁盘、单网卡                             | 大约 20 ~ 30 条时间线                             |
| K8S 集群 | 16 个 Node<br>300 个 POD<br>指标数据保存策略:14 天 | 大约 6409 条时间线<br>![](../img/2.billing_1.png) |

您也可以根据以下的示例来估算您的时间线数据：

假设您从两台主机（ `host: A` 和 `host: B` ）同时采集指标 `http_response` ，用来监测应用的访问情况。这里有两个标签：

- `host` ：包括 `host: A` 和 `host: B` 
- `status_code` ：包括 `status_code: 200` 、`status_code: 404` 和 `status_code: 500`

假设 `host: A` 有两条请求返回了状态码， `host: B` 有三条请求返回了状态码，见如下示意图：

<img src="../img/3.billing_time_1.png" width=800px />

根据以上的示意图，指标集  `http_response` 将会产生 5 条时间线。

```
 host: A ， status_code: 200 
 host: A ， status_code: 404 
 host: B ， status_code: 200 
 host: B ， status_code: 404 
 host: B ， status_code: 500 
```

**基于标签的变化统计指标集的时间线**

基于以上的示意图，我们为指标集  `http_response` 增加一个标签 `url` ，包括 2 个值 `https://docs.guance.com/` 和 `https://www.guance.com/` ，那么指标集  `http_response` 将会产生 10 条时间线（即 5*2=10 ） 。

```
 host: A ， status_code: 200 ， url: https://docs.guance.com/
 host: A ， status_code: 200 ， url: https://www.guance.com/
 host: A ， status_code: 404 ， url: https://docs.guance.com/
 host: A ， status_code: 404 ， url: https://www.guance.com/
 host: B ， status_code: 200 ， url: https://docs.guance.com/
 host: B ， status_code: 200 ， url: https://www.guance.com/
 host: B ， status_code: 404 ， url: https://docs.guance.com/
 host: B ， status_code: 404 ， url: https://www.guance.com/
 host: B ， status_code: 500 ， url: https://docs.guance.com/
 host: B ， status_code: 500 ， url: https://www.guance.com/
```

基于以上的示例，我们再为指标集  `http_response` 增加一个标签 `host_ip`  ，由于 `host_ip` 和 `host` 的值都是一一对应的，那么指标集  `http_response` 不会产生更多的时间线，即虽然增加了一个标签属性，但还是只产生 10 条时间线。

```
 host: A ， status_code: 200 ， url: https://docs.guance.com/ ， host_ip: 192.168.0.1
 host: A ， status_code: 200 ， url: https://www.guance.com/ ， host_ip: 192.168.0.1
 host: A ， status_code: 404 ， url: https://docs.guance.com/ ， host_ip: 192.168.0.1
 host: A ， status_code: 404 ， url: https://www.guance.com/ ， host_ip: 192.168.0.1
 host: B ， status_code: 200 ， url: https://docs.guance.com/ ， host_ip: 192.168.0.2
 host: B ， status_code: 200 ， url: https://www.guance.com/ ， host_ip: 192.168.0.2
 host: B ， status_code: 404 ， url: https://docs.guance.com/ ， host_ip: 192.168.0.2
 host: B ， status_code: 404 ， url: https://www.guance.com/ ， host_ip: 192.168.0.2
 host: B ， status_code: 500 ， url: https://docs.guance.com/ ， host_ip: 192.168.0.2
 host: B ， status_code: 500 ， url: https://www.guance.com/ ， host_ip: 192.168.0.2
```

### 其他费用相关示例

假设A公司使用观测云对公司的 IT 基础设施、应用系统等进行整体观测。

#### 示例一

假设A公司总共有10台主机，每天产生 500 条时间线，200 万条日志数据，200 万个 Trace 数据，2 万个 PV 数据，以及 2 万次任务调度，使用的数据存储策略如下：

| 计费项       | 指标（时间线） | 日志 | 应用性能 Trace | 用户访问 PV |
| ------------ | -------------- | ---- | -------------- | ----------- |
| 数据存储策略 | 3 天           | 7 天 | 3 天           | 3 天        |

采用 [默认出账逻辑](#default) ，每天的费用为 39.8 元，具体明细如下：

| 计费项   | 日计费数量 | 计费单价        | 计费逻辑                                                     | 日计费费用 |
| -------- | ---------- | --------------- | ------------------------------------------------------------ | ---------- |
| 主机     | 10 台      | 3 元 / 台       | (实际统计数量 / 计费单元) * 单价<br/>即 （10台 / 1 台） * 3 元 | 30 元      |
| 时间线   | 500 条     | 3 元 / 千条     | （时间线数量 - DataKit数量 * 300）/ 1000 * 单价。<br>即 （500 条 - 10 台 * 300 条） / 1000 条 * 3 元 | 0 元       |
| 日志     | 200 万条   | 1.2 元 / 百万条 | (实际统计数量 / 计费单元) * 单价<br>即 （2 百万 / 1 百万） * 1.2 元 | 2.4 元     |
| Trace    | 200 万个   | 2 元 / 百万个   | (实际统计数量 / 计费单元) * 单价<br/>即 （2 百万 / 1 百万） * 2 元 | 4 元       |
| PV       | 2 万个     | 0.7 元 / 万个   | (实际统计数量 / 计费单元) * 单价<br/>即 （2 万 / 1 万） * 0.7 元 | 1.4 元     |
| 任务调度 | 2 万次     | 1 元 / 万次     | (实际统计数量 / 计费单元) * 单价<br/>即 （2 万 / 1 万） * 1 元 | 2 元       |

注意：由于时间线为全量计费项，所以时间线的变化可能会导致时间线数量增加而产生费用，更多时间线数量测算可参考文档 [时间线示例](#time-example) 。



#### 示例二

假设A公司总共有10台主机，每天产生 500 条时间线，200 万条日志数据，200 万个 Trace 数据，2 万个 PV 数据，以及 2 万次任务调度，使用的数据存储策略如下：

| 计费项       | 指标（时间线） | 日志 | 应用性能 Trace | 用户访问 PV |
| ------------ | -------------- | ---- | -------------- | ----------- |
| 数据存储策略 | 3 天           | 7 天 | 3 天           | 3 天        |

采用 [仅时间线+数据出账逻辑](#time-data) ，每天的费用为 11.3 元，具体明细如下：

| 计费项   | 日计费数量 | 计费单价        | 计费逻辑                                                     | 日计费费用 |
| -------- | ---------- | --------------- | ------------------------------------------------------------ | ---------- |
| 主机     | 10 台      | /               | /                                                            | /          |
| 时间线   | 500 条     | 3 元 / 千条     | 时间线数量  / 1000 * 单价<br>即 500 条 / 1000 条 * 3 元      | 1.5 元     |
| 日志     | 200 万条   | 1.2 元 / 百万条 | (实际统计数量 / 计费单元) * 单价<br>即 （2 百万 / 1 百万） * 1.2 元 | 2.4 元     |
| Trace    | 200 万个   | 2 元 / 百万个   | (实际统计数量 / 计费单元) * 单价<br/>即 （2 百万 / 1 百万） * 2 元 | 4 元       |
| PV       | 2 万个     | 0.7 元 / 万个   | (实际统计数量 / 计费单元) * 单价<br/>即 （2 万 / 1 万） * 0.7 元 | 1.4 元     |
| 任务调度 | 2 万次     | 1 元 / 万次     | (实际统计数量 / 计费单元) * 单价<br/>即 （2 万 / 1 万） * 1 元 | 2 元       |

注意：由于时间线为全量计费项，所以时间线的变化可能会导致时间线数量增加而产生费用，更多时间线数量测算可参考文档 [时间线示例](#time-example) 。

