# 计费方式
---

**2023.4.20 更新日志：**

1、观测云自研时序数据库 GuanceDB 全新上线，时序数据存储及计费将会做如下调整：

- 基础设施（DataKit）计费项下线，原 “DataKit + 时间线”、“仅时间线” 两种计费模式按照仅 GuanceDB 时间线作为出账逻辑使用；

- GuanceDB 时间线：统计当天活跃的时间线数量计费，单价低至 ￥0.6 / 每千条时间线。详细计费相关参考[时间线说明](#timeline)；
  
2、用户访问监测 **会话重放** 正式启动付费，按照实际采集会话重放数据的 Session 数量计费，￥10 /每千个 Session。详细计费相关参考 [Session 说明](#session)。

**您也许想了解：**

<div class="grid cards" markdown>

- [<font color="coral"> :fontawesome-solid-arrow-up-right-from-square: &nbsp; 观测云自研时序数据库 GuanceDB</font>](../billing-method/gauncedb.md)

<br/>

</div>


<div class="grid cards" markdown>

- [<font color="coral"> :fontawesome-solid-arrow-up-right-from-square: &nbsp; 时间线计费项说明</font>](../billing-method/timeline.md)

<br/>

</div>

## 简介

当您开通观测云商业版工作空间开始使用后，观测云提供<font color=coral>按量付费</font>的计费方式。本文主要介绍<u>观测云产品按量付费的详细信息，其中包括费用组成的 [计费周期](#cycle) 、[结算方式](#account) 、[计费项](#item) 、[计费示例](#example)</u>。


## 概念先解

| 名词   | 说明 |
| -------- | ---------- |
| 数据存储策略   | 观测云支持用户对不同的数据类型自定义设置保存时长。对应的保存时长选项配置可参考 [数据存储策略](data-storage.md)。|
| 全量统计   | 统计当前某计费项<u>数据存储策略周期内</u>对应数据的数量。 |
| 增量统计   | 统计<u>当天</U>某计费项对应数据的<u>增加数量</u>。具体估价方式可参考下面[日志价格示例](#exapmle)。 |
| 基础计费   | 某个计费项的单价为<u>固定值</u>。 |
| 梯度计费   | 某个计费项的单价为<u>动态值</u>，会根据当前数据类型选择的数据存储策略有<u>不同的单价值</u>。 |

## 计费周期 {#cycle}

观测云计费周期为<font color=coral>天</font>，即根据工作空间当天统计的使用量在次日零点结算，生成每日账单同步到观测云[费用中心](../../billing/cost-center/index.md)，最终根据实际绑定结算方式从对应账中扣除消费金额。

## 结算方式 {#account}

观测云支持观测云费用中心账号、云账号等多种结算方式，云账号结算包括阿里云账号、AWS 账号结算和华为云账号结算，在云账号结算模式下支持多个站点的云账单合并到一个云账号下进行结算。

> 具体结算方式说明详见 [观测云结算方式](../../billing/billing-account/index.md)。

## 统计范围 {#count}

**全量统计**

![](../img/all.png)


**增量统计**

![](../img/add.png)

> 观测云不同类型数据的数据保存策略支持自定义选择，详细信息请参考 [数据存储策略](../../billing/billing-method/data-storage.md)。

## 计费项 {#item}

观测云的所有计费项都是单独计费的，例如您上报的日志数据会产生日志存储的费用，您上报的应用性能链路追踪数据会产生应用性能 Trace 相关费用。

观测云<u>详细计费项及其对应的统计范围和计费类型</u>如下所示：

![](../img/billing-1.png)

<font color=coral>**注意：**</font>您可以在观测云工作空间付费计划与账单查看前一天的各计费项的统计数据、历史账单、使用统计趋势等信息。

### 时间线 {#timeline}

即用于统计用户当天通过 DataKit 上报的指标数据中，所有指标对应的标签组合数量。

观测云的时序引擎存储数据主要涉及到以下几个基本概念：

| 名词   | 说明 |
| -------- | ---------- |
| 指标集   | 一般意义上用于表示某种统计值对应的一个集合，从原理上讲更像关系型数据库中的 `table` 概念。 |
| 数据点   | 应用于指标数据上报场景则指代一条指标数据样本，具体可类比关系型数据库中的 `row` 数据。 |
| 时间   | 时间戳，代表数据点产生的时间，这里也可以理解为 DataKit 采集到某条指标数据产生行协议上报的时间。 |
| 指标   | Field，一般情况下存放的是会随着时间戳的变化而变化的数值类型的数据。例如我们在 CPU 指标集中常见的 `cpu_total`,`cpu_use`,`cpu_use_pencent` 等都是指标。 |
| 标签   | Tags，一般存放的是并不随着时间戳变化的属性信息。例如我们在 CPU 指标集中常见的 `host`、`project` 等字段都是标签属性，用来标识指标的实际对象属性。 |


#### <u>示例</u> {#exapmle}

![](../img/billing-2.png)

以上图为例，指标集 CPU 中基于单个指标存在共 6 个数据点，每个数据点都有一个时间字段：`time`，一个指标：`cpu_use_pencent`，两个标签：`host`、`project`。第一行和第四行数据都是 `host` 名称是 `Hangzhou_test1` 且 `project` 归属于 Guance 的 CPU 使用率（`cpu_use_pencent`）情况，依此类推第二行和第五行表示 `host` 名称是 `Ningxia_test1` 且 `project` 归属于 Guance 的 CPU 使用率，第三行和第六行 `host` 名称是 `Singapore_test1` 且 `project` 归属于 Guance_oversea 的 CPU 使用率。

根据上述时间线的统计数据，基于 `cpu_use_pencent` 这个指标的时间线组合一共有 3 种，分别是：

`"host":"Hangzhou_test1","project":"Guance"`      
`"host":"Ningxia_test1","project":"Guance"`       
`"host":"Singapore_test1","project":"Guance_oversea"`       

依此类似如需统计当前工作空间内所有的指标的时间线，只需将实际统计到指标的时间线数量求和即可得到。

#### 计费产生

通过 DataKit 采集指标数据上报到某个工作空间。特指 DQL 中 NameSpace 为 **M** 查询得到的数据。

#### 定价模式

| **增量统计**   |        |        |         |       |      |      |  |
| ------------ | ------------ | ------ | ------ | ----- | ------- | ------ |------ |
| 数据存储策略 |    |3 天         | 7 天   | 14 天  | 30 天 |     180 天   |    360 天     |
| 单价(每千条)   | <font color=coral>**中国站（中国区）**</font> | ￥ 0.6     | ￥ 0.7 | ￥ 0.8  |  ￥ 1  |    ￥ 4    |    ￥ 7    |
|    | <font color=coral>**中国站（海外区-俄勒冈）**</font> | ￥ 1.6     | ￥ 1.8 | ￥ 2.2  |  ￥ 2.4  |    ￥ 8    |    ￥ 14    |
|    | <font color=coral>**国际站**</font> | $ 0.23        | $ 0.26 | $ 0.32  |  $ 0.35  |    $ 1.2   |    $ 2   |

#### 计费项统计

以每小时的时间间隔统计<u>当天内</u>新增的时间线数量，最终得到 24 个数据点之后，取最大值作为实际计费数量。

#### 费用计算公式

天费用 = 实际计费数量 / 1000 * 单价（根据上面数据存储策略应用对应单价）

### 日志类数据

即日志、事件、安全巡检、可用性拨测等功能使用产生的数据。

???+ attention

    - 日志若开启了 “自定义多索引” 功能，则会根据不同的索引统计当日数据增量，并对应数据存储策略的单价计算实际费用；    
    - 事件包含监控模块（监控器、SLO）配置检测任务产生的事件、智能巡检上报的事件、用户自定义上报的事件；     
    - 可用性拨测由自建拨测节点上报的拨测数据；        
    - 事件、安全巡检、可用性拨测这几类数据的费用默认取日志 “默认” 索引的数据存储策略对应单价计。     

#### 计费产生

以下任意一种情况发生都会产生对应的日志类数据：

- 开启日志数据采集并上报；

- 开启监控器、智能巡检、SLO 等异常检测任务配置或通过 OpenAPI 上报自定义事件；

- 开启可用性拨测任务，并通过自建拨测节点触发上报的拨测数据。

#### 定价模式

|  **增量统计**  |    |    |        |         |       |       | 
| ------------ | ------------ | ------------ | ------ | ------ | ----- | ------ |
| 数据存储策略 |    |3 天         | 7 天   | 14 天  | 30 天 | 60 天  |
| 单价(每百万条)   |  <font color=coral>**中国站（中国区）**</font>| ￥ 1        |   ￥ 1.2 | ￥ 1.5  | ￥ 2  | ￥ 2.5   |
|    |  <font color=coral>**中国站（海外区-俄勒冈）**</font>| ￥ 2        |   ￥ 2.4 | ￥ 3 | ￥ 4  | ￥ 5   |
|    |  <font color=coral>**国际站**</font>| $ 0.3        |   $ 0.4 | $ 0.5  | $ 0.6  | $ 0.8   |

#### 计费项统计

即以每小时的时间间隔统计<u>1小时内</u>新增的日志类数据数量，最终得到 24 个数据点之后，求和后作为实际计费数量。

???+ attention

    <u>根据选择不同的存储类型，超大的日志数据会拆分成多条进行计费</u>：

    **ES 存储**：日志大小超过 10 KB，该条日志计费的条数 = 取整数（日志大小 / 10 KB）

    **SLS 存储**：日志大小超过 2 KB，该条日志计费的条数 = 取整数（日志大小 / 2 KB）

    若单条数据小于上述限制，则还是按照 1 条计算。

#### 费用计算方式

天费用 = 实际计费数量 / 1000000 * 单价（根据上面数据存储策略应用对应单价）

### 备份日志数据 {#backup}

#### 计费产生

观测云控制台可以配置备份规则将上报的日志数据同步做备份操作，匹配到备份规则的数据将会存储到备份日志的索引，观测云基于该索引下数据统计备份日志的容量大小。

#### 定价模式

| **全量统计**   |  |   |
| -------- | ---------- | ---------- |
| 单价(每 GB)   |  <font color=coral>**中国站（中国区）**</font>   | ￥ 0.007 |
|   |  <font color=coral>**中国站（海外区-俄勒冈）**</font>   | ￥ 0.014 |

#### 计费项统计

以每小时的时间间隔统计<u>数据存储策略内</u>备份日志的容量大小，最终得到 24 个数据点之后，取最大值作为实际计费数量。默认容量单位：Bytes。

#### 费用计算公式

天费用 = 实际计费容量 / 1000000000 * 对应单价

### 网络

工作空间内 ebpf 上报网络数据中统计到的 host 的数量。

#### 计费产生

- 开启 ebpf 网络数据采集

#### 定价模式

| **增量统计**   |  |   |
| -------- | ---------- | ---------- |
| 单价(每台主机)   | <font color=coral>**中国站（中国区）**</font> |  ￥ 2 |
|    | <font color=coral>**中国站（海外区-俄勒冈）**</font> |  ￥ 4 |
|    | <font color=coral>**国际站**</font> |  $ 0.6 |

#### 计费项统计

以每小时的时间间隔统计<u>当天内</u>新增的 host 数量，最终得到 24 个数据点之后，取其中最大值作为实际计费数量。

#### 费用计算公式

天费用 = 实际计费数量 * 对应单价

### 应用性能 Trace

统计上报的链路数据中的 Trace 的数量，一般情况下如果 Span 数据中 `trace_id` 相同，这些 Span 都会被归类到一个 Trace 下面。

#### 计费产生

- 开启应用性能监测(APM) 数据采集

#### 定价模式

|  **增量统计**  |  |   |     |
| -------- | ---------- | -------- | ---------- |
| 数据存储策略 |     |3 天         | 7 天   |
| 单价(每百万个)   |  <font color=coral>**中国站（中国区）**</font>       | ￥ 2 |  ￥ 3  |
|   |  <font color=coral>**中国站（海外区-俄勒冈）**</font>       | ￥ 6 |  ￥ 10  |
|    |  <font color=coral>**国际站**</font>       | $ 0.9 |  $ 1.4 |

#### 计费项统计

以每小时的时间间隔统计1小时内新增的 `trace_id` 数量，最终得到 24 个数据点之后，求和后作为实际计费数量。

#### 费用计算公式

天费用 = 实际计费数量 / 1000000 * 对应单价

### 应用性能 Profile

统计上报的应用性能 Profile 数据数量。

####  计费产生

- 开启应用性能监测 Profile 数据采集

#### 定价模式

| **增量统计**   |  |   |     |   |
| -------- | ---------- | -------- | ---------- | ---------- |
| 数据存储策略 |     |3 天         | 7 天   | 14 天  |
| 单价(每万条)   |<font color=coral>**中国站（中国区）**</font> |￥0.2 |  ￥ 0.3  |  ￥ 0.5|
|    |<font color=coral>**中国站（海外区-俄勒冈）**</font> |￥0.4 |  ￥ 0.6  |  ￥ 1|
|    |<font color=coral>**国际站**</font> |$ 0.06 |  $ 0.09  |  $ 0.14|

#### 计费项统计

以每小时的时间间隔统计1小时内新增的 Profile 数据数量，最终得到 24 个数据点之后，求和作为实际计费数量。

???+ attention

    Profile 数据主要有两部分组成：**基础属性数据** + **Profile 分析文件**：

    若存在超大的 Profile 分析文件，那么 Profile 数据会被拆分成多条进行计费。

    Profile 分析文件数据大于 300 KB，计费条数 = 取整数（Profile 分析文件大小 / 300 KB）

    若分析文件小于上述限制，则还是按照 1 条计算。

#### 费用计算公式

天费用 = 实际计费数量 / 10000 * 对应单价

### 用户访问 PV

统计上报的用户访问的页面浏览数量，一般是通过统计 View 数据中的 `view_id` 数量得出。

<font color=coral>**注意：**</font>不管是 SPA（单页应用） 还是 MPA（多页应用），用户在每访问一次页面（包含刷新或者重新进入）都算做 1 个 PV。

#### 计费产生

- 开启用户访问监测（RUM）采集

#### 定价模式

| **增量统计**   |  |   |     |   |
| -------- | ---------- | -------- | ---------- | ---------- |
| 数据存储策略 |     |3 天         | 7 天   | 14 天  |
| 单价(每万个)   | <font color=coral>**中国站（中国区）**</font> | ￥ 0.7 | ￥ 1  |  ￥ 2|
|    | <font color=coral>**中国站（海外区-俄勒冈）**</font> | ￥ 2 | ￥ 3  |  ￥ 5|
|    | <font color=coral>**国际站**</font> | $ 0.29 | $ 0.43  |  $ 0.71|

#### 计费项统计

以每小时的时间间隔统计1小时内新增的 PV 数据数量，最终得到 24 个数据点之后，求和作为实际计费数量。

#### 费用计算公式

天费用 = 实际计费数量 / 10000 * 单价（*根据上面数据存储策略应用对应单价*）

### 会话重放 Session {#session}

统计有实际产生会话回放数据的 Session 的数量。一般通过统计 Session 数据中存在 `has_replay: 
true` 的 `session_id` 数量得出。

#### 计费产生

- 开启会话回放采集

#### 定价模式

| **增量统计**   |  |    |
|-------- | ---------- |---------- |
| 单价(每千个)   |  <font color=coral>**中国站（中国区）**</font>   | ￥ 10 |
|    |  <font color=coral>**中国站（海外区-俄勒冈）**</font>   | ￥ 15.4 |
|    |  <font color=coral>**国际站**</font>   | $ 2.2 |

#### 计费项统计

以每小时的时间间隔统计当天内新增的 Session 数量，最终得到 24 个数据点之后，取最大值作为实际计费数量。

???+ attention

    若存在超长活跃的 Session，那么 Session 会根据 `time_spent` 拆分成多条进行计费。

    Session time_spent > 4  小时，计费数量 = 取整数（time_spent / 4 小时）；

    若 Session time_spent 小于上述 4 小时，则还是按照 1 个 Session 计算。

#### 费用计算公式

天费用 = 实际计费数量 / 1000 * 对应单价

### 可用性拨测次数

#### 计费产生

- 开启可用性拨测任务并通过观测云提供的拨测节点返回拨测结果
  
#### 定价模式

| **增量统计**   |  |    |
|-------- | ---------- |---------- |
| 单价(每万次)   |  <font color=coral>**中国站（中国区）**</font>  | ￥ 1 |
|    |  <font color=coral>**中国站（海外区-俄勒冈）**</font>  | ￥ 10 |
|    |   <font color=coral>**国际站**</font>  |  $ 1.43 |

#### 计费项统计

以每小时的时间间隔统计1小时内新增的拨测数据数量，最终得到 24 个数据点之后，求和后作为实际计费数量。

???+ attention

    因为目前拨测数据是存储在日志的 **默认** 索引的，所以 DQL 查询或统计需要增加以下筛选条件查询拨测数据。
    
    `index = ['default'], source = [‘http_dial_testing',‘tcp_dial_testing’,'icmp_dial_testing','websocket_dial_testing']`。

#### 费用计算公式

天费用 = 实际计费数量 / 10000 * 对应单价

### 任务调用次数

#### 计费产生

- 开启监控器、SLO 等定时检测任务；  
- 开启生成指标；             
- 开启告警通知发送；        
- 选择中心 Func 提供的高级函数查询。       

#### 定价模式

| **增量统计**   |  |     |
|-------- | ---------- |---------- |
| 单价(每万次)   | <font color=coral>**中国站（中国区）**</font>   |  ￥ 1 |
|   | <font color=coral>**中国站（海外区-俄勒冈）**</font>   |  ￥ 2 |
|    |  <font color=coral>**国际站**</font>  |  $ 0.3 |

#### 计费项统计

以每小时的时间间隔统计 1 小时内新增的任务调用次数，最终得到 24 个数据点之后，求和作为实际计费数量。

#### 费用计算公式

天费用 = 实际计费数量 / 10000 * 对应单价

### 短信发送次数

统计当天发送的短信的数量。

#### 计费产生

- 告警策略配置短信通知发送

#### 定价模式

| **增量统计**   |  |   |
|-------- | ---------- |---------- |
| 单价(每 10 次)   | <font color=coral>**中国站（中国区）**</font>   |  ￥ 1 |

#### 计费项统计 

以每小时的时间间隔统计1小时内新增的短信发送次数，最终得到 24 个数据点之后，求和作为实际计费数量。

#### 费用计算公式

天费用 = 实际计费数量 / 10 * 单价


## 计费示例 {#example}

假设A公司使用观测云对公司的 IT 基础设施、应用系统等进行整体观测。

假设A公司总共有 10 台主机（每台主机默认日活跃时间线为 600），每天产生 6000 条时间线，200 万条日志数据，200 万个 Trace 数据，2 万个 PV 数据，以及 2 万次任务调度，使用的数据存储策略如下：

| 计费项       | 指标（时间线） | 日志 | 应用性能 Trace | 用户访问 PV |
| ------------ | -------------- | ---- | -------------- | ----------- |
| 数据存储策略 | 3 天           | 7 天 | 3 天           | 3 天        |

具体明细如下：

| 计费项   | 日计费数量 | 计费单价        | 计费逻辑                                                     | 日计费费用 |
| -------- | ---------- | --------------- | ------------------------------------------------------------ | ---------- |
| 时间线   | 6000 条     | 0.6 元 / 千条     | （实际计费数量 / 1000) * 单价<br>即 （6000 条 / 1000 条） * 0.6 元 | 3.6 元       |
| 日志     | 200 万条   | 1.2 元 / 百万条 | (实际统计数量 / 计费单元) * 单价<br>即 （2 百万 / 1 百万） * 1.2 元 | 2.4 元     |
| Trace    | 200 万个   | 2 元 / 百万个   | (实际统计数量 / 计费单元) * 单价<br/>即 （2 百万 / 1 百万） * 2 元 | 4 元       |
| PV       | 2 万个     | 0.7 元 / 万个   | (实际统计数量 / 计费单元) * 单价<br/>即 （2 万 / 1 万） * 0.7 元 | 1.4 元     |
| 任务调度 | 2 万次     | 1 元 / 万次     | (实际统计数量 / 计费单元) * 单价<br/>即 （2 万 / 1 万） * 1 元 | 2 元       |

<font color=coral>**注意：**</font>由于时间线为增量计费项，所以该公司产生时间线的数量变化会导致费用变化。

> 更多时间线数量测算可参考文档 [时间线示例](#timeline)。


## 更多阅读

<div class="grid cards" markdown>

- [<font color="coral"> :fontawesome-solid-arrow-up-right-from-square: &nbsp; 时序数据库深入浅出之存储篇</font>](https://www.infoq.cn/article/storage-in-sequential-databases)

<br/>

</div>


