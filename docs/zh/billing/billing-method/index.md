# 计费方式
---


## 概览

当您开通观测云商业版工作空间开始使用后，观测云提供按量付费的计费方式。本文主要介绍观测云产品按量付费的详细信息，其中包括费用组成的 [计费周期](#cycle) 、[结算方式](#account) 、[计费项](#item) 、[计费价格](#price) 、[计费模式](#method) 、[计费示例](#example) 。

## 计费周期 {#cycle}

观测云计费周期为“天”，即根据工作空间当天统计的使用量在次日零点结算，生成每日账单同步到观测云 [费用中心](../../billing/cost-center/index.md) ，最终根据实际绑定结算方式从对应账中扣除消费金额。

## 结算方式 {#account}

观测云支持观测云企业账号、云账号等多种结算方式，云账号结算包括阿里云账号和AWS账号结算，在云账号结算模式下支持多个站点的云账单合并到一个云账号下进行结算。具体结算方式说明详见 [观测云结算方式](../../billing/billing-account/index.md) 。

## 计费项 {#item}

观测云的所有计费项都是单独计费的，例如您上报的日志数据会产生日志存储的费用，您上报的应用性能链路追踪数据会产生应用性能 Trace 相关费用。

???+ attention

    - 观测云计费项的统计范围可以分为 "增量统计"、"全量统计"，不同的计费项对应的统计范围都有区别。详细逻辑请参考 [统计范围](#count)
    
    - 观测云指标数据收费按照 "时间线" 的数量计费，详细逻辑请参考 [时间线示例](#time-example)
    
    - 您可以在观测云工作空间付费计划与账单查看前一天的各计费项的统计数据、历史账单、使用统计趋势等信息。

### 统计范围 {#count}

**全量统计**

当前工作空间下，统计截止到当前在数据存储策略范围内的所有数据数量。

注意：观测云不同类型数据的数据保存策略支持自定义选择，详细信息请参考 [数据存储策略](../../billing/billing-method/data-storage.md) 。

**增量统计**

当前工作空间下，统计当天产生的数据数量。

### 计费项说明

观测云详细计费项如下所示，具体价格详见 [计费价格](#price) 。

| **计费项**     | **计费说明**                                                 | **统计范围** | **计费类型** |
| -------------- | ------------------------------------------------------------ | ------------ | ------------ |
| DataKit        | 统计工作空间内当天所有存活时长已经超过 12 小时及以上的 DataKit 数量<br><br>**注意：**主机安装 DataKit 开启采集数据后，变更主机名`host_name`会默认新增加一台主机，原主机名会继续在「基础设施」-「主机」列表中显示，一个小时后不会继续上报数据，直到24小时未上报数据后从列表中移除。由于 DataKit 数量是在24小时内取最大值，故在这个计费周期内会被统计为2台主机进行收费。 | 增量统计     | 基础计费     |
| 时间线         | 统计工作空间内所有指标数据产生的时间线数量<br><br>**注意：**指标数据是由时间、指标集、指标、标签等四部分组成，单个指标集的时间线数量等于某段时间内当前指标集下共存在多少种标签组合决定。观测云工作空间的时间线数量 = 工作空间下所有指标集的时间线总和。详情可参考 [时间线示例](#time-example) 。 | 全量统计     | 基础计费     |
| 日志类数据     | 统计工作空间内当天上报的日志类数据的数量<br>统计数据包含：<br><li>日志数据<br><li>自建节点拨测数据（ `source= [‘http_dial_testing',‘tcp_dial_testing’,'icmp_dial_testing','websocket_dial_testing'] `且 `owner != default` ）<br><li>安全巡检<br><li>事件数据<br>- 监控、智能巡检产生事件（`source=monitor`）<br>- 用户自定义上报事件（`source=custom`）<br><br>**注意：**超大的日志数据会拆分成多条进行计费，根据不同的存储方式计算逻辑不同，包括 ES 存储和 SLS 存储。<br><li>ES 存储：日志大小超过 10 KB，日志计费的条数 = 取整数（日志大小 / 10 KB）<br><li>SLS 存储：日志大小超过 2 KB，日志计费的条数 = 取整数（日志大小 / 2 KB）更多存储方式说明可参考文档 [数据存储策略](../../billing/billing-method/data-storage.md) 。 | 增量统计     | 梯度计费     |
| 备份日志容量   | 统计工作空间内备份日志的存储容量                             | 全量统计     | 基础计费     |
| 应用性能 Trace | 统计工作空间内当天上报的应用性能唯一的 trace_id 数量<br><br>**注意：**一整个完整链路算一个 trace , 一条完整链路下有多个 span ，但是 span 对应的 trace_id 都是一样的，最终是按照 trace_id 的数量进行计费。 | 增量统计     | 梯度计费     |
| 用户访问 PV    | 统计工作空间内当天上报的用户访问的页面浏览数量<br>统计数据范围：用户访问的 view 数据 | 增量统计     | 梯度计费     |
| 可用性拨测     | 统计工作空间内当天上报的拨测数据数量（仅统计观测云提供的拨测节点返回数据）<br>统计数据范围：`source= [‘http_dial_testing',‘tcp_dial_testing’,'icmp_dial_testing','websocket_dial_testing'] `的拨测数据 | 增量统计     | 基础计费     |
| 任务调度       | 统计工作空间内当天产生的任务调用的次数<br>统计数据范围：监控器定时检测任务、生成指标定时任务、告警通知发送均会产生任务调用 | 增量统计     | 基础计费     |
| 短信           | 统计工作空间内当天发送的短信数量                             | 增量统计     | 基础计费     |

## 计费价格 {#price}

### 基础计费

| **计费项**   | **计费单元** | **价格** |
| ------------ | ------------ | -------- |
| DataKit      | 每 1 台      | 3 元     |
| 时间线       | 每 1000 条   | 3 元     |
| 备份日志容量 | 每 1 GB      | 0.007 元 |
| 可用性拨测   | 每 1 万次    | 1 元     |
| 任务调用     | 每 1 万次    | 1 元     |
| 短信         | 每 10 次     | 1 元     |

### 梯度计费

观测云支持您为不同的数据类型选择不同的 [数据存储策略](../../billing/billing-method/data-storage.md) ，梯度计费是根据您选择的数据存储策略来进行计费统计。

#### 日志类数据 {#log}

| **计费项**   | **计费单元** | **梯度价格** |        |       |        |
| ------------ | ------------ | ------------ | ------ | ----- | ------ |
| 数据存储策略 |              | 7 天         | 14 天  | 30 天 | 60 天  |
| 日志类数据   | 每百万条     | 1.2 元       | 1.5 元 | 2 元  | 2.5 元 |

注意：日志类数据的保存策略最终根据日志的数据保存策略来确定单价。

#### 应用性能 Trace {#trace}

| **计费项**     | **计费单元** | **梯度价格** |      |       |
| -------------- | ------------ | ------------ | ---- | ----- |
| 数据存储策略   |              | 3 天         | 7 天 | 14 天 |
| 应用性能 Trace | 每百万个     | 2 元         | 3 元 | 6 元  |

#### 用户访问 PV {#pv}

| **计费项**   | **计费单元** | **梯度价格** |      |       |
| ------------ | ------------ | ------------ | ---- | ----- |
| 数据存储策略 |              | 3 天         | 7 天 | 14 天 |
| 用户访问 PV  | 每 1 万个    | 0.7 元       | 1 元 | 2 元  |

## 计费模式 {#method}

SaaS 按量计费模式下，用户可根据上报数据的特性自由选择出账模式。

### 默认出账逻辑 {#default}

根据上述列出的计费项计算当天账单，DataKit、时间线均收费。该模式下，每台 DataKit 会默认自带 300 条免费时间线。所以实际时间线的数量会扣除免费的数量后才计费。计算逻辑如下：

- 计费时间线数量 = 时间线数量 - DataKit数量 * 300
- 计费时间线数量账单 = （时间线数量 - DataKit数量 * 300）/ 1000 * 单价。

注意：若计算得出的计费时间线数量 <= 0，则按照 0 条计算。

### 仅时间线+数据出账逻辑 {#time-data}

该模式下 DataKit 不收费，且没有免费时间线逻辑。除了DataKit、时间线的计费逻辑变更之外，其他的数据计费项逻辑不变。计算逻辑如下：

- 计费时间线数量 = 时间线数量
- 计费时间线数量账单 = 时间线数量  / 1000 * 单价


### 出账逻辑 {#gradient}

- 计费项账单 = 计费单元数量 * 单价
- 计费项单元数量 = 实际统计数量 / 计费单元（注意：此处结果值不做进位处理，保留数值小数点后两位）

## 计费示例 {#example}

### 时间线数量测算示例 {#time-example}

**基础概念**

指标数据是由时间、指标集、指标、标签等四部分组成，单个指标集的时间线数量等于某段时间内当前指标集下共存在多少种标签组合决定。观测云工作空间的时间线数量 = 工作空间下所有指标集的时间线总和。

**测算示例**

DataKit 采集主机、K8s集群指标数据产生时间线估算：

| 指标集   | 指标                                               | 时间线估算                                        |
| -------- | -------------------------------------------------- | ------------------------------------------------- |
| 主机     | 每台主机单磁盘、单网卡                             | 大约 20 ~ 30 条时间线                             |
| K8S 集群 | 16 个 Node<br>300 个 POD<br>指标数据保存策略:14 天 | 大约 6409 条时间线<br>![](../img/2.billing_1.png) |

**用户自定义指标集时间线估算：**

下面我们以一个示例来介绍下如何估算某个指标集的时间线数量。当前存在一个 "测试" 的指标集，指标集下共有两个标签："邮箱"、"状态"，假设当前存在 3 个不同的邮箱地址，每个邮箱地址都存在 "0"、"1"  2 种状态，那么可以得到当前 "测试" 指标集下的时间线数量为 6 （3 * 2 =6）。 

| **邮箱**         | **状态** |
| ---------------- | -------- |
| test1@guance.com | 0        |
| test1@guance.com | 1        |
| test2@guance.com | 0        |
| test2@guance.com | 1        |
| test3@guance.com | 0        |
| test3@guance.com | 1        |

若在当前指标集下新增了一个 "角色权限" 字段，因为每个邮箱都可以赋予不同的角色权限，所以每个邮箱的不同状态下都对应存在 "只读成员"、"标准成员"、"管理员" 3 种角色权限。那么可以得到当前 "测试" 指标集下的时间线数量为 18 （3 * 2 * 3 =18）。

| **邮箱**         | **状态** | **角色权限** |
| ---------------- | -------- | ------------ |
| test1@guance.com | 0        | 只读成员     |
| test1@guance.com | 0        | 标准成员     |
| test1@guance.com | 0        | 管理员       |
| test1@guance.com | 1        | 只读成员     |
| test1@guance.com | 1        | 标准成员     |
| test1@guance.com | 1        | 管理员       |
| test2@guance.com | 0        | 只读成员     |
| test2@guance.com | 0        | 标准成员     |
| test2@guance.com | 0        | 管理员       |
| test2@guance.com | 1        | 只读成员     |
| test2@guance.com | 1        | 标准成员     |
| test2@guance.com | 1        | 管理员       |
| test3@guance.com | 0        | 只读成员     |
| test3@guance.com | 0        | 标准成员     |
| test3@guance.com | 0        | 管理员       |
| test3@guance.com | 1        | 只读成员     |
| test3@guance.com | 1        | 标准成员     |
| test3@guance.com | 1        | 管理员       |

若当前指标集下又新增了一个新的标签字段 "名字"，因为 "名字" 跟 "邮箱" 字段的值都是一一对应的，那么在这种情况下，新增字段其实不会产生更多的时间线。最终统计得到的时间线仍然为 18。

| **邮箱**         | **状态** | **角色权限** | **名字** |
| ---------------- | -------- | ------------ | -------- |
| test1@guance.com | 0        | 只读成员     | test1    |
| test1@guance.com | 0        | 标准成员     | test1    |
| test1@guance.com | 0        | 管理员       | test1    |
| test1@guance.com | 1        | 只读成员     | test1    |
| test1@guance.com | 1        | 标准成员     | test1    |
| test1@guance.com | 1        | 管理员       | test1    |
| test2@guance.com | 0        | 只读成员     | test2    |
| test2@guance.com | 0        | 标准成员     | test2    |
| test2@guance.com | 0        | 管理员       | test2    |
| test2@guance.com | 1        | 只读成员     | test2    |
| test2@guance.com | 1        | 标准成员     | test2    |
| test2@guance.com | 1        | 管理员       | test2    |
| test3@guance.com | 0        | 只读成员     | test3    |
| test3@guance.com | 0        | 标准成员     | test3    |
| test3@guance.com | 0        | 管理员       | test3    |
| test3@guance.com | 1        | 只读成员     | test3    |
| test3@guance.com | 1        | 标准成员     | test3    |
| test3@guance.com | 1        | 管理员       | test3    |

### 其他费用相关示例

假设A公司使用观测云对公司的 IT 基础设施、应用系统等进行整体观测。

#### 示例一

假设A公司总共有10台主机，每天产生 500 条时间线，200 万条日志数据，200 万个 Trace 数据，2 万个 PV 数据，以及 2 万次任务调度，使用的数据存储策略如下：

| 计费项       | 指标（时间线） | 日志 | 应用性能 Trace | 用户访问 PV |
| ------------ | -------------- | ---- | -------------- | ----------- |
| 数据存储策略 | 3 天           | 7 天 | 3 天           | 3 天        |

采用 [默认出账逻辑](#default) ，每天的费用为 39.8 元，具体明细如下：

| 计费项   | 日计费数量 | 计费单价        | 计费逻辑                                                     | 日计费费用 |
| -------- | ---------- | --------------- | ------------------------------------------------------------ | ---------- |
| 主机     | 10 台      | 3 元 / 台       | (实际统计数量 / 计费单元) * 单价<br/>即 （10台 / 1 台） * 3 元 | 30 元      |
| 时间线   | 500 条     | 3 元 / 千条     | （时间线数量 - DataKit数量 * 300）/ 1000 * 单价。<br>即 （500 条 - 10 台 * 300 条） / 1000 条 * 3 元 | 0 元       |
| 日志     | 200 万条   | 1.2 元 / 百万条 | (实际统计数量 / 计费单元) * 单价<br>即 （2 百万 / 1 百万） * 1.2 元 | 2.4 元     |
| Trace    | 200 万个   | 2 元 / 百万个   | (实际统计数量 / 计费单元) * 单价<br/>即 （2 百万 / 1 百万） * 2 元 | 4 元       |
| PV       | 2 万个     | 0.7 元 / 万个   | (实际统计数量 / 计费单元) * 单价<br/>即 （2 万 / 1 万） * 0.7 元 | 1.4 元     |
| 任务调度 | 2 万次     | 1 元 / 万次     | (实际统计数量 / 计费单元) * 单价<br/>即 （2 万 / 1 万） * 1 元 | 2 元       |

注意：由于时间线为全量计费项，所以时间线的变化可能会导致时间线数量增加而产生费用，更多时间线数量测算可参考文档 [时间线示例](#time-example) 。



#### 示例二

假设A公司总共有10台主机，每天产生 500 条时间线，200 万条日志数据，200 万个 Trace 数据，2 万个 PV 数据，以及 2 万次任务调度，使用的数据存储策略如下：

| 计费项       | 指标（时间线） | 日志 | 应用性能 Trace | 用户访问 PV |
| ------------ | -------------- | ---- | -------------- | ----------- |
| 数据存储策略 | 3 天           | 7 天 | 3 天           | 3 天        |

采用 [仅时间线+数据出账逻辑](#time-data) ，每天的费用为 11.3 元，具体明细如下：

| 计费项   | 日计费数量 | 计费单价        | 计费逻辑                                                     | 日计费费用 |
| -------- | ---------- | --------------- | ------------------------------------------------------------ | ---------- |
| 主机     | 10 台      | /               | /                                                            | /          |
| 时间线   | 500 条     | 3 元 / 千条     | 时间线数量  / 1000 * 单价<br>即 500 条 / 1000 条 * 3 元      | 1.5 元     |
| 日志     | 200 万条   | 1.2 元 / 百万条 | (实际统计数量 / 计费单元) * 单价<br>即 （2 百万 / 1 百万） * 1.2 元 | 2.4 元     |
| Trace    | 200 万个   | 2 元 / 百万个   | (实际统计数量 / 计费单元) * 单价<br/>即 （2 百万 / 1 百万） * 2 元 | 4 元       |
| PV       | 2 万个     | 0.7 元 / 万个   | (实际统计数量 / 计费单元) * 单价<br/>即 （2 万 / 1 万） * 0.7 元 | 1.4 元     |
| 任务调度 | 2 万次     | 1 元 / 万次     | (实际统计数量 / 计费单元) * 单价<br/>即 （2 万 / 1 万） * 1 元 | 2 元       |

注意：由于时间线为全量计费项，所以时间线的变化可能会导致时间线数量增加而产生费用，更多时间线数量测算可参考文档 [时间线示例](#time-example) 。
