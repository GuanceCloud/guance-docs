# 服务管理

???- quote "更新日志"

    **2024.5.15**：本文档所属的一级文档由原来的【场景】迁移至【应用性能监测】。

    **2023.11.16**：【Pod】页面下线处理。

    **2023.9.7**：应用性能检测 > 服务入口与此处功能整合。

---

**服务管理**作为一个集中管理入口，以全局的视角访问和查看当前工作空间内所有服务下的关键信息；同时，其将业务属性与链路数据相串联，通过关联的仓库和文档，快速确定紧急问题的代码位置和问题解决方案。

在**应用性能监测 > 服务管理**，您可按需添加服务清单。添加完成后，支持基于[性能指标列表](#performance)、[服务清单列表](#list-deatils)以及[服务拓扑图](#service-map)三个维度进行查看。在对应列表页面，可借助全局筛选、快捷筛选、搜索、时间控件等方式快速定位至目标服务清单，缩减查询时间；还可通过保存快照随时记录查询条件；观测云提供多种设置与操作以满足服务数据查询诉求。

![](img/service-2.png)


## 添加服务清单 {#create}


![](img/service-1.png)

:material-numeric-1-circle: 服务名称：必填项，即服务的具体名称。 

:material-numeric-2-circle: 服务类型：非必填，即当前服务所属类型；选择范围包括：`app`, `framework`, `cache`, `message_queue`, `custom`, `db`, `web`。  

:material-numeric-3-circle: 颜色：非必填，即当前服务的颜色；默认随机生成，也可下拉选择。

:material-numeric-4-circle: 团队信息：非必填  

- 团队：即当前服务所属团队；可选择目前工作空间已有的团队，也可手动输入团队名称后回车创建新团队；  
- 联系方式：当前服务出现异常故障时，将第一时间联系；支持邮箱、电话、Slack 3 种渠道；若需多选，须按照逗号、分号、空格间隔。

**注意**：在当前服务清单创建成功后，此处创建的新团队会同步在**管理 > 成员管理 > 团队管理**列表中。

:material-numeric-5-circle: 关联：非必填  

- 应用：即当前服务关联的应用信息；同用户访问监测应用 ID；
- 标签：用于关联当前工作空间内其他配置信息，通过全局标签将工作空间内信息串联，支持跳转联系查看分析等操作。

:material-numeric-6-circle: 帮助链接：非必填   

- 仓库配置：依次填入显示名称、提供商名称及仓库代码 URL；          
- 帮助文档：依次填入显示名称、提供商名称及其他关联文档 URL；  
- 视图：可为当前服务关绑定所需内置视图，选定后可在当前服务联动数据查看的**分析看板**下查看绑定的内置视图。 

输入相关信息后，点击**确定**即可创建成功。

## 查看服务 {#list}

创建完成后，您可以在以下三个列表查看服务的相关参数信息：

![](img/service-3.png)

### 服务清单 {#list-deatils}

在服务清单列表，您可参考以下操作可进行管理：

1、搜索：在搜索栏，可输入关键词搜索服务名称。

2、筛选：

- 在全部列表，通过经常浏览、我的收藏和我的创建和来快速过滤查找对应的服务；

- 在列表左侧，可根据创建类型、团队、服务类型进行相应筛选。

<img src="../img/service-4.png" width="40%" >

3、在列表页：

- 应用：若填写应用与 RUM 应用 ID 一致，则支持 Hover 点击打开新页跳转到 Session 查看器；

- 团队：支持 Hover 点击打开新页，查看团队信息；

- 联系方式：支持 Hover 查看邮箱、电话、Slack 的详细信息；其中 Slack 支持跳转；

- 仓库配置 & 文档：Hover 至相应图标，点击可自动跳转至所关联的仓库或文档。

4、在**操作**：

- Hover 至头像图标，可查看该条服务的创建人、创建时间、更新人及更新时间；

- 点击 :material-dots-vertical: 按钮，可修改或删除当前服务。

5、点击 :octicons-star-24: 按钮，即可收藏当前服务。

6、点击 :material-tray-arrow-up: 按钮，即可导出当前页面数据为 JSON 文件。

7、您可以将当前页面数据保存为[快照](../getting-started/function-details/snapshot.md)。

<img src="../img/service-10.png" width="60%" >

<!--
**注意**：因**应用性能监测 > 服务**与**场景 > 服务**合二为一，历史保存的服务列表快照不在此列出，如需查看，请前往快捷入口的快照处查看。此处仅显示新创建的快照信息。

> 更多详情，可参考[快照](../getting-started/function-details/snapshot.md)。
-->
### 性能指标 {#performance}

在性能指标页面，您可以基于服务类型、环境、版本、项目和服务名称快捷筛选服务性能，从而快速定位查看服务的平均请求数、平均响应时间、P75 响应时间、P99 响应时间、错误数及关联的监控器。

在该页面列表中，相关参数数据一目了然，帮助一键排查具备潜在风险的服务。


您可参考以下操作可进行管理：

- 根据[时间控件](../getting-started/function-details/explorer-search.md#time)，选定时间范围查看对应性能数据；

- Hover 在某个特定服务，可点击 :octicons-search-16: 跳转至链路详情页；直接点击某条服务，可直接进入该服务的分析看板；

- 若监控器的标签为当前服务，可点击可跳转到对应的监控器配置页面；

- 可查看事件状态，点击状态，即可打开新页跳转到事件查看器页面。

???- warning "事件状态的注意事项"

    - 服务的状态包含**正常、紧急、重要、数据断档**。取该服务 60 天范围内最后一次未恢复事件的状态，若无则显示【正常】；
    - 此处仅包含有**链路数据上报的服务**。


![](img/service-6.gif)


### 服务拓扑 {#service-map}

在**服务拓扑**模式下，以拓扑图的形式查看各个服务之间的调用关系。

#### 拓扑图 {#map}

- 区分环境和版本：支持基于服务（`service`）和服务环境版本（`service+env+version`) 两种维度绘制链路拓扑图，开启区分环境和版本后，将按照不同的环境版本绘制服务拓扑图。例如金丝雀发布，通过开启环境和版本，即可查看不同环境版本下的服务调用情况。

- 填充：支持选择不同的性能指标请求数、P50 响应时间、P75 响应时间、P99 响应时间和错误率来查看服务节点颜色。

- 自定义区间：为选择的**填充指标**自定义服务节点颜色区间范围。节点的颜色根据最大值和最小值等分为 5 个区间，每个区间将自动对应五个不同的颜色。

- 节点尺寸：节点大小共有 3 种尺寸，对服务每秒请求数的**最大值（Max）**和**最小值（Min）**进行三等分，得出的三个区间对应 3 种图形尺寸。

**注意**：若每秒请求数 < 0.01，则直接显示为 < 0.01，但实际 ⚪ 的尺寸大小要以真实数据为准，这里只作显示（举例：查询出来的最大值为 0.009，最小值为 0.0003，都小于 0.01，则显示为 Min < 0.01，Max < 0.01，但真实的尺寸大小还是以 0.009 和 0.0003 计算）。

![](img/service-8.gif)

在拓扑图，您可以进行以下操作：

<div class="grid" markdown>

=== "节点指标数据查询"

    将鼠标悬浮在服务节点处时，对应服务高亮显示，其他无关联服务及连接线变灰，您可以查看该服务的请求数、错误率、平均响应时间、和 P99 响应时间等指标数据。

=== "自定义颜色区间"

    开启**自定义区间**为选择的**填充指标**自定义服务节点颜色区间范围。通过**填充**选择不同的性能指标请求数、P50 响应时间、P75 响应时间、P99 响应时间和错误数来查看服务节点颜色。

=== "查看缩略图"

    放大拓扑图，可在左下角查看小缩略图。

=== "查看上下游"

    点击服务图标，点击**查看上下游**，即可查看当前服务的上下游服务关联；点击左上角**返回总览**可返回到原服务拓扑图，在搜索框进行搜索或筛选可过滤关联的上下游服务，根据搜索或筛选的结果显示匹配的关联上下游服务。

=== "查看服务概览"

    点击服务图标，可查看服务概览详情。

=== "关联查询"

    点击服务图标，可查看相关日志、相关链路。

</div>

![](img/service-7.gif)

##### Service Map 查询 {#servicemap}

**前提**：所有商业版工作空间归属于同一个[组织 ID](../management/attribute-claims.md)，即 `organization` 相同。

若同一个 Trace 数据存在分流情况，数据会归属于不同的工作空间，此时无法在同一个工作空间查看完整的链路数据。而跨工作空间 Service Map 查询可保证数据查询的连贯性，直接在当前工作空间点击按钮即可查看当前服务的上下游调用拓扑。

![](img/servicemap.gif)



## 服务详情 {#details}

在各服务列表，点击某条服务，可进入其详情页。点击页面上方 tab，即可进入分析看板、资源调用、基础设施依赖、日志、链路、错误追踪、事件查看器，查询关联服务下的所有相关信息。

如您需要切换至其他服务详情，点击当前服务图标即可；在打开的窗口中，可直接输入关键词搜索：

<img src="../img/list.png" width="60%" >


### 分析看板

默认打开分析看板的概览页面。若您在[创建或编辑服务](#create)时关联了内置视图，则可切换查看：

![](img/service-5.gif)

### 资源调用

在**资源调用**，观测云会展示出资源调用排行，默认在页面右侧向您展排行首位的资源信息，包含请求数、错误率、响应时间、响应时间分布及其链路数据。您还可以基于环境和版本进行全局筛选。若出现资源信息为空的情况，观测云在页面右侧则展示该条服务的相关数据。

![](img/service-9.gif)

- 资源调用排行（TOP 20）列表支持基于请求数(默认)、错误请求数、每秒请求数、P75 响应时间和 P99 响应时间进行查询分析；您可针对对应列表选择数量进行排序，
- Hover 在某条资源，点击右侧 :fontawesome-regular-copy: 按钮，即可复制当前资源完整名称。
- 在资源右侧的详情页内，可查看其请求数、错误率、响应时间及响应时间分布。
- 可查询关联链路信息，支持[搜索](../getting-started/function-details/explorer-search.md#search)；点击**跳转**即可进入**服务管理 > 链路**页面。

#### 上下游拓扑

在资源右侧的详情页，除关联的链路数据外，您还可查看当前资源的上下游拓扑。

<img src="../img/service-9.png" width="70%" >

在上下游拓扑 Tab 页，您可以：

- 事件状态图例：从左到右，各颜色色块依次表示：数据断档、信息、警告、重要、紧急、正常。
- 在卡片上，您可以查看各资源的平均请求速率、P99 响应时间、错误请求率（请求数）和关联监控器。
- 点击卡片，则可查看相关日志、用户访问和事件；若该资源关联了监控器，则可跳转到对应监控器查看监控器配置、查看相关事件。

### 基础设施依赖

在该页面，观测云以仪表板的形式来向您展示当前服务所关联的主机、Pod 数量及对应列表。

![](img/service-11.png)

通过图表，您可快速查看主机及 Pod 的名称、状态、CPU 使用率、内存使用率、MEM 使用率等信息，及时应对风险指标。

> 有关仪表板相关操作，可参考 [图表设置](../scene/visual-chart/index.md#settings)。

### 关联查看器

|                   <font color=coral size=3>:fontawesome-regular-circle-down: &nbsp;**点击前往 Tab 页其他查看器**</font>                         |                                                              |
| :----------------------------------------------------------: | :----------------------------------------------------------: | 
| [日志查看器](../logs/explorer.md){ .md-button .md-button--primary } | [链路查看器](../application-performance-monitoring/explorer/index.md){ .md-button .md-button--primary } | 
| [错误追踪查看器](../application-performance-monitoring/error.md){ .md-button .md-button--primary } | [事件查看器](../events/event-explorer/unrecovered-events.md){ .md-button .md-button--primary } |

<!--
**注意**：因为 Pods 对象数据中并未存在 `service` 等相关字段，此处观测云使用 `deployment:服务名称` 做过滤列出。
-->

