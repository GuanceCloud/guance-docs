# 工作空间管理
---


工作空间基于多用户设计，可隔离不同单元数据。

## 新建工作空间

在工作空间列表，点击右上角**新建工作空间**。

![](img/10.admin_2.png)


### 空间信息

<img src="../img/pass-1.png" width="60%" >

1、名称：工作空间的名称；    

2、工作空间语言：可按需选择中文或英文；

3、空间拥有者：拥有工作空间最高操作权限，可以指定当前空间“管理员”并进行任意的空间配置管理，包括升级空间付费计划、解散当前空间；    



### 数据保存策略

<img src="../img/pass-2.png" width="60%" >

4、数据保存策略：即当前工作空间的数据保留时长。包含**指标、日志、数据转发-默认存储、事件、应用性能-链路、应用性能-Profile、应用访问、会话重放、安全巡检**。

除各数据类型对应的存储时长，还可选择设置自定义保存时长（<= 1800 天）。

???+ warning "配置超长存储时长注意事项："

    1. OpenSearch 或 Elasticsearch 集群配置超长的数据保留时长，除了需要预估存储空间的用量，还需要预估索引分片的数量；
    2. OpenSearch 或 Elasticsearch 集群，对于索引的分片数量默认限制是每节点 1000 分片，即假如是 3 节点的集群，分片数最大不要超过 3000 个；
    3. 分片计算方法，比如您某一个工作空间的日志索引配置是 2 副本、3 分片，每分片最大 30GB，每日的数据量大致是打满 2 个索引（即总共 180GB），数据保留 200 天，总共产生的分片数计算公式：索引副本数 * 每日索引数 * 每索引分片数 * 数据保留天数 = 2 * 2 * 3 * 200 = 2400 个分片；
    4. 如果有多个工作空间，需要将多个空间的索引分片数累加起来，同时还需要将其他数据类型的索引分片估算在内。


### 存储类型

<img src="../img/engine.png" width="60%" >

5、目前支持日志易、火山引擎 TLS数据存储引擎，选中后，日志、数据转发-默认存储、应用性能、安全巡检、事件数据将保存到当前的存储引擎内。

若您不选择数据存储引擎，则数据会保存到主存储引擎内。

### 其他 {#others}

<img src="../img/pass-3.png" width="60%" >

<!--
6、索引合并：采集的数据根据数据类型不同会创建不同的索引，索引越多数据存储量越大，为了节约数据存储空间，可开启工作空间的索引合并；    

- 索引合并开启，该工作空间按照指标、日志/CI 监测/可用性监测/安全巡检、备份日志、事件、用户访问/应用性能（trace、profile）创建对应的数据索引；    
  
*示例：索引合并开启状态下添加工作空间：*

![](img/10.admin_1.png)

- 索引合并关闭，该工作空间按照指标、日志、备份日志、事件、应用性能、用户访问、安全巡检创建对应的数据索引； 

**示例：索引合并关闭状态下添加工作空间：*

![](img/10.admin_1.1.png)

???+ warning "注意"

    - 若您选择了存储类型，则不支持开启**索引合并**操作；         
    - 调整索引合并，工作空间的对应旧索引及历史数据即将做删除操作，删除后数据将无法恢复。     
-->

6、左星查询：默认关闭，表示新创建的工作空间默认不支持左星查询；

7、自定义映射规则：默认关闭，启用该配置后，对应工作空间可以[自定义映射规则](./custom-mapping.md)。工作空间的自定义映射规则优先级大于管理后台的映射规则。

**注意**：若您在管理后台配置与工作空间内的映射规则有重合配置，则该成员角色为管理后台和工作空间分配角色合集。

8、自定义索引：默认关闭，开启后，允许该工作空间创建多个索引策略用于保存日志；

9、超大日志计数单元：用于设置超大日志的计数单元，可根据设置的计数单元拆分成多条日志进行计费；

10、查询数量上限：针对不同用户的工作空间的查询数量有定制化的限制，避免因查询数据量过大导致集群查询性能低，影响产品使用体验。设置查询上限数量后，超出的需要通过再次查询才能得出。


## 管理工作空间

### 搜索

**工作空间列表**页面可查看所有工作空间的基本信息，您可按空间名称关键字进行搜索查找。

### 索引配置

点击**索引配置**，进入对应的索引配置页面，支持针对当前工作空间的所有索引模板作**主分片**、**分片大小**、**副本分片**的调整。

![](img/10.admin_5.png)

点击数据类型右侧的**配置**按钮，支持自定义配置该数据类型的 “主分片” 、“分片大小”、“热数据保存时长”、支持是否“开启副本”以及“高级配置”。 

**注意**：

- 开启副本后，默认会给索引分片创建一份冗余的副本；

- 开启高级配置后，支持修改索引 mapping 模板配置，包含分词等相关参数修改。

### 数据上报限制 {#report-limit}

为满足工作空间内同角色的需要，观测云支持配置数据上报限制，基于“天”的维度判断某个类型数据是否触发阈值，一旦触发阈值，后续上报的数据将无法写入到数据库中，并做丢弃处理，从而节约资源使用成本。

点击**数据上报限制**，进入配置页面：


<img src="../img/report-limit-1.png" width="60%" >

如图，您可针对指标、网络（主机数量）、日志条数、应用性能 Trace 数量、应用性能 Profile 条数、用户访问 PV 数量和可用性拨测次数进行限制的配置。


**注意**：

1. 0 表示对应的数据全部都丢弃不做写入，无上限；

2. 指标、网络数据因为统计维度是时间线和网络，所以不存在数量的限制，只有开启数据写入限制和不限制两种模式。


### 查看成员

点击**查看成员**，进入对应的工作空间成员页面，可以查看到该空间下的所有成员基本信息。

您还可进行搜索、修改角色、删除等操作。


**注意**：一个工作空间只能有一个拥有者，修改其他成员为拥有者，原拥有者降级为管理员。

![](img/16.deployment_6.png)

#### 添加用户

在工作空间成员列表，点击右上角**添加用户**，选择成员并设置好权限后，点击**确定**即可在此空间中添加一名新成员。

**注意**：此处可添加成员为系统内已存在的成员，若为系统新成员，需在[**用户 > 添加用户**](./user.md#add)页面中添加成功后，再返回此处进行操作。


### 修改

可编辑该工作空间的名称、左星查询、日志多索引等设置。


### 删除

点击工作空间右侧的**删除**即可删除对应的工作空间。


