# 图表配置

---

包含观测云图表内通用的常用配置和高级配置。

## 常用配置 {#general}


### 标题

:material-numeric-1-circle: 标题：为图表设置标题名称，设置完成后，在图表的左上方显示，支持隐藏。


:material-numeric-2-circle: 描述：为图表添加描述信息，设置后图表标题后方会出现【i】的提示，不设置则不显示。


### 单位


:material-numeric-1-circle: 全局：包含不同维度下通用的单位格式，如数据大小、时间间隔、时间戳等。可在下拉框中输入自定义单位，回车后即可应用于当前图表。

:material-numeric-2-circle: 自定义：选择当前查询条件下包含的指标，输入自定义单位。


???+ abstract "关于指标数据的单位显示"

    1. 默认单位显示：

        - 若查询的数据为指标数据，且您在[指标管理](../../metrics/dictionary.md)中为指标设置了单位，则默认按照指标的单位进行进位显示；
        - 若您在**指标管理**内无相关单位配置，则按照[千分位](chart-query.md#thousand)逗号间隔的数值进位方式显示。

    2. 配置单位后：优先使用您自定义配置的单位进行进位显示。指标类数据支持针对数值提供两种选项：
        
        - 默认进位：单位为万、百万，如 10000 展示为 1 万，1000000 展示为 1 百万。保留两位小数点；
        - 短级差制：单位为 K, M, B。即以 thousand、million、billion、trillion 等依次表示中文语境下的千、百万、十亿、万亿等。如 1000 为 1 k，10000 为 10 k，1000000 为 1 million；保留两位小数点。



### 图例 {#legend}

:material-numeric-1-circle: 别名：在添加别名后，图例的名称也随之变化，方便更直观地区分相关指标。

别名支持使用模板变量实现一键替换：例如：

- {{tags}} 表示替换为所有“标签名”和“标签值”；

- {{host}} 表示替换为 host 的“标签值”。

*示例：基于指标，别名的设置会出现以下场景：*

未添加别名效果：

<img src="../../img/alias-1.png" width="60%" > 

输入纯文本替换效果：

<img src="../../img/alias-2.png" width="60%" > 

基于 by 条件输入变量 {tags}：

**注意**：当您的查询中存在 by 条件，则会为您显示返回的所有图例序列。

<img src="../../img/alias-3.png" width="60%" >

:material-numeric-2-circle: 位置：目前支持选择隐藏、底部、右侧图例（点击图例中的指标行，可隐藏/显示对应指标）。


:material-numeric-3-circle: 显示值：选择要在图例中显示的值或计算值。

时序图图例值会根据图表查询结果进行再次聚合计算，目前支持选择 `Last（最后一个值）`、`First（第一个值）`、`Avg（平均值）`、`Min（最小值）`、`Max（最大值）`、`Sum（求和）`、`Count（返回点数）`。

如下图所示：`First` 表示返回当前时序图查询结果的第一个值，`Last` 是当前时序图查询结果的最后一个值，点击图例值支持升降排序。

**注意**：`Avg` 、`Sum` 、`Count` 根据选择的时间间隔（原始间隔和自动对齐）不同，显示不同的结果。

<img src="../../img/chart030.png" width="70%" >


### 数据格式 {#data_format}

:material-numeric-1-circle: 小数位数：可选择 0、1、2、3 位小数或全精度。

:material-numeric-2-circle: 千分位分隔符：默认开启；关闭后将显示原始值，无分隔符。

观测云仪表板图表查询结果支持自动加上数据千分位格式显示。

![](../img/13.table_1.png)

若设置了单位，则按照设置的单位显示数据格式。

![](../img/13.table_2.png)

设置完成后可以在预览的情况下按照千分位数据格式显示，若设置单位则按照单位设置格式显示。

- 千分位数据格式显示：

<img src="../../img/13.table_4.png" width="70%" >

- 设置的数据格式显示：

<img src="../../img/13.table_5.png" width="70%" >


## 高级配置

### 锁定时间

即固定当前图表查询数据的时间范围，不受全局时间组件的限制。设置成功后的图表右上角会出现用户设定的时间，如【xx分钟】、【xx小时】、【xx天】。假设锁定时间间隔 30 分钟，即便调整了右上角的时间控件，当前图表仍只会显示最近 30 分钟数据。 


### 规则映射 

即为不同的列设置指标范围和对应的背景颜色、字体颜色。在范围内的指标将按设置的样式进行显示。

设置指标范围及映射值，当指标值在设置的数据范围内时将显示为对应的映射值。

当指标值同时满足多个设置时，显示为最后一个满足条件的设置样式。

设置值映射时，【显示为】和【颜色】都不是必选/必填项：

- 【显示为】默认为空，即代表不做映射值显示；
- 【颜色】默认为空，即不做颜色映射显示其原本颜色。

### 字段映射

在实际业务场景下，如果需要查询的字段和前段显示的字段不一致，可开启图表中的字段映射。配合视图变量的对象映射功能，默认关闭。

开启字段映射后，图表显示查询的**分组字段**和对应的**映射字段**，未指定映射的分组字段不显示。



### 空间授权

启用后，即可在当前工作空间的当前图表下查询外部工作空间的数据。 

在图表下方，可在被授权的工作空间下拉框中选定目标工作空间进行查询。



### 数据采样

仅针对 Doris 日志数据引擎的工作空间。

开启后，会对除“指标”外的其他数据进行采样查询，采样率不固定，会根据数据量大小动态调整。 


### 时间偏移

由于非时序数据在入库后存在至少 1 分钟的查询延迟。选择相对时间查询时，可能导致最近几分钟的数据未能被采集，从而出现数据丢失的情况。

启用时间偏移后，当查询相对时间区间时，实际查询时间范围向前偏移 1 分钟，以防止入库延迟导致数据获取为空。如：当前为 12:30，查询最近 15 分钟的数据，开启时间偏移后，实际查询的时间是：12:14-12:29。

???+ warning "注意事项"

    1. 该设置仅针对相对时间生效，若查询时间区间为“绝对时间范围”，时间偏移不生效。
    2. 针对有时间间隔的图表，如时序图，设定时间间隔超出 1min 则时间偏移不生效，<= 1m 的情况下才偏移生效。针对没有时间间隔的图表，如概览图、柱状图等，时间偏移保持生效。





