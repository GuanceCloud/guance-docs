# 热力图
---

热力图是一种数据可视化工具，它通过颜色的变化来表示数据的密度或强度，常用于展示数据在特定场景中的分布情况。观测云将热力图应用于多种监控和分析场景，可视化展示聚合数据。

![](../img/scene_heatmap.png)

## 常用配置

### 标题

1. 标题：为图表设置标题名称，设置完成后，在图表的左上方显示，支持隐藏。
2. 描述：为图表添加描述信息，设置后图表标题后方会出现【i】的提示，不设置则不显示。 

### 颜色

1. 渐变区间

- 自动：
 
    - 可选择包含从 2～100 的等级数量，系统默认为 60；
    - 包含 4 种渐变色系；
    - 支持自定义最大值和最小值，如不设置，自动获取返回数据的最大最小值计算。

- 自定义：可选择包含从 2～5 的等级数量，系统默认为 5。


### [图例](./timeseries-chart.md#legend)

1. 添加别名，图例的名称也会随之变化；
2. 选择图例位置，包含直接隐藏或置于图表底部。


### 单位

???+ abstract "关于指标数据的单位显示"

    :material-numeric-1-circle: 默认单位显示：

    - 若查询的数据为指标数据，且您在[指标管理](../../metrics/dictionary.md)中为指标设置了单位，则默认按照指标的单位进行进位显示；
    - 若您在**指标管理**内无相关单位配置，则按照[千分位](chart-query.md#thousand)逗号间隔的数值进位方式显示。

    :material-numeric-2-circle: 配置单位后：优先使用您自定义配置的单位进行进位显示。指标类数据支持针对数值提供两种选项：
    
    - 默认进位：单位为万、百万，如10000 展示为 1 万，1000000 展示为 1 百万。保留两位小数点；
    - 短级差制：单位为 K, M, B。即以 thousand、million、billion、trillion 等依次表示中文语境下的千、百万、十亿、万亿等。如 1000 为 1 k，10000 为 10 k，1000000 为 1 million；保留两位小数点。


- 全局：

包含不同维度下通用的单位格式，如数据大小、时间间隔、时间戳等。

在该模式下，还可在下拉框中选择输入自定义单位，回车后即可应用于当前图表。


- 自定义：选择当前查询条件下包含的指标，输入自定义单位。



### 数据格式

1. 小数位数：可选择 0、1、2、3 位小数或全精度。

2. [千分位分隔符](../visual-chart/chart-query.md#thousand)：千位分隔符默认开启，关闭后将显示原始值，无分隔符。

## 高级配置 {#advanced-setting}

### 时间

1. 锁定时间：即固定当前图表查询数据的时间范围，不受仪表板或其他全局时间组件的限制。设置成功后，当前图表直接展示您设定的时间，如【xx分钟】、【xx小时】、【xx天】。

2. 时间间隔：即图表查询数据的计算间隔（`interval`）。
    - 自动对齐：开启后，将按选择的时间范围和聚合时间间隔动态的调整查询，根据计算的时间间隔就近向上取整。
    - 指定时间：按所选 `interval` 执行查询，当和“最大返回点数” 冲突时，会优先按“时间范围/按最大点数”调整 `interval`；包含 10 秒、20 秒、30 秒、1 分钟、5 分钟、10 分钟、30 分钟、1 小时、6 小时、12 小时、1 天、7 天和 30 天。

3. 最大返回点数：即每个序列的最大数据点数，可任意输入 2～1000 之间的任意整数，若您没有自定义，默认限制最大点数为 720。

**注意**：基于已选择的时间间隔，若查询范围过大，超过了最大点数，此时会按照最大点数计算 `interval` 并取整返回数据。

### 字段映射

配合视图变量的对象映射功能，默认为关闭，若在视图变量已配置对象映射：

- 开启字段映射时，图表显示查询的**分组字段**和对应的**映射字段**，未指定映射的分组字段不显示；
- 关闭字段映射时，图表正常显示，不显示映射的字段。

### 空间授权

启用后，即可在当前工作空间的当前图表下查询外部工作空间的数据。 

在图表下方，可在被授权的工作空间下拉框中选定目标工作空间进行查询。



### 数据采样

仅针对 Doris 日志数据引擎的工作空间。

开启后，会对除“指标”外的其他数据进行采样查询，采样率不固定，会根据数据量大小动态调整。 


### 时间偏移

由于非时序数据在入库后存在至少 1 分钟的查询延迟。选择相对时间查询时，可能导致最近几分钟的数据未能被采集，从而出现数据丢失的情况。

启用时间偏移后，当查询相对时间区间时，实际查询时间范围向前偏移 1 分钟，以防止入库延迟导致数据获取为空。如：当前为 12:30，查询最近 15 分钟的数据，开启时间偏移后，实际查询的时间是：12:14-12:29。

???+ warning "注意事项"

    1. 该设置仅针对相对时间生效，若查询时间区间为“绝对时间范围”，时间偏移不生效。
    2. 针对有时间间隔的图表，如时序图，设定时间间隔超出 1min 则时间偏移不生效，<= 1m 的情况下才偏移生效。针对没有时间间隔的图表，如概览图、柱状图等，时间偏移保持生效。


## 更多阅读

<font size=3>

<div class="grid cards" markdown>

- [<font color="coral"> :fontawesome-solid-arrow-right-long: &nbsp; **图表查询**</font>](./chart-query.md)

</div>

<div class="grid cards" markdown>

- [<font color="coral"> :fontawesome-solid-arrow-right-long: &nbsp; **图表链接**</font>](./chart-link.md)

</div>

<div class="grid cards" markdown>

- [<font color="coral"> :fontawesome-solid-arrow-right-long: &nbsp; **图表 JSON**</font>](./chart-json.md)

</div>

</font>