# 时序图

---

## 简介

时序图一般用于显示数据在相等时间间隔下的趋势变化，同时可以用来分析多组指标数据之间的作用及影响。

## 应用场景

- 查看应用性能指标数据在一定时间范围内的趋势变化，如在最近 15 分钟内应用“请求数”的趋势变化；
- 查看用户访问指标数据在一定时间范围内的趋势变化，如在不同的时间范围内用户访问“错误数”的发生情况；  
- 查看固定时间范围内的相似趋势指标；
- 查看数据波动异常时触发的相关事件。

## 图表查询

图表查询支持**简单查询**、**表达式查询**、**DQL 查询**、**Promql 查询**，图表查询条件详细说明请点击 [图表查询](chart-query.md) 进行查看，默认添加简单查询。每个查询预设 5 种返回结果数量，包括 5、10、20、50、100 ，默认返回 20 条数据，支持手动输入，最多为 100 条数据。

## 图表链接

链接可以帮助实现从当前图表跳转至目标页面。您可以添加平台内部链接或外部链接，能通过模板变量修改链接中对应的变量值将数据信息传送过去，实现数据联动。

> 相关设置说明可前往 [图表链接](chart-link.md) 进行查看。

## 事件关联

通过**添加筛选字段**匹配与选定字段相关的异常事件，从而达到时序数据与事件关联显示的目的。这个功能可以帮助用户在查看趋势的同时，感知数据波动期间是否有相关事件产生，以帮助用户从另一个视角定位问题。

> 相关设置说明请点击 [事件关联](events-relative.md) 进行查看。

## 图表样式

| 选项 | 说明 |
| --- | --- |
| 图表标题 | 为图表设置标题名称，设置完成后，在图表的左上方显示，支持隐藏。 |
| 图表类型 | 包含折线图、柱状图和面积图（默认选中折线图）。 |
| 堆叠显示 | 仅支持柱状图，默认关闭，开启后，右侧出现“方式”选项，包含时序、百分比：<br /><li>时序：将每根柱子进行分割，以显示大类目下的细分类目占比情况，统计每个分组下不同指标的大小；<br /><li>百分比：柱子的各个层代表的是该类别数据占该分组总体数据的百分比，每个系列按照所占的百分比进行堆积。 |
| 颜色 | 设置图表数据的显示颜色，支持自定义手动输入预设颜色，输入格式为：聚合函数(指标){"标签": "标签值"}，如 `last(usage_idle){"host": "guance_01"}`。 |
| 别名 | <li>支持对分组后的查询添加别名，在添加别名后，图例的名称也随之变化，方便更直观的区分相关指标。<br><li>支持自定义手动输入预设别名，输入格式为：聚合函数(指标){"标签": "标签值"}，如 `last(usage_idle){"host": "guance_01"}`。 |
| 图例 | 用于直观显示各指标数据的名称、数量及占比情况。目前支持选择底部、右侧、隐藏图例（点击图例中的指标行，可隐藏/显示对应指标）。 |
| 仅显示分组 | 默认关闭，开启后，图例中仅显示**标签值**，不再显示聚合函数和指标名等。 |



## 图表设置

### 基本设置

| 选项 | 说明 |
| --- | --- |
| 单位 | 1、支持为查询结果设置单位。<br />1）若查询的数据无单位，在图表设置单位后，按照设置的单位在图表上展示；<br />2）若查询的数据自带单位，或者您在 [指标管理](../../metrics/dictionary.md) 中为指标设置了单位，并在图表设置单位后，按照在图表设置的单位在图表上展示；<br />3）若查询的数据无单位，且在图表不设置单位，则按照科学计数自动计算图表Y轴数值；按照 [千分位](chart-query.md#thousand) 的格式在图表上展示原始数值。<br /> **科学计数说明**<br />默认查询结果值自动转换单位，展示遵循【科学计数 K、M、B】（1千 = 1K，100万 = 1M，10亿 = 1B），保留两位小数点；人民币自动转换单位【元、万、亿】，保留两位小数点。<br />*例如：单位的时间间隔选择单位为 ns，那么按照数据的大小，查询结果只自动转换单位效果如下，以此类推：*<br /><li>1000000ns：图表查询数据结果显示为1ms<br /><li>1000000000ns：图表查询数据结果显示为1s<br /><li>10000000000ns：图表查询数据结果显示为1m<br /><br>2、支持为查询结果预设单位，手动输入格式为：聚合函数(指标)，如 `last(usage_idle)`。 |
| Y 轴 | 支持自定义 Y 轴的最大值和最小值。 |
| 基线设置 | 支持添加基线值、基线标题以及基线颜色。 |

### 高级设置 {#advanced-setting}

| 选项 | 说明 |
| --- | --- |
| 锁定时间 | 支持锁定图表查询数据的时间范围，不受全局时间组件的限制。设置成功后的图表右上角会出现用户设定的时间，如【xx分钟】、【xx小时】、【xx天】。如锁定时间间隔 30 分钟，那么当调节时间组件无论查询什么时间范围视图，仍只会显示最近 30 分钟数据。 |
| 时间间隔 | <li>原始间隔：根据时间组件的时间范围默认查询显示数据；<br /><li>自动对齐：开启后，将按选择的时间范围和聚合时间间隔动态的调整查询，根据计算的时间间隔就近向上取整。（*例如：自动聚合算法计算出时间间隔是 50 秒，那么实际将按照 1 分钟的时间间隔发起查询*）<br /> &nbsp; &nbsp; &nbsp;系统预设了多种时间间隔：1毫秒、10毫秒、50毫秒、100毫秒、500毫秒、1秒、5秒、15秒、30秒、1分钟、5分钟，10分钟、30分钟、1小时，6小时，12小时、1天、1周、1月；<br /><li>自定义时间间隔：当选择【锁定时间】时，根据锁定时间的长短，自动匹配不同的可选时间间隔查询显示数据。（*例如：时间间隔选择 1 分钟，那么实际将按照 1 分钟的时间间隔发起查询*）<br />:warning: 当时间间隔为【1天】时，时间对齐显示为 0 点。 |
| 显示密度 | 包括【较低：60个点】、【低：180个点】、【中：360个点】、【高：720个点】；默认显示【中】。<br />逻辑规则如下：（*例如查询出 100 个点*）<br /><li>当查询点数低于“密度点数”时，直接返回；（*例如：选中【低】密度，100<180，直接返回查询出来的 100 个点*）；<br /><li>当查询点数超出“密度点数”时，返回密度点数；（*例如：选中【较低】密度，100>60，处理后返回 60 个点*）；<br />:warning: 若选择“锁定时间”并选择“时间间隔”，显示密度置灰，不能选择。<br /> |
| 图表说明 | 为图表添加描述信息，设置后图表标题后方会出现【i】的提示，不设置则不显示。 |
| 同期对比 |  与上一同等时间的数据进行对比。默认显示为关闭状态，开启同期对比后，对比维度支持 4 个选项：小时（与一小时前对比）、日（与一天前对比）、周（与一周前对比）、月（与一个月前对比）。<br /><br />支持多选，更多详情可参考 [同期对比](time-comparison.md)。 |
| 字段映射 | 配合视图变量的对象映射功能，默认为关闭，若在视图变量已配置对象映射：<br /><li>开启字段映射时，图表显示查询的**分组字段**和对应的**映射字段**，未指定映射的分组字段不显示；<br /><li>关闭字段映射时，图表正常显示，不显示映射的字段。<br /> |
| 折线混合图 | 仅支持柱状图。 |
| 工作空间 | 被授权的工作空间列表；选择后即可通过图表查询并展示该工作空间数据。 |

## 图表分析

时序图是以时间顺序为索引的二维图，横轴为时间刻度，纵轴为数据刻度。基于选择的时间范围，时序图将绘制对象数据在该时间段内的趋势变化。

<font color=coral>**注意：**</font>时序图一条查询语句最多返回 10 条时间线，即根据分组（group by）条件的结果，超过 10 条时间线的数据按照顺序只显示 10 条时间线。

![](../img/f4.png)

### 时间轴功能

同时，在分析模式下，观测云提供了时间轴功能，即您不仅能够通过图表下方的时间轴预览对象数据和时间的交互变化，而且能够拖动选择展示的时间范围。时间轴范围是以选定的时间范围为查询周期，向前固定三个查询周期，向后最多固定一个查询周期（截止到当前的时间点）。

例如：

- 当前时间点为11:00，时间范围选择「最近1小时」，那么时间轴范围为「8:00 - 11:00」。
- 当前时间点为11:00，时间范围选择「10:00-10:40」（查询周期为40分钟），那么时间轴范围为「8:40 - 11:00」。

![](../img/f3.png)

#### 相似趋势指标 {#similar}

在时序图的分析模式下，选中时序图的趋势线/柱，可**查看相似趋势指标**。

**查看相似趋势指标** 是以您框选的时间范围为绝对时间，查询空间内相似的指标趋势。您可以

- 在时序图上，点击图表并拖动鼠标选定搜索的时间范围；
- 点击“按钮”，搜索相似趋势结果；
- 点击查询结果，进入“相似趋势指标”详情页。

![](../img/18.shixutu_1.png)

#### 相似趋势结果

基于选定的绝对时间范围，查询结果列表包括：

- 来源：存在相似趋势的指标集；
- 相似数量：对应“指标集”下相似趋势的图表数量；
- 预览：相似趋势图表的预览图。

![](../img/18.shixutu_2.png)

<font color=coral>**注意：**</font>

- 查询**相似区间**时默认当前选定的时间范围为“绝对时间”，不会因任何外部的作用或观察者改变。如果您需要更改时间范围，您需要重新调节时间范围；

- 进入**相似区间**页面后，单击拖动矩形可调整搜索的时间范围，如果已经选择了一个区域，您仍可以移动或者调整选择的时间范围；

- 拖动至新的时间范围后，您需要 确定/取消 更换时间范围。

  

### 图例功能

图例功能用于直观显示各指标数据的名称、数量及占比情况，目前支持选择隐藏、底部、右侧三种方式。

时序图图例值会根据图表查询结果进行再次聚合计算，目前支持选择 `Last（最后一个值）`  、`First（第一个值）`、 `Avg（平均值）`、 `Min（最小值）`、 `Max（最大值）`、 `Sum（求和）`、 `Count（返回点数）` 。

如下图所示：`First` 表示返回当前时序图查询结果的第一个值，`Last` 是当前时序图查询结果的最后一个值，点击图例值支持升降排序。

<font color=coral>**注意：**</font>`Avg` 、`Sum` 、`Count` 根据选择的时间间隔（原始间隔和自动对齐）不同，显示不同的结果。

![](../img/chart030.png)

## 示例图

下图为最近 15 分钟主机 CPU 使用的趋势变化。

- 折线图

![](../img/8.scene_time_1.png)

- 柱状图

![](../img/8.scene_time_3.png)

- 面积图

![](../img/8.scene_time_2.png)

