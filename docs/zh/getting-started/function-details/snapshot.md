# 提升协作效率的快照
---


观测云快照支持为场景仪表板、基础设施、指标、日志、事件、应用性能监测、用户访问监测、云拨测、安全巡检、CI 可视化等查看器，创建自定义时间段即时拷贝的数据副本，并生成指定查看权限的快捷访问链接。

- 若有类似留存业务系统产生问题或异常时刻数据的需求时，**保存快照**功能可以有效地帮助 IT 工程师快速记录真实且准确的观测数据，帮助快速定位问题。
- 若企业内部不同团队之间、或与外部合作伙伴之间等，在保证数据权限隔离的前提下，有共享部分观测数据的需求时，**分享快照**功能可以有效地提升不同分工成员之间的协作效率，帮助企业快速解决问题。

## 保存快照 {#save}

### 快照权限 {#permission}

- 对于支持保存快照的页面，成员的 [4 个默认角色](../../management/role-management.md#_3)中，只有当前工作空间的**拥有者（Owner）、管理员（Administrator）** 拥有<u>保存快照、快照分享、快照分享管理</u>的权限；  
- 除默认角色外，您还可以通过[自定义角色](../../management/role-management.md#_5)，授予相关快照权限，并将该角色分配给所需成员。

### 保存方式

进入想要保存快照的页面，调整右上角时间控件、并过滤出需要保存的数据后，使用如下方法即可弹出**保存快照**窗口。

<div class="grid" markdown>

=== "快捷键"

    :fontawesome-brands-windows: &nbsp; &nbsp; ++ctrl+k++

    :fontawesome-brands-apple: &nbsp; &nbsp; ++cmd+k++

    **注意**：您的后台程序存在的快捷键与如上快捷键冲突时，将无法使用**保存快照**的快捷键功能。

=== "查看器页面 快照按钮"
    
    **查看器 > 顶部快照按钮**（搜索框左侧），点击**保存快照**。

    <img src="../../img/snapshot-1.png" width="80%" >

=== "仪表板 设置按钮"

    **查看器 > 顶部设置按钮**（时间控件左侧），点击**保存快照**。

    ![](../../img/snapshot-13.png)

</div>

### 快照设置 {#snapshot-setting}

成功弹出**保存快照**窗口后，即可对该条快照进行相关设置。

<img src="../../img/snapshot-2.png" width="60%" >

1. 输入快照名称；
2. 可见范围：包括**公开**和**仅自己可见**。
    - 公开：当前工作空间的用户，都可以查看该条快照；
    - 仅自己可见：其他用户权限查看该条快照。                     
3. 自动获取当前页面上选取的时间范围；您可在此处调整时间范围。                    

## 查看快照

### 查看方式 {#check}

您可以在以下入口查看已经保存的快照：

#### :material-numeric-1-circle: 在快照菜单查看

- **工作空间 > 快捷入口> 快照**菜单，可查看当前工作空间保存的所有快照。

<img src="../../img/snapshot-3.png" width="50%" >

- 每页最多可显示 20 个快照，通过跳转至下一页，可以查看更多快照。

<img src="../../img/snapshot-4.png" width="50%" >

#### :material-numeric-2-circle: 在查看器页面查看 

进入**查看器 > 快照**，展示<u>当前查看器保存的快照</u>。例如，在**日志查看器**保存的快照，无法在**应用性能监测 > 链路**查看器中查看；  

- Hover 至历史快照，会在悬浮窗口展示对应的时间范围、筛选条件。时间范围根据保存快照时的选择，分为“绝对时间”、“相对时间”和“默认”三种。

<img src="../../img/snapshot-5.png" width="60%" >

- 若已经点击进入某条历史快照，再次点击**快照**，点击**返回查看器**按钮即可回到进入该历史快照之前的默认查看器。

<img src="../../img/snapshot-6.png" width="60%" >

#### :material-numeric-3-circle: 在仪表板页面查看 

进入**场景 > 仪表板**，在页面右上方**历史快照**处可查看当前工作空间保存的所有仪表板快照。

![](../img/snapshot-14.png)

### 快照列表操作

- 在 🔍栏，您可以输入快照名称，通过关键词搜索模糊匹配相关快照名称；  
- 在快照右侧，可选择分享/删除快照、复制快照链接；  
- 点击**快照名称**即可打开对应的数据副本，并复现该快照保存时的数据标签；  
- 若在保存快照时，[可见范围选择仅自己可见](#snapshot-setting)，该快照名称后面会显示 :material-lock: ，其他人无法查看。

## 分享快照 {#share}

在快照列表右侧，点击 :octicons-share-android-16: ，即可对当前特定快照进行分享。

<!--
<img src="../../img/snapshot-0724.png" width="60%" >
-->

### 基础配置

<!--
在分享快照窗口，快照名称即[保存当前快照时](#save)填入的名称；默认不可编辑。
-->

<img src="../../img/snapshot-basis.png" width="60%" >

#### 时间范围

快照保存后，会获取当前保存时选定的时间范围。您可选择快照被分享者是否允许更改该快照页面的时间区间。

#### 有效时间

可选 1 天、3 天、7 天和永久有效；默认选中 1 天。

**注意**：若选中“永久有效”，可能会存在数据安全风险，请谨慎考虑。

#### 分享方式 {#sharing-method}

观测云支持公开分享和加密分两种快照分享方式，被分享的快照会自动生成对应链接。您可以分享快照链接给“任何人”，或者加密分享给拥有密钥的人。

???+ abstract "分享快照链接的数据时段说明"

    - 若在保存快照的时候选择**开启绝对时间**，分享后则显示保存快照时的绝对时间。

    例如：若在 `13:30` 选择保存最近 15 分钟数据的快照，那么在 `14:00` 打开快照链接，显示 `13:15 ~ 13:30` 的数据。

    - 若在保存快照的时候选择**关闭绝对时间**，分享后则显示保存快照时的相对时间。
    
    例如：若在 `13:30` 选择保存最近 15 分钟数据的快照，那么在 `14:00` 打开快照链接，显示 `13:45 ~ 14:00`的数据。

:material-numeric-1-circle: 公开分享
    
获得分享链接的用户，即可查看此条快照所展示的观测云工作空间数据。    
    
**注意**：在日志查看器，获得被分享[快照查看](../../logs/logdata-access.md#snapshot)权限的用户可在快照页面上方搜索栏查看此条快照下数据列表的筛选条件，且支持添加搜索条件。

<img src="../../img/snapshot-7.png" width="50%" >

:material-numeric-2-circle: 加密分享

设置符合 `4-8 位数字和英文组合`的密码形式，获得分享链接和对应密码的用户，才可以查看此条快照所展示的观测云工作空间数据。

<img src="../../img/snapshot-8.png" width="50%" >

#### 更多选项

:material-numeric-1-circle: 显示顶部栏 
    
- 开启显示顶部栏分享的效果，可以看到顶部会有平台的介绍说明。

<img src="../../img/snapshot-11.png" width="90%" >

- 关闭显示顶部栏分享的效果：

<img src="../../img/snapshot-10.png" width="90%" >

:material-numeric-2-circle: 显示水印

快照分享时支持显示分享人姓名的水印，格式为 “分享人：姓名”。

<img src="../../img/7.snapshot_3.png" width="90%" >

### 数据脱敏 {#sensitive}

您可以针对快照内的字段值内容进行脱敏配置。输入脱敏字段与正则表达式，点击预览，正则匹配到的内容在当前快照将以 `*` 显示。

- 脱敏字段：支持多选；
- 正则表达式：通过正则语法实现脱敏；此处更多操作可参考[数据访问](../../logs/logdata-access.md#config)。

<img src="../../img/snapshot-mask.png" width="60%" >


<!--
**注意**：  

- 如果字段的正则配置中存在分组, 则只对分组中的内容进行脱敏；   
- 如果字段的正则配置中不存在分组, 则对完全匹配到的结果进行脱敏。
  
*示例：需要将某条日志数据相关的快照分享给某成员，并隐藏 UID。*

配置数据脱敏规则，填入正则语法。此处不显示分组：

<img src="../../img/0727-sensitive.png" width="50%" >

设置分享方式、有效时间等必要信息后。点击**确定**。可前往[快照查看](#view)页面查看，UID 信息已被隐藏：

比如：`message` 字段对应的信息为:  `2023-07-27 07:20:56.240 [INFO][65]  UID:"9e269876-361b-4ba4-a566-8f8ccae74d68"`，配置后，显示为 `2023-07-27 07:20:56.240 [INFO][65] *** `。

![](../img/0727-sensitive-1.png)



若在正则配置中存在分组 `UID:(".*?")`，即：

<img src="../../img/0727-sensitive-2.png" width="50%" >

脱敏后的效果为：

比如：配置后，显示为 `2023-07-27 07:20:56.240 [INFO][65] UID:***`。

![](../img/0727-sensitive-3.png)
-->


### 访问限制 {#ip}

开启 IP 白名单：IP 白名单为快照分享增加了一层保护。

<img src="../../img/snapshot-ip.png" width="60%" >

当您开启 IP 白名单，可选择直接使用当前工作空间的 IP 白名单或自定义输入：

- 工作空间 IP 白名单：即当前工作空间 IP 白名单列表，跟随工作空间的 IP 白名单配置变动而变动，不支持在快照分享下编辑修改；
- 自定义输入：您可自定义输入 IP 访问白名单，若不在此列则无法查看被分享的快照。

> 更多详情，可参考 [如何配置 IP 白名单](../../management/settings/index.md#ip)。

### 预览快照

当您完成分享快照时的所有配置，可选择预览快照效果：

<img src="../../img/snapshot-preview.png" width="60%" >

快照中的脱敏效果如下图所示：

<img src="../../img/snapshot-preview-page.png" width="70%" >

**注意**：此处的预览与您在真实环境下分享快照所有流程完全一致。例如，若在前置的[配置步骤](#share)中设置了 IP 白名单这一访问限制，白名单之外的 IP 也无法查看预览快照。

### 分享快照管理 {#view}

拥有[保存、分析、管理快照权限的成员](#permission)，可以通过以下两种方式进入**分享快照**管理页面，进行查看快照、查看分享链接、取消分享等操作。

> 更多详情请参考 [分享管理](../../management/share-management.md#_3)。

<div class="grid" markdown>

=== "管理 模块" 

    进入**管理 > 分享管理 > 分享快照**模块。

    <img src="../../img/snapshot-12.png" width="80%" >

=== "快照分享 窗口" 

    当您进行[快照分享](#sharing-method)，点击右上角**查看分享列表**，即可跳转到**分享快照**管理模块。

    <img src="../../img/snapshot-12-1.png" width="60%" >

</div>
