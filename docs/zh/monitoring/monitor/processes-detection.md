# 进程异常检测
---

## 概述

「进程异常检测」用于监控工作空间内的进程数据，支持对进程数据的一个或多个字段类型设置触发告警。

## 应用场景

监控进程数据。示例：你可以基于进程数据中 ‘host’ 字段为 ‘izaqbin’ 并且 ‘state’ 的字段为 ‘sleep’ 出现的次数设置告警。

## 规则说明

在「监控器」中，点击「+新建监控器」，选择「进程异常监控」，进入检测规则的配置页面。

### 步骤1.检测配置

![](../img/monitor24.png)

1）**检测频率：**检测规则的执行频率，包含1m/5m/15/30m/1h/6h（默认选中5m）。

2）**检测区间：**每次执行任务时，检测指标查询的时间范围。受检测频率影响，可选检测区间会有不同。（支持用户自定义）

| 检测频率 | 检测区间（下拉可选项） | 自定义区间限制 |
| --- | --- | --- |
| 1m | 1m/5m/15m/30m/1h/3h | <=3h |
| 5m | 5m/15m/30m/1h/3h | <=3h |
| 15m | 15m/30m/1h/3h/6h | <=6h |
| 30m | 30m/1h/3h/6h | <=6h |
| 1h | 1h/3h/6h/12h/24h | <=24h |
| 6h | 6h/12h/24h | <=24h |

3）**检测指标：**设置检测的指标数据。支持设置当前工作空间内进程数据中一个或多个字段类型关键词在一定时间范围内出现的次数。

| 字段 | 说明 |
| --- | --- |
| 进程 | 需要手动输入进程名称，支持输入通配符进行模糊匹配，多个值之间用 “,” 分隔 |
| 筛选条件 | 支持对进程数据的字段进行筛选，限定检测的数据范围。支持添加一个或多个标签筛选 |
| 检测维度 | 配置数据里对应的字符串类型（keyword）字段都可以作为检测维度进行选择，目前检测维度最多支持选择三个字段。通过多个检测维度的字段组合，可以确定一个确定的检测对象，观测云会判断某个检测对象对应的统计指标是否满足触发条件的阈值，若满足条件则产生事件。（例如选择检测维度【 host 】与【 host_ip 】,则检测对象可以为{host: host1, host_ip: 127.0.0.1}） |

4）**触发条件：**设置告警级别的触发条件。

配置触发条件及严重程度，当查询结果为多个值时，任一值满足触发条件则产生事件。

- 事件等级详情参考 [事件等级说明](event-level-description.md) 

**01、告警级别紧急（红色）、重要（橙色）、警告（黄色）基于配置条件判断运算符。**

- 运算符详情参考 [运算符说明](operator-description.md) 

**02、告警级别正常（绿色）、信息（蓝色）基于配置检测次数，说明如下：**

- 每执行一次检测任务即为 1 次检测，如【检测频率 = 5 分钟】，则 1 次检测= 5 分钟
- 可以自定义检测次数，如【检测频率 = 5 分钟】，则 3 次检测 = 15 分钟

**a-正常（绿色）：**检测规则生效后，产生紧急、重要、警告异常事件后，在配置的自定义检测次数内，数据检测结果恢复正常，则产生恢复告警事件。

**b-信息（蓝色）：**正常检测结果也产生事件。

???+ attention

    恢复告警事件不受[告警沉默](../alert-setting.md)限制。若未设置恢复告警事件检测次数，则告警事件不会恢复，且一直会出现在「事件」-「未恢复事件列表」中。

**03、告警级别无数据（灰色）：**无数据状态支持「触发无数据事件」、「触发恢复事件」、「不触发事件」三种配置策略。

### 步骤2.事件通知

![](../img/8.monitor_1.png)

5）**事件标题：**设置告警触发条件的事件名称，支持使用预置的模板变量，详情参考 [模板变量](../event-template.md) 。

???+ attention
    
    最新版本中 “监控器名称” 将由 “事件标题” 输入后同步生成。旧的监控器中可能存在 “监控器名称” 和 “事件标题” 不一致的情况，为了给您更好的使用体验，请尽快同步至最新。支持一键替换为事件标题。

6）**事件内容：**满足触发条件时发送的事件通知内容，支持输入markdown 格式文本信息，支持预览效果，支持使用预置的 [关联链接](link-description.md) ，支持使用预置的 [模板变量](../event-template.md) 。

???+ attention

    不同告警通知对象支持的 markdown 语法不同，例如：企业微信不支持无序列表。

**无数据通知配置：** 支持自定义无数据通知内容，若没有配置，则自动使用官方默认的通知模版。

![](../img/8.monitor_2.png)

7）**告警策略：**监控满足触发条件后，立即发送告警消息给指定的通知对象。告警策略中包含需要通知的事件等级、通知对象、以及告警沉默周期。详情参考 [告警策略](../alert-setting.md) 。

### 步骤3.关联

![](../img/5.monitor_4.png)

8）**关联仪表板：**每一个监控器都支持关联一个仪表板，即通过「关联仪表板」功能能够自定义快速跳转的仪表板（监控器关联的仪表板，支持快速跳转查看监控视图）。

## 查看/恢复历史配置

在编辑监控器时，点击右上角的![](../img/8.monitor_recover_3.png)按钮，即可查看监控器的状态、最后更新时间、创建时间以及创建人。

![](../img/8.monitor_recover_1.png)

点击最后更新时间右侧的![](../img/8.monitor_recover_2.png)按钮，即可查看并恢复上一版本的监控器配置。

![](../img/8.monitor_recover_1.1.png)

## 示例

查看主机哪些进程处于睡眠状态，并触发异常事件。

![](../img/example07.png)



