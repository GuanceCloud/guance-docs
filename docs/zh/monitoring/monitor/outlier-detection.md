# 离群检测
---


通过算法分析特定分组内检测对象的指标或统计数据，以识别是否存在显著的离群偏差。如果检测到的不一致性超过预设的阈值，系统将生成一个离群检测异常事件，用于后续的告警跟踪和分析。这种方法有助于及时发现并处理潜在的异常情况，提高监控的准确性和响应速度。

## 应用场景

可以基于指标数据的特性来配置恰当的距离参数，以便在数据显著偏离正常范围时触发紧急事件。例如，您可以设置监控，以便当某台主机的内存使用率显著高于其他主机时，系统能够及时发出警报。这样的配置有助于快速识别并响应潜在的性能问题或异常情况。



## 检测配置

![](../img/5.monitor_9.png)

### 检测频率

即自动匹配所选检测区间。

### 检测区间

即检测指标查询的时间范围。

| 检测区间（下拉可选项） | 默认检测频率 | 
| --- | --- | 
| 15m | 5m |
| 30m | 5m |
| 1h | 15m |
| 4h | 30m |
| 12h | 1h |
| 1d | 1h |

### 检测指标

即监控的指标数据。

| 字段 | 说明 |
| --- | --- |
| 数据类型 | 当前检测的数据类型，包含检测指标、日志、基础设施、资源目录、事件、应用性能监测、用户访问监测、安全巡检、网络和 Profile。 |
| 指标集 | 当前检测指标所在的指标集。 |
| 指标 | 当前检测所针对的指标。 |
| 聚合算法 | 包含 Avg by（取平均值）、Min by（取最小值）、Max by（取最大值）、Sum by（求和）、Last（取最后一个值）、First by（取第一个值）、Count by（取数据点数）、Count_distinct by（取非重复的数据点数）、p50(取中位数值)、p75（取处于75%位置的值）、p90（取处于90%位置的值）、p99(取处于99%位置的值)。 |
| 检测维度 | 检配置数据里对应的字符串类型（`keyword`）字段都可以作为检测维度进行选择，目前检测维度最多支持选择三个字段。通过多个检测维度的字段组合，可以确定一个确定的检测对象，观测云会判断某个检测对象对应的统计指标是否满足触发条件的阈值，若满足条件则产生事件。<br />*（例如选择检测维度 `host` 与 `host_ip`，则检测对象可以为 `{host: host1, host_ip: 127.0.0.1}`。）* |
| 筛选条件 | 基于指标的标签对检测指标的数据进行筛选，限定检测的数据范围；支持添加一个或多个标签筛选；支持模糊匹配和模糊不匹配的筛选条件。 |
| 别名 | 自定义检测指标名称。 |
| [查询](../../scene/visual-chart/chart-query.md)方式 | 支持简单查询和表达式查询。 |

### 触发条件

设置告警级别的触发条件：您可任意配置紧急、正常、数据断档、信息的其中一种触发条件。

配置触发条件及严重程度，当查询结果为多个值时，任一值满足触发条件则产生事件。

| <div style="width: 100px">程度</div> | 说明 |
| --- | --- |
| 紧急（红色） | 使用 DBSCAN 算法，可根据指标数据特征配置合适的距离参数，触发紧急事件。距离参数，表示其中一个样本与另一个样本相邻，两个样本之间的最大距离，不是簇内点距离的最大界限。（float, default=0.5）<br /><br />:warning: 可选择配置 range(0-3.0) 之间的任意浮点值，如果不配置，默认距离参数为 0.5，距离设置越大得到的异常点越少，距离值设置过小可能检测到的离群值非常多，距离值设置过大可能导致没有任何离群检测到， 所以需要根据不同的数据特征设置合适的距离参数。 |
| 正常（绿色） | 可配置次数，若检测指标触发了“紧急”异常事件，之后连续 N 次检测都正常，则产生“正常”事件。用于判定异常事件是否恢复正常，建议配置。 |

    
### 数据断档

针对数据断档状态，可配置七种策略。

1. 联动检测区间时间范围，判断检测指标最近分钟数的查询结果，**不触发事件**；

2. 联动检测区间时间范围，判断检测指标最近分钟数的查询结果，**查询结果视为 0**；此时查询结果将重新与上方**触发条件**中配置的阈值做比较，从而判断是否触发异常事件。

3. 自定义填充检测区间值，**触发数据断档事件、触发紧急事件、触发重要事件、触发警告事件及触发恢复事件**；选择该类配置策略，自定义数据断档时间配置建议 **>= 检测区间时间间隔**，若配置时间 <= 检测区间时间间隔，可能存在同时满足数据断档和异常情况，此情况下仅会应用数据断档处理结果。


### 信息生成

开启此选项后，将未匹配到以上触发条件的检测结果生成 “信息” 事件写入。


**注意**：若同时配置触发条件、数据断档、信息生成时，按照如下优先级判断触发：数据断档 > 触发条件 > 信息事件生成。



