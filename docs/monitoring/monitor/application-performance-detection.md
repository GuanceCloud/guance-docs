# 应用性能指标检测
---

## 概述

「应用性能指标检测」用于监控工作空间内「应用性能监测」的指标数据，通过设置阈值范围，当指标到达阈值后触发告警。“观测云”支持对单个指标设置告警和自定义告警等级。

## 规则说明

### 步骤1.基本信息

![](../img/6.monitor01.png)

1）**规则名称：**检测规则的名称。

2）**关联仪表板：**每一个监控器都支持关联一个仪表板，即通过「关联仪表板」功能能够自定义快速跳转的仪表板（监控器关联的仪表板，支持快速跳转查看监控视图）。

### 步骤2.检测配置

![](../img/6.monitor14.1.png)

3）**检测频率：**检测规则的执行频率，包含1m/5m/15/30m/1h/6h（默认选中5m）。

4）**检测区间：**每次执行任务时，检测指标查询的时间范围。受检测频率影响，可选检测区间会有不同。（支持用户自定义）

| 检测频率 | 检测区间（下拉可选项） | 自定义区间限制 |
| --- | --- | --- |
| 1m | 1m/5m/15m/30m/1h/3h | <=3h |
| 5m | 5m/15m/30m/1h/3h | <=3h |
| 15m | 15m/30m/1h/3h/6h | <=6h |
| 30m | 30m/1h/3h/6h | <=6h |
| 1h | 1h/3h/6h/12h/24h | <=24h |
| 6h | 6h/12h/24h | <=24h |

4）**检测指标：**设置检测数据的指标。支持设置工作空间内全部/单个服务列表中一定时间范围内的指标数据。

**服务指标**

| 字段 | 说明 |
| --- | --- |
| 服务 | 支持对当前工作空间内「应用性能监测」的全部/单个服务的指标数据进行监控，支持全选或单选 |
| 指标 | 具体的检测指标，支持设置单个指标，包括请求数、错误请求数、请求错误率、平均每秒请求数、平均响应时间、P50响应时间、P75响应时间、P90响应时间、P99响应时间等 |
| 筛选条件 | 基于指标的标签对检测指标的数据进行筛选，限定检测的数据范围。支持添加一个或多个标签筛选，支持模糊匹配和模糊不匹配的筛选条件。 |
| 维度 | 检测指标的触发维度，即触发对象。任意一个触发对象的指标满足告警条件则触发告警，不支持 int 型字段为触发维度，且最多支持选择三个字段 |

**链路统计**

统计规定时间内符合条件的链路数量，当超出自定义阈值则触发异常事件。可用于服务链路异常错误通知。

![](../img/6.monitor14.2.png)

| 字段 | 说明 |
| --- | --- |
| 来源 | 当前检测指标的数据来源，支持选择全部（`*`）或指定单个数据来源 |
| 筛选条件 | 通过标签过滤链路 span，限定检测的数据范围，支持添加一个或多个标签筛选。 |
| 聚合算法 | 默认选中“*”，对应的函数是count 。若选中其他字段，函数自动变为 Count distinct（取关键字出现的数据点数） |
| 检测维度 | 检测维度决定着检测规则基于哪个维度触发，即触发对象。“观测云”支持添加多个触发维度，任意一个触发维度的指标满足告警条件则触发告警，不支持 int 型字段为触发维度，且最多支持选择三个字段。 |

5）**触发条件：**设置告警级别的触发条件。

![](../img/6.monitor14.3.png)

配置触发条件及严重程度，当查询结果为多个值时，任一值满足触发条件则产生事件。

| **名称** | **对应 df_status 取值** | **说明** |
| --- | --- | --- |
| info | info | 提示 |
| 警告 | warning | 警告 |
| 重要 | error | 错误 |
| 紧急 | critical | 致命 |
| 无数据 | nodata | 无数据 |
| 恢复 | ok | 若之前检测过程中触发过“紧急”“重要”“警告”这 3 种异常事件，根据前端配置的 N 个周期做判断，周期内无“紧急”“重要”“警告”事件产生，则视为恢复，并产生正常恢复事件 |
| 无数据恢复 | ok | 若之前检测过程中因为数据停止上报触发无数据异常事件，新的数据重新上报后则判断为恢复产生无数据恢复事件 |
| 无数据视为恢复 | ok | 若检测数据中出现无数据情况，那么视此情况为正常状态，并产生恢复事件。 |
| 手动恢复 | ok | 由用户手工创建的 OK 事件 |


**01、告警级别紧急（红色）、重要（橙色）、警告（黄色）基于配置条件判断运算符。**

- 运算符详情参考 [运算符说明](operator-description.md) 


**02、告警级别无数据（灰色）、正常（绿色）基于配置检测周期，说明如下：**

- 每执行一次检测任务即为1个检测周期，如【检测频率 = 5 分钟】，则一个检测周期 = 5 分钟
- 可以自定义检测周期，如【检测频率 = 5 分钟】，则 3 个检测周期 = 15 分钟

**a-无数据（灰色）：**无数据状态支持「触发无数据事件」、「触发恢复事件」、「不触发事件」三种配置，需要手动配置无数据处理策略。

检测规则生效后，第一次检测无数据且持续无数据，不产生无数据告警事件；若检测有数据且在配置的自定义检测周期内，数据上报发生断档，则产生无数据告警事件。

**b-正常（绿色）：**检测规则生效后，产生紧急、重要、警告异常事件后，在配置的自定义检测周期内，数据检测结果恢复正常，则产生恢复告警事件。

注意：恢复告警事件不受[告警沉默](../alert-setting.md)限制。若未设置恢复告警事件检测周期，则告警事件不会恢复，且一直会出现在「事件」-「未恢复事件列表」中。

### 步骤3.事件通知

![](../img/6.monitor03.png)

7）**事件标题：**设置告警触发条件的事件名称，支持使用预置的模板变量，详情参考 [模板变量](../event-template.md) 。

8）**事件内容：**满足触发条件时发送的事件通知内容，支持输入markdown 格式文本信息，支持预览效果，支持使用预置的模板变量，详情参考 [模板变量](../event-template.md) 。

**注意：**不同告警通知对象支持的 markdown 语法不同，例如：企业微信不支持无序列表。

9）**告警策略：**监控满足触发条件后，立即发送告警消息给指定的通知对象。告警策略中包含需要通知的事件等级、通知对象、以及告警沉默周期。详情参考 [告警策略](../alert-setting.md) 。

