
# Network Dial Test
---

:fontawesome-brands-linux: :fontawesome-brands-apple: :material-kubernetes: :material-docker:

---

# dialtesting

The collector collects the data of network dialing test results, and all the data generated by dialing test are reported to Guance Cloud.

## Private Test Node Deployment {#private-deploy}

=== "host installation"

    To deploy private dial-test nodes, you need to [create private dial-test nodes on Guance Cloud page](../usability-monitoring/self-node.md). When you're done, fill in the page with the relevant information in `conf.d/network/dialtesting.conf`:
    
    Go to the `conf.d/network` directory under the DataKit installation directory, copy `dialtesting.conf.sample` and name it `dialtesting.conf`. Examples are as follows:
    
    ```toml
    # Dataway address
    server = "https://openway.guance.com"
    
    # require, node Unique Identification ID
    region_id = "reg_c2jlokxxxxxxxxxxx"
    
    # If server is assigned as the central task service address, it is necessary to configure the corresponding ak or sk
    ak = "ZYxxxxxxxxxxxx"
    sk = "BNFxxxxxxxxxxxxxxxxxxxxxxxxxxx"
    
    [inputs.dialtesting.tags]
      # some_tag = "some_value"
      # more_tag = "some_other_value"
      # ...
    ```
    
    Once configured, [restart DataKit](datakit-service-how-to.md#manage-service).

=== "Kubernetes"

    The collector can now be turned on by [ConfigMap injection collector configuration](datakit-daemonset-deploy.md#configmap-setting).

---

???+ attention

    Currently, only linux dial-up nodes support, and the tracing data is stored in the [traceroute](#fields) field of the relevant metrics.

## Dial Test Deployment Map {#arch}

<figure markdown>
  ![](https://static.guance.com/images/datakit/dialtesting-net-arch.png){ width="800" }
</figure>

## Configuration {#config}

Go to the `conf.d/network` directory under the DataKit installation directory, copy `dialtesting.conf.sample` and name it `dialtesting.conf`. Examples are as follows:

```toml

[[inputs.dialtesting]]
  # We can also configure a JSON path like "file:///your/dir/json-file-name"
  server = "https://dflux-dial.guance.com"

  # [require] node ID
  region_id = "default"

  # if server are dflux-dial.guance.com, ak/sk required
  ak = ""
  sk = ""

  # The interval to pull the tasks.
  pull_interval = "1m"

  # The timeout for the HTTP request.
  time_out = "1m"

  # The number of the workers.
  workers = 6

  max_send_fail_count = 16

  # Custom tags.
  [inputs.dialtesting.tags]
  # some_tag = "some_value"
  # more_tag = "some_other_value"
  # ...
```

After configuration, restart DataKit.

## Measurements {#measurements}

All of the following data collections are appended with a global tag named `host` by default (the tag value is the host name of the DataKit), or can be named in the configuration by `[[inputs.dialtesting.tags]]` alternative host.



### `http_dial_testing`

-  tag


| Tag | Description |
|  ----  | --------|
|`city`|示例 杭州|
|`country`|示例 中国|
|`dest_ip`|示例 目标 IP, 如 127.0.0.1|
|`internal`|示例 true（国内 true /海外 false）|
|`isp`|示例 电信/移动/联通|
|`name`|示例：拨测名称，百度测试|
|`proto`|示例 HTTP/1.0|
|`province`|示例 浙江|
|`status`|示例 OK/FAIL 两种状态 |
|`status_code_class`|示例 2xx|
|`status_code_string`|示例 200 OK|
|`url`|示例 `http://wwww.baidu.com`|

- metric list


| Metric | Description | Type | Unit |
| ---- |---- | :---:    | :----: |
|`fail_reason`|拨测失败原因|string|-|
|`message`|包括请求头(request_header)/请求体(request_body)/返回头(response_header)/返回体(response_body)/fail_reason 冗余一份|string|-|
|`proto`|示例 HTTP/1.0|string|-|
|`response_body_size`|body 长度|int|B|
|`response_time`|HTTP 响应时间|int|μs|
|`status_code`|web page response code|int|-|
|`success`|只有 1/-1 两种状态, 1 表示成功, -1 表示失败|int|-|



### `tcp_dial_testing`

-  tag


| Tag | Description |
|  ----  | --------|
|`city`|示例 杭州|
|`country`|示例 中国|
|`dest_host`|示例 wwww.baidu.com|
|`dest_ip`|示例 目标 IP, 如 127.0.0.1|
|`dest_port`|示例 80|
|`internal`|示例 true（国内 true /海外 false）|
|`isp`|示例 电信/移动/联通|
|`name`|示例 拨测名称,百度测试|
|`proto`|示例 `tcp`|
|`province`|示例 浙江|
|`status`|示例 OK/FAIL 两种状态 |

- metric list


| Metric | Description | Type | Unit |
| ---- |---- | :---:    | :----: |
|`fail_reason`|拨测失败原因|string|-|
|`message`|包括响应时间(response_time)/错误原因(fail_reason)|string|-|
|`response_time`|TCP 连接时间 |int|μs|
|`response_time_with_dns`|连接时间（含 DNS 解析）|int|μs|
|`success`|只有 1/-1 两种状态, 1 表示成功, -1 表示失败|int|-|
|`traceroute`|路由跟踪数据文本(JSON 格式)|string|-|



### `icmp_dial_testing`

-  tag


| Tag | Description |
|  ----  | --------|
|`city`|示例 杭州|
|`country`|示例 中国|
|`dest_host`|示例 `wwww.baidu.com`|
|`internal`|示例 true（国内 true /海外 false）|
|`isp`|示例 电信/移动/联通|
|`name`|示例 百度测试|
|`proto`|示例 `icmp`|
|`province`|示例 浙江|
|`status`|示例 OK/FAIL 两种状态 |

- metric list


| Metric | Description | Type | Unit |
| ---- |---- | :---:    | :----: |
|`average_round_trip_time`|平均往返时间(RTT)|float|μs|
|`average_round_trip_time_in_millis`|平均往返时间(RTT). 本字段将被弃用|float|ms|
|`fail_reason`|拨测失败原因|string|-|
|`max_round_trip_time`|最大往返时间(RTT)|float|μs|
|`max_round_trip_time_in_millis`|最大往返时间(RTT). 本字段将被弃用|float|ms|
|`message`|包括平均 RTT 时间(average_round_trip_time)/错误原因(fail_reason)|string|-|
|`min_round_trip_time`|最小往返时间(RTT)|float|μs|
|`min_round_trip_time_in_millis`|最小往返时间(RTT). 本字段将被弃用|float|ms|
|`packet_loss_percent`|丢包率|float|-|
|`packets_received`|接受的数据包|int|count|
|`packets_sent`|发送的数据包|int|count|
|`std_round_trip_time`|往返时间(RTT)标准差|float|μs|
|`std_round_trip_time_in_millis`|往返时间(RTT)标准差. 本字段将被弃用|float|ms|
|`success`|只有 1/-1 两种状态, 1 表示成功, -1 表示失败|int|-|
|`traceroute`|路由跟踪数据文本(JSON 格式)|string|-|



### `websocket_dial_testing`

-  tag


| Tag | Description |
|  ----  | --------|
|`city`|示例 杭州|
|`country`|示例 中国|
|`internal`|示例 true（国内 true /海外 false）|
|`isp`|示例 电信/移动/联通|
|`name`|示例 拨测名称,百度测试|
|`proto`|示例 websocket|
|`province`|示例 浙江|
|`status`|示例 OK/FAIL 两种状态 |
|`url`|示例 `ws://www.abc.com`|

- metric list


| Metric | Description | Type | Unit |
| ---- |---- | :---:    | :----: |
|`fail_reason`|拨测失败原因|string|-|
|`message`|包括响应时间(response_time)/错误原因(fail_reason)|string|-|
|`response_message`|拨测返回的消息|string|-|
|`response_time`|连接时间|int|μs|
|`response_time_with_dns`|连接时间（含 DNS 解析）|int|μs|
|`sent_message`|拨测发送的消息|string|-|
|`success`|只有 1/-1 两种状态, 1 表示成功, -1 表示失败|int|-|




## `traceroute` Field Description {#fields}

traceroute is the JSON text of the "route trace" data, and the entire data is an array object in which each array element records a route probe, as shown in the following example:

```json
[
    {
        "total": 2,
        "failed": 0,
        "loss": 0,
        "avg_cost": 12700395,
        "min_cost": 11902041,
        "max_cost": 13498750,
        "std_cost": 1129043,
        "items": [
            {
                "ip": "10.8.9.1",
                "response_time": 13498750
            },
            {
                "ip": "10.8.9.1",
                "response_time": 11902041
            }
        ]
    },
    {
        "total": 2,
        "failed": 0,
        "loss": 0,
        "avg_cost": 13775021,
        "min_cost": 13740084,
        "max_cost": 13809959,
        "std_cost": 49409,
        "items": [
            {
                "ip": "10.12.168.218",
                "response_time": 13740084
            },
            {
                "ip": "10.12.168.218",
                "response_time": 13809959
            }
        ]
    }
]
```

Field description:

| Field  | Type      | Description            |
| :---       | ---           | ---                         |
| `total`    | number        | Total number of detections |
| `failed`   | number        | Number of failures  |
| `loss`     | number        | Percentage of failure |
| `avg_cost` | number        | Average time spent (μs) |
| `min_cost` | number        | Minimum time consumption (μs) |
| `max_cost` | number        | Maximum time consumption(μs) |
| `std_cost` | number        | Standard deviation of time consumption(μs) |
| `items`    | Array of items | Per probe information ([see](dialtesting.md#item)) |

### Item {#item}

| Field           | Type   | Description                             |
| :-------------- | ------ | --------------------------------------- |
| `ip`            | string | IP address, if it fails, the value is * |
| `response_time` | number | Response time (μs)                      |

