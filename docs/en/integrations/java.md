---
title     : 'JAVA'
summary   : 'Obtain metrics, trace data, and log information from JAVA applications'
__int_icon: 'icon/jvm'
dashboard :
  - desc  : 'Not available'
    path  : '-'
monitor   :
  - desc  : 'Not available'
    path  : '-'
---

<!-- markdownlint-disable MD025 -->
# JAVA
<!-- markdownlint-enable -->

Linking JAVA applications with Guance:

- Collect custom Metrics data from the application;
- Collect trace data from the application;
- Manage all logs from the application.

## Configuration {#config}

### Metrics Collection

Refer to the [JVM documentation](jvm.md)

### Trace Data Collection

Enable the corresponding ***collector*** in the application, then use the JAVA agent tool to collect and send trace information to Guance.
<!-- markdownlint-disable MD046 -->
=== "OpenTelemetry"

    [OpenTelemetry Collector](opentelemetry.md)

=== "DDTrace"

    [DDTrace Collector](ddtrace.md)

=== "SkyWalking"

    [SkyWalking Collector](skywalking.md)

=== "Jaeger"

    [Jaeger Collector](jaeger.md)

=== "Zipkin"

    [Zipkin Collector](zipkin.md)

=== "CAT"

    [CAT Collector](cat.md)

=== "Pinpoint"

    [Pinpoint Collector](pinpoint.md)
<!-- markdownlint-enable -->
## Log Correlation {#logging}

`opentelemetry-java` (hereinafter referred to as "Agent") is injected into the application via `javaagent`. After the application generates trace information, by setting MDC, `traceId` and `spanId` can be passed as parameters to `log`, so that `log` will include `traceId` and `spanId` when outputting.
<!-- markdownlint-disable MD046 -->
???+ info "About MDC"

    Mapping Diagnostic Context (MDC) is a tool used to differentiate interleaved log output from different sources. — [log4j MDC Documentation](http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/MDC.html)
<!-- markdownlint-enable -->
It contains thread-local context information and copies it into each log event captured by the logging library.

The OTEL JAVA Agent injects several pieces of information about the current span into each log record event's MDC copy:

- ***trace_id*** Current trace ID (same as `Span.current().getSpanContext().getTraceId()`);
- ***span_id*** Current span ID (same as `Span.current().getSpanContext().getSpanId()`);
- ***trace_flags*** Current trace flags, formatted according to the W3C trace flags format (same as `Span.current().getSpanContext().getTraceFlags().asHex()`).

These three pieces of information can be included in log statements generated by the logging library by specifying them in the pattern/format.

Tip: For SpringBoot configurations using `logback`, you can add MDC to log lines by overriding only the following content for `logging.pattern.level`:

```bash
logging.pattern.level = trace_id=%mdc{trace_id} span_id=%mdc{span_id} trace_flags=%mdc{trace_flags} %5p
```

This way, any service or tool parsing application logs can associate traces/spans with log statements.

### Log Configuration

Different APM tools configure the log `pattern` differently. Here’s an example using `logback.xml`:
<!-- markdownlint-disable MD046 -->
=== "OpenTelemetry"

    OpenTelemetry MDC parameters:

    - trace_id
    - span_id

    ```xml
    <property name="log.pattern" value="%d{HH:mm:ss} [%thread] %-5level %logger{10} [traceId=%X{trace_id} spanId=%X{span_id} userId=%X{user-id}] %msg%n" />

    <!-- %m output message, %p log level, %t thread name, %d date, %c full class name,,,, -->
    <appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <pattern>${log.pattern}</pattern>
            <charset>UTF-8</charset>
        </encoder>
    </appender>
    ```

=== "DDTrace"

    DDTrace MDC parameters:

    - dd.service
    - dd.trace_id
    - dd.span_id

    ```xml
    <property name="log.pattern" value="%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger - [%method,%line] %X{dd.service} %X{dd.trace_id} %X{dd.span_id} - %msg%n" />

    <!-- %m output message, %p log level, %t thread name, %d date, %c full class name,,,, -->
    <appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <pattern>${log.pattern}</pattern>
            <charset>UTF-8</charset>
        </encoder>
    </appender>-
    ```
<!-- markdownlint-enable -->

## Reference Documentation {#faq}

[**DDTrace Log**](https://docs.guance.com/best-practices/insight/ddtrace-skill-log/)

[**springboot-ddtrace-server**](https://github.com/lrwh/observable-demo/blob/main/springboot-ddtrace-server/src/main/resources/logback-spring.xml)

[**springboot-opentelemetry-otlp-server**](https://github.com/lrwh/observable-demo/blob/main/springboot-opentelemetry-otlp-server/src/main/resources/logback-spring.xml)
