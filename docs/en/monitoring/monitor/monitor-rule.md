# Detection Rules
---

<<< custom_key.brand_name >>> supports over a dozen monitoring detection rules, covering different data ranges.

## Rule Types {#type}

<font size=2>

| <div style="width: 170px">Rule Name</div> | <div style="width: 120px">Data Range</div> | Basic Description |
| --- | --- | --- |
| [Threshold Detection](./threshold-detection.md) | All | Abnormality detection on metric data based on set thresholds. |
| [Mutation Detection](./mutation-detection.md) | Metrics(M) | Abnormality detection for sudden irregular behavior in metrics based on historical data, suitable for business data and short time windows. |
| [Interval Detection](./interval-detection.md) | Metrics(M) | Detection of abnormal data points in metrics based on dynamic threshold ranges, suitable for stable trend timelines. |
| [Interval Detection V2](./interval-detection-v2.md) | Metrics(M) | Detection of abnormal data points in metrics based on dynamic threshold ranges, suitable for stable trend timelines. |
| [Outlier Detection](./outlier-detection.md) | Metrics(M) | Detects whether there are outlier deviations in the metrics/statistics of the detected object under specific groupings. |
| [Log Detection](./log-detection.md) | Logs(L) | Abnormality detection for business applications based on log data. |
| [Process Anomaly Detection](./processes-detection.md) | Process Objects(O::`host_processes`) | Periodic detection of process data to understand process anomalies. |
| [Infrastructure Survival Detection V2](./infrastructure-detection.md) | Objects(O) | Based on infrastructure object data, set survival conditions to monitor the stability of infrastructure. |
| [Application Performance Metric Detection](./application-performance-detection.md) | Tracing(T) | Based on application performance monitoring data, set threshold rules to detect abnormal situations. |
| [User Access Metric Detection](./real-user-detection.md) | User Access Data(R) | Based on user access monitoring data, set threshold rules to detect abnormal situations. |
| [Composite Detection](./composite-detection.md) | All | Combine multiple monitors' results into one monitor through expressions and trigger alerts based on the combined results. |
| [Security Check Anomaly Detection](./security_checker.md) | Security Checks(S) | Abnormality detection based on data generated by security checks, effectively sensing the health status of hosts. |
| [Usability Data Detection](./usability-detection.md) | Usability Data(L::`type`) | Based on usability monitoring data, set threshold rules to detect abnormal situations. |
| [Network Data Detection](./network-detection.md) | Network(N) | Based on network data, set threshold rules to detect the stability of network performance. |
| [External Event Detection](./third-party-event-detection.md) | Others | By specifying a URL address, send abnormal events or records produced by third-party systems via POST requests to an HTTP server to generate <<< custom_key.brand_name >>> event data. |

</font>

## Start Configuration

### Detection Configuration {detection-config}

Set corresponding detection frequencies, detection intervals, detection metrics, etc., for different [detection rules](#type).

### Event Notifications {#notice}

#### Event Title

Define the event name for alarm triggering conditions; you can use preset [template variables](../event-template.md).

**Note**: In the latest version, the monitor name will be automatically generated after entering the event title. There may be inconsistencies between the monitor names and event titles in older monitors. For a better experience, please synchronize to the latest version as soon as possible.

#### Event Content {#content}

Write the event notification content, which the system will send externally when the trigger conditions are met. You can input Markdown formatted text information and preview the effect; [related links](#links) and [template variables](../event-template.md) can also be used.

#### Custom Notification Content {#custom}

By default, <<< custom_key.brand_name >>> uses the [event content](#content) as the alert notification content. If you need to customize the actual external notification, you can enable the switch here and fill in the notification information.

<img src="../../img/custom-enable.png" width="70%" >

**Note**: Different alert notification targets support different Markdown syntaxes, for example: WeCom does not support unordered lists.

##### Related Links {links}

Monitors will automatically generate jump links based on the detection metrics in the [detection configuration](#detection-config). You can adjust filtering conditions and time ranges after inserting the link. This is usually a fixed link prefix that contains the current domain name and workspace ID; you can also choose to customize the jump link.

Among these, if you need to insert a link to a dashboard, based on the above logic, you also need to supplement the dashboard's ID and name, and adjust view variables and time ranges as needed.

<img src="../../img/monitor-link.png" width="70%" >

##### Custom Advanced Settings {#advanced-settings}

You can add associated logs or error stacks in the event content through advanced settings to view contextual data when abnormalities occur:

<img src="../../img/advanced-settings.png" width="70%" >

- Add related logs:

Query:

For example, get a log `message` with index `default`:

```
{% set dql_data = DQL("L::RE(`.*`):(`message`) { `index` = 'default' } LIMIT 1") %}
```

Associated log:



```
{{ dql_data.message | limit_lines(10) }}
```

- Add related error stack
  
Query:

```
{% set dql_data = DQL("T::re(`.*`):(`error_message`,`error_stack`){ (`source` NOT IN ['service_map', 'tracing_stat', 'service_list_1m', 'service_list_1d', 'service_list_1h', 'profile']) AND (`error_stack` = exists()) } LIMIT 1") %}
```

Associated error stack:

```
{{ dql_data.error_message | limit_lines(10) }}

{{ dql_data.error_stack | limit_lines(10) }}
```


#### Data Gap Events

Customize the content of notifications for data gaps. You can configure the title and content of such events that will ultimately be sent out.

If no configuration is made here, the official default notification template will be automatically used when sending out.

<img src="../../img/8.monitor_2.png" width="80%" >

#### Associated Incidents {#issue}

After enabling association, if an abnormal event occurs under this monitor, an Issue will be created simultaneously. You can choose to create Issues based on different event levels.

1. Select event level;
2. Define the final level of the resulting Issue;
3. Choose the responsible person for this type of Issue;
4. Select the delivery channel;
5. Optionally choose whether to close the Issue synchronously after the event recovers.

Issues generated here can be viewed in [Incident](../../exception/index.md) > the selected [channel](../../exception/channel.md).

### Alert Configuration {#alert}

<img src="../../img/strategy-create.png" width="60%" >

Once the monitor meets the trigger conditions, immediately send an [alert](../alert-setting.md) message to the specified notification target. The alert strategy includes the event levels to notify, notification targets, and alert silence cycles.

Alert strategies support single or multiple selections, click the strategy name to expand the details page. To modify the strategy, click **Edit Alert Strategy**.


### Association

**Associate Dashboard**: Each monitor supports associating with a dashboard for quick jumps to check.

### Permissions {#permission}

After setting the operation permissions for the monitor, roles, team members, and space users in your current workspace will perform corresponding operations based on assigned permissions. This ensures that different users perform operations consistent with their roles and permission levels.

- Do not enable this configuration: Follow the [default permissions](../management/role-list.md) in "Monitor Configuration Management";
- Enable this configuration and select custom permission objects: Only the creator and authorized objects can enable/disable, edit, or delete the rules set for this monitor;
- Enable this configuration but do not select custom permission objects: Only the creator has the enable/disable, edit, and delete permissions for this monitor.

**Note**: The Owner role in the current workspace is not affected by this operational permission configuration.

## Recover Monitors {#recover}

<<< custom_key.brand_name >>> allows you to view existing monitor statuses, last update times, creation times, and creators. You can recover monitor history configurations to quickly collaborate with other team members and update monitors.

*<u>Operation Example:</u>*

In **Monitoring > Monitors**, select an existing monitor to edit. On the monitor configuration page, click the :fontawesome-brands-creative-commons-nd: button at the top right corner to view the monitor's status, last update time, creation time, and creator.

![](../img/8.monitor_recover_1.png)

Click the :material-text-search: view button to the right of the **update time** in the above image to open a new browser window showing the previous version of the monitor configuration;

![](../img/8.monitor_recover_1.1.png)

Click the **Restore This Version** button at the top right corner of the previous version monitor. In the pop-up dialog box, confirm the restore to edit and save the previous version of the monitor configuration.

<img src="../../img/8.monitor_recover_1.2.png" width="60%" >