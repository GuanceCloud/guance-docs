# SourceMap
---


Sourcemap is used to map compressed code in the production environment back to the original source code. RUM supports mapping of this source code file information by compressing and uploading the corresponding symbol table file in zip format, so that the reported error metrics data can be automatically converted.

## Zip Packaging

<!-- markdownlint-disable MD046 -->
=== "Web"

    Compress and package the *.map* file generated by webpack after obfuscating and compressing the js file. Make sure that the file path after decompression of the compressed package is consistent with the URL path in `error_stack`. For example, given the `error_stack` below:

    ```
    ReferenceError
      at a.hideDetail @ http://localhost:8080/static/js/app.7fb548e3d065d1f48f74.js:1:1037
      at a.showDetail @ http://localhost:8080/static/js/app.7fb548e3d065d1f48f74.js:1:986
      at <anonymous> @ http://localhost:8080/static/js/app.7fb548e3d065d1f48f74.js:1:1174
    ```

    The path that needs to be converted is */static/js/app.7fb548e3d065d1f48f74.js*, and its corresponding sourcemap path is */static/js/app.7fb548e3d065d1f48f74.js.map*. The directory structure after decompressing the corresponding package is as follows:

    ```
    static/
    └── js
    └── app.7fb548e3d065d1f48f74.js.map
    
    ```

    The converted `error_stack_source`:

    ```
    
    ReferenceError
      at a.hideDetail @ webpack:///src/components/header/header.vue:94:0
      at a.showDetail @ webpack:///src/components/header/header.vue:91:0
      at <anonymous> @ webpack:///src/components/header/header.vue:101:0
    ```

=== "Mini Program"

    The packaging method for Mini Programs is basically the same as that for the Web.


=== "Android"


    There are currently two types of `sourcemap` files on Android. One is the mapping file generated by compressing and obfuscating Java bytecode with `R8`/`Proguard`, and the other is the unstripped `.so` file that has not cleared the symbol table and debugging information during compilation of C/C++ native code. If your Android application contains both types of `sourcemap` files, you need to package both files into the zip package when building. The directory structure after decompressing the zip package is as follows:

    ```
    <app_id>-<env>-<version>/
    ├── mapping.txt
    ├── armeabi-v7a/
    │   ├── libgameengine.so
    │   ├── libothercode.so
    │   └── libvideocodec.so
    ├── arm64-v8a/
    │   ├── libgameengine.so
    │   ├── libothercode.so
    │   └── libvideocodec.so
    ├── x86/
    │   ├── libgameengine.so
    │   ├── libothercode.so
    │   └── libvideocodec.so
    └── x86_64/
        ├── libgameengine.so
        ├── libothercode.so
        └── libvideocodec.so
    ```

    By default, the mapping file is located at: *<project folder\\>/<Module\\>/build/outputs/mapping/<build-type\\>/*, and the `.so` file is located at: *<project folder\\>/<Module\\>/build/intermediates/cmake/debug/obj/* when compiling the project with CMake, or at: *<project folder\\>/<Module\\>/build/intermediates/ndk/debug/obj/* (for debug builds) or *<project folder\\>/<Module\\>/build/intermediates/ndk/release/obj/* (for release builds) when compiling with NDK.

    The conversion results are as follows:

    === "Java/Kotlin"

        Before conversion `error_stack` :

        ```
        java.lang.ArithmeticException: divide by zero
            at prof.wang.activity.TeamInvitationActivity.o0(Unknown Source:1)
            at prof.wang.activity.TeamInvitationActivity.k0(Unknown Source:0)
            at j9.f7.run(Unknown Source:0)
            at java.lang.Thread.run(Thread.java:1012)
        ```

        After conversion `error_stack_source` :

        ```
        java.lang.ArithmeticException: divide by zero
        at prof.wang.activity.TeamInvitationActivity.onClick$lambda-0(TeamInvitationActivity.java:1)
        at java.lang.Thread.run(Thread.java:1012)
        ```

    === "C/C++ Native Code"

        Before conversion `error_stack` :

        ```
        backtrace:
        #00 pc 00000000000057fc  /data/app/~~Taci3mQyw7W7iWT7Jxo-ag==/com.ft-Q8m2flQFG1MbGImPiuAZmQ==/lib/arm64/libft_native_exp_lib.so (xc_test_call_4+12)
        #01 pc 00000000000058a4  /data/app/~~Taci3mQyw7W7iWT7Jxo-ag==/com.ft-Q8m2flQFG1MbGImPiuAZmQ==/lib/arm64/libft_native_exp_lib.so (xc_test_call_3+8)
        #02 pc 00000000000058b4  /data/app/~~Taci3mQyw7W7iWT7Jxo-ag==/com.ft-Q8m2flQFG1MbGImPiuAZmQ==/lib/arm64/libft_native_exp_lib.so (xc_test_call_2+12)
        #03 pc 00000000000058c4  /data/app/~~Taci3mQyw7W7iWT7Jxo-ag==/com.ft-Q8m2flQFG1MbGImPiuAZmQ==/lib/arm64/libft_native_exp_lib.so (xc_test_call_1+12)
        #04 pc 0000000000005938  /data/app/~~Taci3mQyw7W7iWT7Jxo-ag==/com.ft-Q8m2flQFG1MbGImPiuAZmQ==/lib/arm64/libft_native_exp_lib.so (xc_test_crash+112)
        ...
        ```

        After conversion `error_stack_source` :

        ```
        backtrace:
        
        Abort message: 'abort message for ftNative internal testing'
        #00 0x00000000000057fc /data/app/~~Taci3mQyw7W7iWT7Jxo-ag==/com.ft-Q8m2flQFG1MbGImPiuAZmQ==/lib/arm64/libft_native_exp_lib.so (xc_test_call_4+12)
        xc_test_call_4
        /Users/Brandon/Documents/workplace/working/StudioPlace/xCrash/xcrash_lib/src/main/cpp/xcrash/xc_test.c:65:9
        #01 0x00000000000058a4 /data/app/~~Taci3mQyw7W7iWT7Jxo-ag==/com.ft-Q8m2flQFG1MbGImPiuAZmQ==/lib/arm64/libft_native_exp_lib.so (xc_test_call_3+8)
        xc_test_call_3
        /Users/Brandon/Documents/workplace/working/StudioPlace/xCrash/xcrash_lib/src/main/cpp/xcrash/xc_test.c:73:13
        #02 0x00000000000058b4 /data/app/~~Taci3mQyw7W7iWT7Jxo-ag==/com.ft-Q8m2flQFG1MbGImPiuAZmQ==/lib/arm64/libft_native_exp_lib.so (xc_test_call_2+12)
        xc_test_call_2
        /Users/Brandon/Documents/workplace/working/StudioPlace/xCrash/xcrash_lib/src/main/cpp/xcrash/xc_test.c:79:13
        #03 0x00000000000058c4 /data/app/~~Taci3mQyw7W7iWT7Jxo-ag==/com.ft-Q8m2flQFG1MbGImPiuAZmQ==/lib/arm64/libft_native_exp_lib.so (xc_test_call_1+12)
        xc_test_call_1
        /Users/Brandon/Documents/workplace/working/StudioPlace/xCrash/xcrash_lib/src/main/cpp/xcrash/xc_test.c:85:13
        #04 0x0000000000005938 /data/app/~~Taci3mQyw7W7iWT7Jxo-ag==/com.ft-Q8m2flQFG1MbGImPiuAZmQ==/lib/arm64/libft_native_exp_lib.so (xc_test_crash+112)
        xc_test_crash
        /Users/Brandon/Documents/workplace/working/StudioPlace/xCrash/xcrash_lib/src/main/cpp/xcrash/xc_test.c:126:9
        ...
        ```

=== "iOS"

    The `sourcemap` file on the iOS platform is a symbol table file with debugging information and a `.dSYM` suffix. In general, after the project is compiled, the `.app` file is located in the same directory as the `.dSYM` file, as shown below:

    ``` shell
    $ ls -l Build/Products/Debug-iphonesimulator/
    total 0
    drwxr-xr-x   6 zy  staff  192  8  9 15:27 Fishing.app
    drwxr-xr-x   3 zy  staff   96  8  9 14:02 Fishing.app.dSYM
    drwxr-xr-x  15 zy  staff  480  8  9 15:27 Fishing.doccarchive
    drwxr-xr-x   6 zy  staff  192  8  9 13:55 Fishing.swiftmodule
    ```

    Note that Xcode Release builds generate `.dSYM` files by default, while Debug builds do not. To generate `.dSYM` files for Debug builds, you need to make the following settings in Xcode:

    ```not-set
    Build Settings -> Code Generation -> Generate Debug Symbols -> Yes
    Build Settings -> Build Option -> Debug Information Format -> DWARF with dSYM File
    ```

    When packaging, simply package the corresponding `.dSYM` file into the zip package. If your project involves multiple `.dSYM` files, you need to package them together into the zip package. Then, copy the zip package to the *<DataKit installation directory\\>/data/rum/ios* directory. The directory structure after decompressing the zip package is similar to the following (`.dSYM` files are essentially directories, similar to executable *.app* files on macOS):

    ```
    <app_id>-<env>-<version>/
    ├── AFNetworking.framework.dSYM
    │   └── Contents
    │       ├── Info.plist
    │       └── Resources
    │           └── DWARF
    │               └── AFNetworking
    └── App.app.dSYM
        └── Contents
            ├── Info.plist
            └── Resources
                └── DWARF
                    └── App
    
    ```

<!-- markdownlint-enable -->

---

You can use tools such as [**source-map-visualization**](https://evanw.github.io/source-map-visualization/) to verify the availability of the files.

## File Upload and Deletion

After the configuration is completed, users can directly upload and delete files on the front-end page.

<!--

![](img/sourcemap_01.png)

Below the 🔍 bar, you can view the names of the uploaded files and the application types. You can enter the file name to search, and click on :fontawesome-regular-trash-can: to delete the current file.
-->

???+ warning "Upload Notice"

    - The file size cannot exceed 500M.
    - The file format must be `.zip`.
    - Please ensure that the file path after decompression of the compressed package is consistent with the URL path in `error_stack`.
    - Uploading multiple files simultaneously is not allowed.
    - Uploading files with the same name will result in an overwrite prompt, please be aware.


In addition, Datakit supports configuring [Sourcemap conversion](../integrations/rum.md#sourcemap).
