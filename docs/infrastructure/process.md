# 进程
---

## 简介

进程数据采集成功后会上报到观测云控制台，在「基础设施」的「进程」，您可以查看当前工作空间内**最近10分钟**的全部进程数据信息。

## 查询与分析

进入「进程」查看器，“观测云” 支持您通过搜索关键字，添加标签筛选，排序等方式查询进程数据。

- 时间范围：进程列表支持查看**最近十分钟内**采集的进程数据，通过「播放」按钮可以刷新至当前时间范围，重新获取数据列表。点击时间范围可查看进程回放：
   - 拖动后，刷新暂停，时间显示为：[ 开始时间-结束时间 ]，查询的时间范围为5分钟；
   - 拖动后，查询的是历史进程数据；
   - 拖动后，点击「播放」按钮或刷新页面，回到查看「最近10分钟」的进程。

![](img/8.process.png)

- 搜索与筛选：通过列表上方的搜索和筛选栏，您可以基于标签、字段、文本（包含日志文本）进行关键词搜索、标签筛选、字段筛选、关联搜索，进而过滤出相关的进程对象
   - 输入框支持模糊匹配相关标签和字段
   - “abc：123”形式，回车后支持字段的精确查询，在筛选栏中选择wildcard查询支持基于变量进行模糊查询

![](img/image_7.png)

   - 输入框单击“tag" 后，支持标签筛选
   - 输入框输入文本，支持关键字搜索
   - " abc AND cba / abc OR cba" 形式，回车后支持关联搜索搜索
- 排序：点击列表菜单，如：CPU使用率、MEM使用率，您可以基于选中的标签进行升降排序
- 快捷筛选：您可以通过勾选快捷筛选的字段快速筛选数据，支持自定义添加筛选字段，支持通过“反选”进行快捷筛选，支持通过“重置”快速清除快捷筛选条件。使用“鼠标悬停”，在快捷筛选可查看字段的完整内容

注意：搜索支持多个关键词搜索，只需要输入对应的关键词，使用空格或者逗号隔开即可。（当前搜索多个关键词时采用的是AND逻辑，输入的关键词越多数据匹配的范围越精准。）

![](img/image_8.png)

## 进程详情页

点击进程列表中的进程名称即可划出详情页查看进程对象的详细信息，包括进程状态、关联主机、用户名、Label 属性、完整进程等。

在详情页下方，您可以

- 通过「基础属性」查看进程相关的所有属性
- 通过「指标」查看该进程的CPU使用率、内存使用率、打开的文件数等
- 通过「日志」查看与该进程相关的**最近1小时内**的全部日志
- 通过「主机」查看相关主机的基本信息和该主机**最近24小时内**指标数据
- 通过「内置视图」的绑定功能，添加查看进程对象相关的内置视图。更多配置详情，可参考[绑定内置视图](../management/built-in-view/bind-view.md)。

![](img/8.process_3.png)

另外，通过点击进程详情页的主机标签，您可以对与进程关联的主机的相关数据进行查询。

- “添加到筛选”，即添加该标签至进程查看器，查看与该主机相关的全部进程数据
- “复制”，即复制该标签内容至剪贴板 
- “查看相关日志”，即查看与该主机相关全部日志
- “查看相关容器”，即查看与该主机相关全部容器
- “查看相关进程”，即查看与该主机相关全部进程
- “查看相关链路”，即查看与该主机相关全部链路
- “查看相关巡检”，即查看与该主机相关全部巡检数据

![](img/8.process_5.png)

### 关联指标

在进程详情页，“观测云” 支持您通过详情页的「进程」实时监控**最近24小时内**进程的性能状态，包括CPU使用率、内存使用率、打开的文件数等。

注意：进程指标数据默认不自动开启采集，需要手动配置进程采集器开启进程指标的采集，开启方式可参考文档 [进程](https://www.yuque.com/dataflux/datakit/host_processes) 。进程指标数据开启采集后，下图中的指标才会展示数据。

![](img/8.process_1.png)

### 关联日志

通过详情页下方的「日志」，您可以查看与该进程相关的**最近1小时**的日志，并对这些相关日志进行关键字搜索、多标签筛选和时间排序。如需查看更详细的日志信息，您可以点击日志内容跳转到对应日志详情页面。或点击「跳转」至「日志」查看与该进程相关的全部日志。

![](img/8.process_2.png)

### 关联主机

“观测云” 支持您通过详情页下方的「主机」，查看相关主机（关联字段：host）的基本信息和**在选定时间组件范围内**的性能指标状态。
注意：在进程详情中查看相关主机，需要匹配字段“host”，否则无法在进程详情查看到相关主机的页面。

- 属性视图：包括主机的基本信息、集成运行情况，若开启云主机的采集，还可查看云厂商的信息。

![](img/8.process_4.png)

- 指标视图：可查看默认24小时内，相关主机的CPU、内存等性能指标视图。点击「打开该视图」至内置视图，可通过克隆的方式对主机视图进行自定义修改，并作为用户视图保存，用户视图可通过绑定在进程详情页查看，更多配置详情，可参考[绑定内置视图](https://www.yuque.com/dataflux/doc/dns233/)。

![](img/8.process_4.1.png)

### 进程网络

进程网络支持查看主机和进程服务两个不同维度的网络流量。支持基于 IP/端口查看源主机/源进程服务到目标之间的网络流量和数据连接情况，通过可视化的方式进行实时展示，帮助企业实时了解业务系统的网络运行状态，快速分析、追踪和定位问题故障，预防或避免因网络性能下降或中断而导致的业务问题。

进程网络数据采集成功后会上报到观测云控制台，在「基础设施」-「进程」详情页中的「网络」，您可以查看基于主机或者进程服务的网络数据。

注意：

- 目前仅支持 Linux 系统，且除 CentOS 7.6+ 和 Ubuntu 16.04 以外，其他发行版本需要 Linux 内核版本高于 4.0.0。
- 主机/进程服务网络流量数据默认保存最近48小时，免费版默认保存最近24小时；
- 在进程详情页点击进入「网络」，时间控件默认获取最近 15 分钟的数据且不支持自动刷新，需手动点击刷新获取新的数据；
- 目前支持基于 TCP、UDP 协议的网络性能监测。配合 incoming 和 outgoing ，分成 6 种组合选择：
   - incoming + 不区分协议
   - incoming + tcp 协议
   - incoming + udp 协议
   - outgoing + 不区分协议
   - outgoing + tcp 协议
   - outgoing + udp 协议

#### 参数说明
| 参数 | 说明 | 统计方式 |
| --- | --- | --- |
| IP/端口 | 目标基于IP+端口做聚合，最多返回100条数据 | 按 IP/端口分组统计 |
| 发送字节数 | 源主机/进程服务发送给目标字节数 | 所有记录发送字节数求和 |
| 接受字节数 | 源主机/进程服务接收目标的字节数 | 所有记录接收字节数求和 |
| TCP 延时 | 源主机/进程服务到目标的TCP延时 | 平均值 |
| TCP 波动 | 源主机/进程服务到目标的TCP延时波动 | 平均值 |
| TCP 连接数 | 源主机/进程服务到目标的TCP连接数 | 总和 |
| TCP 重传次数 | 源主机/进程服务到目标的TCP重传次数 | 总和 |
| TCP 关闭次数 | 源主机/进程服务到目标的TCP关闭次数 | 总和 |


#### 网络连接分析

“观测云”支持在进程详情页查看网络连接数据，包括源IP/端口、目标IP/端口、发送字节数、接收字节数、TCP延时、TCP重传次数等。同时，您还可以通过"设置"按钮自定义显示字段，或针对连接数据添加筛选条件，筛选所有字符串类型的keyword字段。如若您需要查看更详细网络连接数据，点击该数据即可查看其对应的网络流数据。

**进程网络连接分析**
在进程详情页的网络，选择视图为“Pid”，可查看进程服务之间的网络连接情况。

![](img/9.network_5.png)

**主机网络连接分析**
在进程详情页的网络，选择视图为“Host”，可查看主机之间的网络连接情况。

![](img/9.network_1.png)

#### 网络流数据

“观测云”支持在进程详情页查看网络流数据，每30s自动刷新一次，默认展示最近2天数据，包括时间、源IP/端口、目标IP/端口、源主机、传输方向、协议等。同时，您还可以通过"设置"按钮自定义显示字段，或针对网络流数据添加筛选条件，筛选所有字符串类型的keyword字段。如若您需要查看关联的网络流数据，点击该数据即可查看对应主机、传输方向、协议等相关字段对应的其他网络流数据。

![](img/9.network_2.png)

## 分组排行榜

“观测云” 支持您通过分组对数据进行相关聚合，聚合的结果将显示分组排行榜Top10。分组支持多标签筛选。

![](img/6.process_2.png)

点击分组右侧的“设置”按钮，可自定义添加分组标签，添加完成后，可选择按照添加分组标签进行分组聚合展示。

注意：自定义分组标签仅管理员可添加。

![](img/6.process_1.png)

通过点击分组排行榜，该分组对应的字段将被做为筛选条件显示查询结果，即你可查看对应分组里的进程对象数据。

![](img/7.process_8.png)

## 设置显示列

在进程列表页面，“观测云” 默认为您展示 PID、用户、主机等信息。您可以通过「显示列」向列表添加、删除显示列，便捷您的数据查看和访问。支持通过关键字搜索显示列，支持自定义显示列作为预设字段，后续通过Pipeline切割字段并上报数据后可直接显示上报的数据。
![](img/image_9.png)

## 数据导出

在进程列表中，“观测云” 支持您通过「设置」导出当前进程列表的数据为CSV文件或者视图。

![](img/image_10.png)

您可以保存当前列表为CSV文件到本地（如图：导出的CSV文件）

![](img/image_11.png)

您也可以保存当前列表为视图到「场景」（如图：导出到「场景」视图）。

![](img/image_12.png)

导出的进程数据以视图的方式添加到对应的场景中进行查看和分析。

![](img/image_13.png)

## 绑定内置视图

“观测云” 支持**当前空间管理员**绑定内置视图（系统视图、用户视图）到进程详情页面。

注意：选择内置视图时，会过滤重名视图，当系统视图和用户视图重名时，优先展示用户视图，即只能选择用户视图，若需要选择系统视图，则需更改或者删除重名的用户视图。

- 通过「设置」-「绑定内置视图」，管理员可以自定义**全部进程对象的内置视图**，并对全部对象的内置视图进行管理，包括删除内置视图、调整内置视图顺序等。

![](img/image_14.png)

- 同时，管理员可以在进程对象详情中，通过「绑定视图」自定义**全部进程对象的内置视图**，并对全部对象的内置视图进行管理，包括删除内置视图、调整内置视图顺序等。

![](img/1.png)

完成内置视图的绑定后，当前空间的全部成员可以在进程对象详情中查看所绑定的内置视图。如：绑定了“Disk监控视图“为进程的内置视图，成员可以在详情页中查看当前进程做为视图变量的“Disk监控”视图, 并通过「跳转」按钮，点击跳转至对应的内置视图页面，对该内置视图进行编辑、复制和导出。

![](img/2.view_6_process.png)

**注意：**绑定内置视图前，需要确认所绑定内置视图中的视图变量是否存在与该进程相关的字段，如`process_id`。更多配置详情，可参考[绑定内置视图](../management/built-in-view/bind-view.md)。
