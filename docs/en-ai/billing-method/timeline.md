# Time Series Billing Items

---

## Update Notes

Guance has completed the upgrade and launch of its **[self-developed GuanceDB time series database](./gauncedb.md)** on April 23, 2023. The new GuanceDB differs from the old time series engine; it is a single-metric time series engine. Although it still retains the concept of a Mearsurement (metric set), each metric will have an independent time series.

As a result, the **statistical logic for time series** in Guance has also changed:

![](../img/timeline-1.png)

Under the new logic:

- **Full Statistics Changed to Incremental Statistics**: Previously, statistics were based on all historical data stored by users, which generated changes in time series. Now, it calculates the number of active time series that may occur each day.
  
- **Fixed Price Changed to Tiered Pricing**: The pricing now varies depending on the selected data retention strategy.
  
- **Statistical Dimensions Changed from Mearsurement to Metrics**: Previously, statistics were based on the dimensions of Mearsurement to count tag combinations under the Mearsurement. In the new GuanceDB time series, statistics are based on metrics to count all tag combinations generated by the reported data on that day.

*Previously, the system counted the number of time series corresponding to user-stored data in the time series database, with relatively fixed unit prices. It also counted all tag combinations under the Mearsurement based on Mearsurement dimensions.*

## What You Need to Know First

Two diagrams explain how to understand full statistics versus incremental statistics:

![](../img/all.png)

![](../img/add.png)

The time series database of Guance primarily involves the following basic concepts:

| Term      | Description |
| ----------- | ------------ |
| Daily Active Time Series | Refers to the number of time series that generate new metric data on a given day. We use the time series that generated data on that day as the basis for statistics. If you stop collecting data, no time series fees will be charged for the next day, but previously collected metric data can still be queried. |
| Mearsurement | Generally used to represent a collection of statistical values, similar to a table in a relational database. |
| Data Point | Refers to a single metric data sample in the context of reporting metric data, analogous to row data in a relational database. |
| Time | Timestamp, representing the time when the data point was generated. This can also be understood as the time when DataKit collects a line protocol report for a metric data point. |
| Metric | Field, generally storing numerical data that changes over time. For example, in a CPU Mearsurement, common metrics include `cpu_total`, `cpu_use`, `cpu_use_percent`, etc. |
| Tag | Tags, generally storing attribute information that does not change over time. For example, in a CPU Mearsurement, fields like `host` and `project` are tag attributes used to identify the actual object properties of the metrics. |

## Billing Generation

Metrics data is collected via DataKit and reported to a workspace. Specifically, this refers to data obtained from DQL queries where **M** is NameSpace.


<font color=coral>**When settling in Renminbi (RMB):**</font>

<div class="grid" markdown>

=== "China Site"

    | Data Retention Strategy | 3 Days | 7 Days | 14 Days | 30 Days | 180 Days | 360 Days |
    | ---------------------- | ------ | ------ | ------- | ------- | -------- | -------- |
    | China Site             | ¥ 0.6  | ¥ 0.7  | ¥ 0.8   | ¥ 1     | ¥ 4      | ¥ 7      |

=== "Hong Kong and Overseas Sites"

    | Data Retention Strategy | 3 Days | 7 Days | 14 Days | 30 Days | 180 Days | 360 Days |
    | ---------------------- | ------ | ------ | ------- | ------- | -------- | -------- |
    | Hong Kong and Overseas Sites | ¥ 1.6 | ¥ 1.8 | ¥ 2.2  | ¥ 2.4  | ¥ 8      | ¥ 14     |

</div>


<font color=coral>**When settling in US Dollars (USD):**</font>

<div class="grid" markdown>

=== "China Site"

    | Data Retention Strategy | 3 Days | 7 Days | 14 Days | 30 Days | 180 Days | 360 Days |
    | ---------------------- | ------ | ------ | ------- | ------- | -------- | -------- |
    | China Site             | $ 0.09 | $ 0.1  | $ 0.12  | $ 0.14  | $ 0.58   | $ 1      |

=== "Hong Kong and Overseas Sites"

    | Data Retention Strategy | 3 Days | 7 Days | 14 Days | 30 Days | 180 Days | 360 Days |
    | ---------------------- | ------ | ------ | ------- | ------- | -------- | -------- |
    | Hong Kong and Overseas Sites | $ 0.23 | $ 0.26 | $ 0.32  | $ 0.35  | $ 1.2    | $ 2      |

</div>



## Billing Item Statistics

Statistics are calculated hourly for the number of new time series generated within the day. After obtaining 24 data points, the maximum value is taken as the actual billing quantity.

## Example

![](../img/timeline-2.png)

In the above diagram:

In the old time series statistical logic, concepts such as metrics and data points were not included; only the number of tag combinations in the current Mearsurement was counted. Therefore, it was difficult to quantify the specific number of time series for users.

However, the new GuanceDB time series logic counts based on tag combinations for each metric. According to the latest logic, we can derive that there are 6 data points in the CPU Mearsurement, each with a `time` field, one metric: `cpu_use_percent`, and two tags: `host` and `project`. The first and fourth rows of data both represent CPU usage (`cpu_use_percent`) for "host" named Hangzhou_test1 and "project" belonging to Guance. Similarly, the second and fifth rows represent CPU usage for "host" named Ningxia_test1 and "project" belonging to Guance, while the third and sixth rows represent CPU usage for "host" named Singapore_test1 and "project" belonging to Guance_oversea.

Based on the above time series data, there are three combinations of time series based on the `cpu_use_percent` metric:

`"host":"Hangzhou_test1","project":"Guance"`      
`"host":"Ningxia_test1","project":"Guance"`       
`"host":"Singapore_test1","project":"Guance_oversea"`       

Similarly, to calculate the total number of time series for all metrics in the current workspace, sum up the actual number of time series for each metric.

**Therefore, regarding the number of time series:**

After the change in Guance's time series logic, the number of daily time series combinations increases, but from the actual data perspective, the number of chargeable time series decreases daily. This is because, under full statistics, if the data retention period is 7 days, by the seventh, eighth, ninth, and tenth days, the data reaches a relatively stable state. Thus, evaluating the number of time series always depends on the total number of time series within this interval for billing purposes.

However, after changing to incremental statistics, Guance calculates the number of active daily time series based on the metric data of that day. Overall, the number of time series combinations at the metric level increases, but the number of chargeable time series tends to decrease. Considering the increase in numbers, the pricing model for GuanceDB time series has changed from a flat rate to tiered pricing, i.e., from 3 RMB per thousand to 0.6 RMB per thousand, based on different data retention strategies chosen by users. Therefore, **overall, the cost of time series billing has decreased compared to before.**

## Fee Calculation Formula

Daily Cost = Actual Billing Quantity / 1000 * Unit Price (based on the data retention strategy)

Assume a user installs DataKit on one host and enables default metric data collection. This host generates 600 daily active time series each day. The steps to estimate costs are as follows:

1. How many hosts will install DK?
   
2. Number of Hosts * 600 = Daily Active Time Series
   
3. Unit Price for Selected Data Retention Strategy * Daily Active Time Series / 1000 = **Estimated Daily Cost**