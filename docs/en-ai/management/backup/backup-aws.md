# Data Forwarding to AWS S3
---

## Start Configuration

1. Select **AWS S3** as the archive type, which means that the matched log data will be saved to this object storage.
2. Choose [Access Type](#type).
3. Click OK to complete the creation.

**Note**: If the archive type information changes, ensure that the associated platform configuration is updated synchronously to avoid data write failures due to configuration changes. New configuration rules will take effect within 5 minutes.

## Access Type {#type}

### Role Authorization

![img/back-2.png](../../img/back-2.png)

1. You must use the default external ID generated by <<< custom_key.brand_name >>> to configure third-party access permissions for AWS resources.
2. After configuring the <<< custom_key.brand_name >>> IAM role in AWS, fill in the archive information with the AWS account ID, AWS role name, region, and bucket name.
3. Enter the [Storage Path](#standard) to facilitate further differentiation and location of the specific data forwarding path.
4. Click **Test Connection**. If the above information meets the specifications, it will prompt that the test connection was successful. Click OK to save the current rule.

#### Directory Path (Folder) Naming Convention {#standard}

1. Create a single folder or multiple levels of folders, where slashes (/) indicate the creation of multi-level folders.
2. Folder names cannot start or end with a slash (/).
3. They cannot contain more than two consecutive slashes (/).
4. Applies to all access types.

**Note**:

- If the entered folder does not exist, <<< custom_key.brand_name >>> will create it directly, and data will still be stored under this path.
- Be cautious when changing the storage path, as there is about a 5-minute delay in updating configurations, and some data may still be forwarded to the original directory after changes.

???+ warning "If the Test Fails:"

    You need to confirm:

    - Whether the external ID has expired;
    - Whether the account ID is correct;
    - Whether the account role exists;
    - Whether the bucket exists;
    - Whether the Region is inconsistent.

    **When the following situations occur, proceed with caution:**

    - If you click to regenerate the external ID, the historical ID will expire after 24 hours, please replace it in the AWS console as soon as possible;
    - Do not repeatedly click to generate an external ID, proceed with caution!

### Access Keys

![](../img/back-3.png)

1. Click to download the AWS resource authorization template and [configure the <<< custom_key.brand_name >>> IAM policy in AWS](../ak-auth.md).
2. After configuration, enter the account information, including AWS AK & SK, region, and bucket name.
3. Enter the [Storage Path](#standard) to facilitate further differentiation and location of the specific data forwarding path.
4. Click **Test Connection**. If the above information meets the specifications, it will prompt that the test connection was successful.

???+ warning "If the Test Fails:"

    You need to confirm:

    - Whether the account ID is correct;
    - Whether the AK / SK exists;
    - Whether the bucket exists;
    - Whether the Region is inconsistent.

### Account Authorization

![](../img/back-2-1.png)

1. AWS provides cross-account authorization capabilities. You need to use the dedicated account ID of <<< custom_key.brand_name >>> and add a cross-account access authorization policy according to the [configuration instructions](../aws-cross-account.md).

2. After configuration, select the region and enter the bucket name.
3. Enter the [Storage Path](#standard) to facilitate further differentiation and location of the specific data forwarding path.
4. Click **Test Connection**. If the above information meets the specifications, it will prompt that the test connection was successful. Click OK to save the current rule.

???+ warning "If the Test Fails:"

    You need to confirm:

    - Whether the account ID is correct;
    - Whether the bucket exists;
    - Whether the Region is inconsistent.

**Regarding Overseas Sites**: The account IDs for overseas sites differ from those in China. Please distinguish them accordingly:

| Site       | ID           |
| ---------- | ------------ |
| Hong Kong  | 588271335135 |
| Oregon     | 521643107266 |
| Singapore  | 521643107266 |
| Frankfurt  | 521643107266 |