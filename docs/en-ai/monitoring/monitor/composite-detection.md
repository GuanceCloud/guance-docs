# Combined Monitoring

In Guance, in addition to setting different monitoring rules based on different data scopes, you can also combine the results of multiple monitors through expressions into a single monitor, ultimately triggering alerts based on the combined results.

## Monitoring Frequency

Combined monitoring **does not have a fixed monitoring frequency**, but rather makes judgments based on the event states of the selected monitors. Since the monitoring frequencies of each monitor may differ, the **highest monitoring frequency** among them is used for judgment.

For example: Monitor A has a monitoring frequency of 5 minutes, and Monitor B has a monitoring frequency of 1 hour. Therefore, for the combined monitor A&&B, it follows B’s frequency (once every hour). After B triggers a check, it combines B’s detection results with the latest detection result from Monitor A for logical evaluation.

## Monitoring Configuration

![](../img/combine-1.png)

1. Please select at least two monitors; the right side will display their grouping by conditions; up to 10 monitors can be added.

2. **Combination Method**: Define whether the combined monitor triggers an event using logical expressions that follow **AND, OR, NOT** operations. When all selected monitors trigger an abnormal state, it evaluates to true; otherwise, it evaluates to false.

### Logical Operations

When the selected monitors are in an abnormal state, they evaluate to `True`, as detailed below:

| Event Status | Evaluation | Severity Level |
| --- | --- | --- |
| `critical` | True | 4 |
| `error` | True | 3 |
| `warning` | True | 2 |
| `nodata` | True | 1 |
| `ok` | False | 0 |
| `info` | False | 0 |
| Non-triggered events are considered normal and also evaluate to False | | |

### Operator Details

| Logical Operation | Description |
| --- | --- |
| `&&` `AND` | `A&&B`: If the operation result is `true`, it returns the **less severe** status level between A and B. For example: A=critical, B=warning, then it returns `warning`. |
| `||` `OR` | `A||B`: If the operation result is `true`, it returns the **more severe** status level between A and B. For example: A=critical, B=warning, then it returns `critical`. |
| `!` `NOT` | "Abnormal state" corresponds to `ok`; "normal state" corresponds to `critical`. For example: if A=error, then `!A=ok`; if A=ok, then `!A=critical`. |

???+ warning "How is 'True' defined?"

    Based on the selected monitors, if there **exist groupings** in the monitors, then only when all common groupings **are in an abnormal state** will it evaluate to "true".

    For example: when selecting Monitor A (alerts generated by hosts 1, 2, 3, 4) and Monitor B (alerts generated by hosts 2, 3, 5, 6), the combined monitor (A&&B) will return "true" only for hosts 2 and 3, generating alerts.

**Note**: When the monitors in the combination method have **inconsistent groupings**, situations without common groupings will not generate alerts.

| Grouping Situation | Consistent? | Example |
| --- | --- | --- |
| Monitor A has no grouping, Monitor B has grouping | No<font color=red size=2> (no alerts will be generated)</font> | B: by host |
| Monitor A and B partially share groupings | No<font color=red size=2> (no alerts will be generated)</font> | A: by host, service, B: by host, device |
| Monitor A and B have completely different groupings | No<font color=2 size=2> (no alerts will be generated)</font> | A: by host, B: by service |
| Monitor A and B have inclusion-based groupings | Yes<font color=red size=2> (alerts can be generated normally)</font> | A: by host, B: by host, device (`dimension_tags=host`) |
| Monitor A is included in Monitor B's grouping, and Monitor B is included in Monitor C's grouping | Yes<font color=red size=2> (alerts can be generated normally)</font> | A: by host, B: by host, device, C: by host, device, os (`dimension_tags=host`) |

*Example:*

Select Monitor A: by host; Monitor B: by host, device. In this case, take the intersection `host` as the final `dimension_tags`. Monitor A can be evaluated normally, while Monitor B takes the most severe level of all `device` under the host as its status, for example:

![](../img/no-alert.png)

## Frequently Asked Questions

:material-chat-question: If the BY configuration does not meet the rules, can the monitor still be configured successfully?

Monitors can still be created successfully even if they do not conform to the rules, but they will not generate alerts.

:material-chat-question: If a combined monitor is configured, will the original monitors still function normally?

They will still trigger alerts normally; the combined monitors do not affect the original monitors.

:material-chat-question: How does combined monitoring calculate task calls?

It also counts one detection as one task call, with the detection frequency being consistent with the highest frequency among the combined monitors.