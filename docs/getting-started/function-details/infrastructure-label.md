# 基础设施Label的妙用
---

## 概述

随着云和云原生的发展，越来越多的企业把业务系统迁移到云和云原生环境中，IT 基础设施的环境也越来复杂，包括（云）主机、容器、进程、应用以及更多云服务资源。对于越来越多的基础设施，我们希望能够有一个功能可以快速对于基础设施进行分类管理，并可以通过搜索或者筛选，快速查看分类下的所有基础设施，以便在发生问题时可以快速找到对应的基础设施来解决问题。

为了方便您能更灵活、有效的管理 IT 基础设施环境，观测云提供基础设施Label的功能，通过 Label 标签对基础设施进行归类，便于搜索和筛选分类管理；并通过 Label 筛选的功能，在观测云 [仪表板](../../scene/dashboard.md) 来展示分类下的所有基础设施的性能指标趋势，帮助您快速的发现基础设施性能波动的异常时间段来定位问题。

下面将为您介绍基础设施 Label 的妙用。
## 前置条件

您需要先创建一个 [观测云账号](https://www.guance.com)，并在您的主机上 [安装 DataKit](../../datakit/datakit-install.md) ，开启相关集成的运行，进行数据采集。

## 使用场景

### 为主机自定义Label

在主机上安装完 DataKit 以后，我们可以在观测云工作空间基础设施主机查看到所有已经安装 DataKit 的主机列表，选择一台主机，可以在主机详情页自定义添加 Label 标签为主机进行分类管理。

### 基于容器自带标签快速筛选

Label 对于容器来说是一个重要的设计，是一组绑定到 K8S 资源对象上的 key/value 对，同一个对象的 labels 属性的 key 必须唯一。在 K8S 环境中，有很多种类的资源对象，如 Node、Pod、Service 等等，通过给指定的资源对象添加一个或多个 label 可以实现多维度的资源分类管理，能更加灵活方便的进行资源分配、调度、配置、部署等管理工作。

对于容器来说，Label 一般是在创建资源对象的时候添加的，所以容器的 Label 是安装完 DataKit 以后，直接采集的容器中已经添加好的 Label 数据，不支持手动添加、修改和删除。 

观测云提供 [DaemonSet 安装](../../datakit/datakit-daemonset-deploy.md) 的方式为容器安装 DataKit，安装完成后，我们可以在观测云工作空间基础设施容器查看到所有容器资源对象列表及其 Label。

### 通过API使用DataFlux Func为自定义基础设施添加Label

除了基础设施主机和容器，自定义云服务资源对象也可以通过添加 Label 的方式来进行分组管理。自定义云服务资源本身是通过 DataFlux Func 平台上报数据到 DataKit ，再通过 DataKit 上报数据到观测云工作空间。关于如何自定义上报云服务资源对象数据到观测云，可参考文档 [自定义对象数据上报](../../infrastructure/custom/data-reporting.md) 。

在配置自定义资源对象数据上报时，可同时为其配置添加 Label 标签，具体可参考文档 [ 通过API添加Label](../../datakit/apis.md#api-object-labels) 。添加完成后即可在观测云工作空间自定义查看列表筛选 Label 对应的云服务对象数据列表。

## 示例说明

假设您有10台主机，其中5台主机部署了生产环境，5台主机部署了测试环境，现在希望能够按照生产环境和测试环境分别筛选主机查看列表及其性能指标趋势。

### 1.为主机安装DataKit
在观测云工作空间，您可以点击 「集成」- 「DataKit」，获取 DataKit 安装指令，并在每台主机上执行安装。更多 Datakit 主机安装说明，您可以参考文档 [主机安装](../../datakit/datakit-install.md) 。

![](../img/2.host_0.png)

主机 DataKit 安装完成后，您可以在观测云工作空间基础设施查看到主机的列表。

![](../img/2.host_1.png)

### 2.在观测云基础设施主机添加Label

首先您可以根据生产环境和测试环境来规划两个 Label，分别可以命名为：product 和 test。

然后您可以打开观测云工作空间基础设施主机列表，点击主机名称进入到主机详情，分别为生产环境和测试环境的主机添加Label “product”和“test”。

![](../img/2.host_2.1.png)

添加完成以后，您就可以在主机的后面看到对应的 Label 名称。
注意：过长的 Label 数据会自动收起，点击容器名称后面的数字即可展开。

![](../img/2.host_3.png)

### 3.在主机搜索栏筛选Label

在主机列表顶部的搜索栏，您可以输入添加的标签如“product”，就可以筛选出所有带“product”标签的主机；或者您可以直接点击添加的“product”标签，即可在搜索栏进行筛选。

![](../img/2.host_4.png)

### 4.在仪表板使用Label筛选展示性能指标趋势

在观测云场景仪表板图表查询中，您可以按照添加的 Label 如 “product”进行筛选展示指标性能趋势。关于如何创建和使用仪表板，您可以参考文档 [仪表板](../../scene/dashboard.md) 。

![](../img/2.host_6.png)
以上就是基础设施主机 Label 的妙用，您也可以尝试容器或者自定义基础设施的 Label 功能来进行分类管理，以便灵活有效的管理您的IT基础设施。

