# 通过网络分析快速定位问题
---
## 概述
### 1. 为什么要进行网络分析

无论是在本地服务器还是云上环境运行，现代服务和应用程序都尤其依赖于网络性能。网络的稳定性对于业务系统来说至关重要。如果关键业务应用程序出现故障，程序无法使用，您可能需要通过梳理日志、查看系统、访问程序、查看进程、调试服务等等去找到故障点，这样会花费很多宝贵时间。

但是，如果掌握了正确的网络流量分析，梳理好网络流量业务链，您就可以快速定位故障点，确定数据包丢失位置。省去了排障过程中对没有问题的中间件设备的确认过程，大大节约了时间，可以更快的修复故障。

所以对网络的全面可见性成为监控应用程序运行状态和性能的关键部分，但随着您的应用程序规模不断扩大，越来越复杂，获得这种可见性就变得具有挑战性。[观测云](https://www.guance.com/) 将为提供主机网络的全面可观测。

### 2. 网络分析的功能范围

观测云将从以下两个方面为您提供主机网络分析，

- **主机网络分布图**：根据主机网络连接情况，自动绘制网络拓扑图，直观呈现网络连接情况以及网络流量大小
- **主机网络详情视图**：根据传输方向及协议从不同角度解析网络相关的重要指标，以及网络连接情况，支持查看实时网络流数据。

## 前置条件

您需要先创建一个 [观测云账号](https://www.guance.com)，并在您的主机上 [安装 DataKit](../../datakit/datakit-install.md) ，开启 [ eBPF](../../datakit/ebpf.md) 集成的运行，采集网络数据。

## 利用网络可观测定位解决我们的问题

观测云通过对网络数据流进行分解和可视化，提供主机网络性能的全面监测。帮助您实时了解业务系统的网络运行状态，快速分析、追踪和定位问题故障，预防或避免因网络性能下降或中断而导致的业务问题

### 主机网络分布图

基于 IP/端口查看源主机到目标之间的网络流量和数据连接情况，自动绘制主机网络分布拓扑图，呈现主机之间的流量交换情况。并自动统计网络关键性能指标，包含`TCP延迟`、`TCP波动`、`TCP重传次数`、`TCP连接次数`以及 `TCP关闭次数`，通过节点颜色、大小等来表现监控的指标数据，让用户更为直观。

- **节点**：节点代表源主机和目标主机，当目标主机不在观测云工作空间内时，节点显示为目标域名。
- **节点大小**：代表入流量的大小
- **节点颜色**：根据所选分析指标值的大小填充相应颜色，（如图所示：当前选中的分析指标为“TCP延时”）
- **节点连线的方向**：代表流量的方向
- **节点连线的粗细**：代表出入流量的大小

![](../img/7.host_network_2.png)

通过观察主机网络分布及关键性能指标，了解当前流量情况。假如你添加的一项托管服务无意中耗尽了您的所有带宽，你可以可视化您的带宽数据，通过TCP重传技术可快速揭示网络问题在您的基础设施中导致连接问题的位置。之后您就可以通过了解相关日志、链路等，并请求跟踪监控流量的去向进行故障排除。

![](../img/7.host_network_1.gif)



### 主机网络详情视图

观测云可以查询单个主机的详细网络信息，目前支持基于 TCP、UDP 协议，配合 incoming（入向）和 outgoing（出向），有多种组合选择的的网络性能监测 。同时提供了七种网络指标统计，全方位实时监控网络流量。分别有：接收/发送字节数、TCP延时、TCP波动、TCP连接数、TCP重传次数、TCP关闭次数。支持基于`源IP/端口` 和 `目标IP/端口` 查看网络连接数据，您可以自定义添加需要关注的指标，支持针对字段进行数据的筛选。

![](../img/7.host_network_3.png)
